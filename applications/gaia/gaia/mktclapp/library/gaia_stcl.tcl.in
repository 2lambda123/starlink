# $Id$
#
# gaiaInit.tcl - This script generates a mktclapp config file on stdout.
#                Command-line version.
#
# who             when       what
# --------------  ---------  ----------------------------------------
# Peter W. Draper 12 May 99  Created, based on skyCatInit.tcl
#                 26 Jul 00  Added specific bits of Tcl code from GAIA
proc main {} {
   global argv argc env argv0
   
   if {$argc != 1} {
      puts "usage: gaia_stcl.tcl output_file_name"
      exit 1
   }
   set outfile [lindex $argv 0]
   set fd [open $outfile w]
   
   #  Set names of source directories.
   set tcl_library      @TCL_LIBRARY@
   set itcl_library     @ITCL_LIBRARY@
   set tclx_library     @TCLX_LIBRARY@
   set gaia_library     @GAIA_BUILD_LIBRARY@

   #  Set names of files needed from GAIA.
   set gaiafiles "GaiaImageName.tcl"
   
   set srcdirs [list \
                   $tcl_library \
                   $itcl_library \
                   $tclx_library]
   
   #  Binary is standalone (only during testing). Stops sourcing of 
   #  external files otherwise.
   #  puts $fd "-standalone"

   #  But reads stdin.
   puts $fd "-read-stdin"
   
   #  Set location of Tcl.
   puts $fd "-notk"
   puts $fd "-tcl-library \"$tcl_library\""
   
   #  Name of the Et_AppInit file.
   puts $fd "tclAppInit.C"
   
   #  Now add all the Tcl file from everywhere.
   foreach dir $srcdirs {
      if {[file exists $dir/tclIndex]} {
         puts $fd "-dont-strip-tcl \"$dir/tclIndex\""
      }
      set tclfiles [glob -nocomplain $dir/*.tcl $dir/*.itk $dir/*.itcl]
      foreach file "$tclfiles" {
         puts $fd "-dont-strip-tcl \"$file\""
      }
   }
   
   #  Add special TclX file.
   if {[info exists tclx_library] && [file exists $tclx_library/tcl.tlib]} {
      puts $fd "-dont-strip-tcl \"$tclx_library/tcl.tlib\""
   } else {
      puts "$argv0: can't find TclX library files"
      exit 1
   }
   
   #  Add useful bits of non-itk GAIA.
   foreach file "$gaiafiles" {
      puts $fd "-dont-strip-tcl \"$gaia_library/$file\""
   }
   puts $fd "-dont-strip-tcl \"$gaia_library/tclIndex\""
  
}
main
exit

