# $Id$

# gaiaInit.tcl - This script generates a mktclapp config file on stdout.
#                Command-line version.

#  Copyright:
#     Copyright (C) 2000-2005 Central Laboratory of the Research Councils.
#     Copyright (C) 2006 Particle Physics & Astronomy Research Council.
#     All Rights Reserved.

#  Licence:
#     This program is free software; you can redistribute it and/or
#     modify it under the terms of the GNU General Public License as
#     published by the Free Software Foundation; either version 2 of the
#     License, or (at your option) any later version.
#
#     This program is distributed in the hope that it will be
#     useful, but WITHOUT ANY WARRANTY; without even the implied warranty
#     of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with this program; if not, write to the Free Software
#     Foundation, Inc., 59 Temple Place,Suite 330, Boston, MA
#     02111-1307, USA

#
# who             when       what
# --------------  ---------  ----------------------------------------
# Peter W. Draper 12 May 99  Created, based on skyCatInit.tcl
#                 26 Jul 00  Added specific bits of Tcl code from GAIA
proc main {} {
   global argv argc env argv0

   if {$argc != 1} {
      puts "usage: gaia_stcl.tcl output_file_name"
      exit 1
   }
   set outfile [lindex $argv 0]
   set fd [open $outfile w]

   #  Set names of source directories.
   set tcl_library      @TCL_LIBRARY@
   set itcl_library     @ITCL_LIBRARY@
   set tclx_library     @TCLX_LIBRARY@
   set gaia_library     @GAIA_BUILD_LIBRARY@

   #  Set names of files needed from GAIA.
   set gaiafiles "GaiaImageName.tcl"

   set srcdirs [list \
                   $tcl_library \
                   $itcl_library \
                   $tclx_library]

   #  Binary is standalone (only during testing). Stops sourcing of
   #  external files otherwise.
   #  puts $fd "-standalone"

   #  But reads stdin.
   puts $fd "-read-stdin"

   #  Set location of Tcl.
   puts $fd "-notk"
   puts $fd "-tcl-library \"$tcl_library\""

   #  Name of the Et_AppInit file.
   puts $fd "tclAppInit.C"

   #  Now add all the Tcl file from everywhere.
   foreach dir $srcdirs {
      if {[file exists $dir/tclIndex]} {
         puts $fd "-dont-strip-tcl \"$dir/tclIndex\""
      }
      set tclfiles [glob -nocomplain $dir/*.tcl $dir/*.itk $dir/*.itcl]
      foreach file "$tclfiles" {
         puts $fd "-dont-strip-tcl \"$file\""
      }
   }

   #  Add useful bits of non-itk GAIA.
   foreach file "$gaiafiles" {
      puts $fd "-dont-strip-tcl \"$gaia_library/$file\""
   }
   puts $fd "-dont-strip-tcl \"$gaia_library/tclIndex\""

   #  Temporary stuff.
   set tcldom_library   $gaia_library/xmlbits/tcldom3.0
   set tclhttpd_library $gaia_library/xmlbits/tclhttpd3.5.1
   set tcllib_library   $gaia_library/xmlbits/tcllib1.8
   set tclsoap_library  $gaia_library/xmlbits/tclsoap1.6.8
   set tclxml_library   $gaia_library/xmlbits/Tclxml3.1

   set srcdirs [list \
                   $tcldom_library \
                   $tclhttpd_library \
                   $tcllib_library \
                   $tclsoap_library \
                   $tclxml_library]

   foreach dir $srcdirs {
      if {[file exists $dir/tclIndex]} {
         puts $fd "-dont-strip-tcl \"$dir/tclIndex\""
      }
      set tclfiles [glob -nocomplain $dir/*.tcl $dir/*/*.tcl]
      foreach file "$tclfiles" {
         puts $fd "-dont-strip-tcl \"$file\""
      }
   }

}
main
exit

