#!/bin/sh    
# The next line is executed by /bin/sh, but not Tcl \
exec $GAIA_DIR/gaia_stcl $0 ${1+"$@"}
#+
#   Name:
#      gaiawcs2tab
#
#   Purpose:
#      Convert a WCS catalogue into a tab-table
#
#   Usage:
#      gaiawcs2tab input output
#
#   Description:
#      This commands converts a plain text file of the type produced
#      by the astrometry toolboxes in GAIA, into a tab-table that can
#      be loaded as a local catalogue.

#   Authors:
#      Peter W. Draper (PDRAPER):
#
#   History:
#      14-OCT-1998 (PDRAPER):
#         Original version.
#-
#.

global argc
global argv

#  Get names of files.
if { $argc == 0 } { 
   puts -nonewline "Input file: "
   flush stdout
   gets stdin infile
} else {
   set infile [lindex $argv 0]
}
if { ! [file exists $infile] } { 
   puts stderr "Sorry file: $infile, does not exist"
   exit 1
}

if { $argc <= 1 } {
   puts -nonewline "Output file: "
   flush stdout
   gets stdin outfile
} else {
   set outfile [lindex $argv 1]
}

#  Open the files.
if { [catch "open $infile r" instr] } { 
   puts stderr "Failed to open input file: $infile ($instr)"
}
if { [catch "open $outfile w" outstr] } { 
   puts stderr "Failed to open output file: $infile ($outstr)"
}

#  Add the initialising commands.
puts $outstr "QueryResult"
puts $outstr "ra_col: 1"
puts $outstr "dec_col: 2"
puts $outstr "symbol: INDEX {circle {} {} {} {\$INDEX} {}} {4.0 {}}"

puts $outstr "INDEX\t RA\t DEC\t XPOS\t YPOS"
puts $outstr "-----\t --\t ---\t ----\t ----"

#  Loop over the input file reading all the elements and writing them
#  back out with TAB separated fields.
while { [gets $instr line] > -1 } { 
   set nitems [llength $line]
   if { $nitems > 0 } {
      foreach {id ra dec x y} $line {
         puts $outstr "$id\t $ra\t $dec\t $x\t $y"
      }
   }
}
close $instr
close $outstr
exit
