#*******************************************************************************
# E.S.O. - VLT project
#
# "@(#) $Id: Makefile.in,v 1.2 2005/02/02 01:43:03 brighton Exp $"

# ------------------------------------------------------------------------
# 	Makefile for RTD demo directory
# ------------------------------------------------------------------------

# starter shell script
START_SCRIPT = rtd.sh

# local Tcl applications
TCL_APPS     = rtd rtdctrl rmipc

# local Tcl applications to install
INST_TCL_APPS  = rtd

# other files to install
FILES        = Xdefaults

do_all: tcl_apps
	@rm -f test.fits; ln -s ../images/ngc1275.fits test.fits

# create the startup script for starting the Tcl applications
tcl_apps:
	@for i in $(TCL_APPS); do \
	    rm -f $$i; \
	    echo '#!/bin/sh' > $$i; \
	    echo '# --------------------------------------------------' >> $$i; \
	    echo '# E.S.O. - VLT project' >> $$i; \
	    echo "# $$i version @RTD_VERSION@" >> $$i; \
	    echo "# Installation date: `date`" >> $$i; \
	    echo '# --------------------------------------------------' >> $$i; \
	    cat $(START_SCRIPT) | awk '! /^ *#/ { if (length()) { print "#\\"; print }}' >> $$i; \
	    echo '# --------------------------------------------------' >> $$i; \
	    cat $$i.tcl >> $$i; \
	    chmod +x $$i ; \
	done

install-top:
	@test -d $(BINDIR) || mkdir $(BINDIR) 
	@test -d $(RTD_DIR) || mkdir $(RTD_DIR)
	@test -d $(RTD_DIR)/demos || mkdir $(RTD_DIR)/demos

do_install: install-top
	@for i in $(FILES) ; do \
	    $(INSTALL_DATA) -m 664 $$i $(RTD_DIR)/demos ; \
	done 
	@for i in $(INST_TCL_APPS); do \
	    $(INSTALL_DATA) -m 775 $$i $(BINDIR)/$$i ; \
	done
	$(INSTALL_DATA) -m 775 tRemote.tcl $(RTD_DIR)/demos/tRemote

do_clean:
	$(RM) $(TCL_APPS)

do_distclean: clean
	$(RM) $(START_SCRIPT) rtd_env.sh

include ../../makefile.mk

