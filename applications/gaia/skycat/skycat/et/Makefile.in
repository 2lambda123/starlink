# E.S.O. - VLT project/ESO Archive
# $Id: Makefile.in,v 1.13 1998/06/19 20:01:57 abrighto Exp $
#
# Makefile.in - Makefile to create the "skycat" binary
#               (uses ET - Embedded Tk - to create one binary with tcl scripts loaded)
#
# This file is processed by configure to produce the actual Makefile.
#
# who             when       what
# --------------  ---------  ---------------------------------------------
# Allan Brighton  04 Oct 95  Created
# ------------------------------------------------------------------------

DEFINES      = @DEFS@

CFLAGS       = @CXXDEBUGFLAGS@

# C compiler
CC 	     = @CC@

# C++ compiler
CXX          = @CXX@

# install directories
TOPDIR	     = @DESTDIR@
BINDIR       = @BINDIR@
SKYCAT_DIR   = @SKYCAT_DIR@

# set to 1 if shared libs were enabled with --enable-shared configure option
SHARED       = @SHARED@

# ------------------------------------------------------------------------
#       Include directives for Tcl, Tk, and X include files 
# ------------------------------------------------------------------------

TCL_INCLUDE   = @TCLINCSW@
TK_INCLUDE    = @TKINCSW@
X_INCLUDE     = @XINCSW@

# ------------------------------------------------------------------------
#       Libraries for Tcl, Tk, X11, BLT, etc.
# ------------------------------------------------------------------------
# note: using shared X libs might cause problems if end user has different 
# library versions, but it is needed for plugins that might access more
# Xlib functions than skycat does.
# 
# note: on Solaris2.4 with openwin, need to have libXext after libX11...
#X_LIB        = @XLIBSW_STATIC@ @XLIBSW_STATIC@
X_LIB        = @XLIBSW@

# use static tcl/tk archives if available
TCL_LIB      = @TCL_LIB_SPEC_STATIC@
TK_LIB       = @TK_LIB_SPEC_STATIC@
ITCL_LIB     = @ITCL_LIB_SPEC_STATIC@ @ITK_LIB_SPEC_STATIC@
TCLX_LIB     = @TCLX_LIB_SPEC_STATIC@
BLT_LIB      = @BLT_LIB_SPEC_STATIC@

EXTRA_LIBS   = @LIBS@

TCL_LIBS     = \
	$(ITCL_LIB) \
	$(TCLX_LIB) \
	$(BLT_LIB) \
	$(TK_LIB) \
	$(TCL_LIB)

# ------------------------------------------------------------------------
# Required Libs
# ------------------------------------------------------------------------
RTD_LIB      = @RTD_LIB_STATIC@
CAT_LIB      = @CAT_LIB_STATIC@

# local skycat util lib
SKYCAT_LIB  = ../interp/lib/libskycat.a

# ------------------------------------------------------------------------
# This is required for using ET
# ------------------------------------------------------------------------
ET_OBJS = ../../et/et.o

# ------------------------------------------------------------------------
# tcl script to load all of the tcl library files
INIT_SCRIPT  = library/skyCatInit.tcl

# name of tcl interpreter to use to run $(INIT_SCRIPT)
TCL_INTERP   = ../interp/bin/skycat_tcl

# name of program
PROG         = bin/skycat-@OSVERSION@

# include flags
INCLUDES     = $(TK_INCLUDE) $(TCL_INCLUDE) $(X_INCLUDE)

# compiler flags
CC_SWITCHES  = $(CFLAGS) $(DEFINES) $(INCLUDES)

# libraries to link
LIBRARIES    = \
	$(SKYCAT_LIB) \
	$(CAT_LIB) \
	$(RTD_LIB) \
	$(TCL_LIBS) \
	$(X_LIB) \
	$(EXTRA_LIBS)

# shared library flags
LD_SEARCH_FLAGS=@LD_SEARCH_FLAGS@
LIB_RUNTIME_DIR=@LIB_RUNTIME_DIR@
LD_FLAGS=@LD_FLAGS@

# these objects are only needed to make the skycat_wish binary for the demos
OBJECTS      = skycat.o

INSTALL      = @INSTALL@
RANLIB 	     = @RANLIB@
SHELL 	     = /bin/sh
RM 	     = rm -f
LN 	     = ln -s

# ------------------------------------------------------------------------
all: $(PROG) 

$(PROG): $(OBJECTS)
	@echo "linking \"$(PROG)\"..."
	$(CXX) $(LD_FLAGS) $(CC_SWITCHES) $(ET_OBJS) $(OBJECTS) \
	    -o $(PROG) -L. $(LD_SEARCH_FLAGS) $(LIBRARIES)

quick:
	@echo "linking \"$(PROG)\"..."
	$(CXX) $(CC_SWITCHES) $(ET_OBJS) $(OBJECTS) \
	    -o $(PROG) -L. $(LD_SEARCH_FLAGS) $(LIBRARIES)

skycat.C: skycat.tcl
	../../et/et2c $(ET2CFLAGS) tkAppInit.C > skycat.C

# generate a single tcl source file form the development copies of all tcl sources
skycat.tcl: FORCE
	TCLUTIL_LIBRARY=@TCLUTIL_BUILD_LIBRARY@; export TCLUTIL_LIBRARY; \
	ASTROTCL_LIBRARY=@ASTROTCL_BUILD_LIBRARY@; export ASTROTCL_LIBRARY; \
	RTD_LIBRARY=@RTD_BUILD_LIBRARY@; export RTD_LIBRARY; \
	CAT_LIBRARY=@CAT_BUILD_LIBRARY@; export CAT_LIBRARY; \
	SKYCAT_LIBRARY=@SKYCAT_BUILD_LIBRARY@; export SKYCAT_LIBRARY; \
	$(TCL_INTERP) $(INIT_SCRIPT) skycat.tcl

install-top:
	@test -d $(TOPDIR) || mkdir $(TOPDIR)

install-bin: 
	@test -d $(BINDIR) || mkdir $(BINDIR)
	$(INSTALL) $(PROG) $(BINDIR)

install: install-top install-bin

clean:
	$(RM) $(OBJECTS) *.o $(PROG) $(demo_tcl) *\~ "#"* skycat.C skycat.tcl

distclean: clean
	$(RM) Makefile

depend:

man:

FORCE:

.SUFFIXES: .C
.c.o:
	$(CC) -c $(CC_SWITCHES) $<

.C.o:
	$(CXX) -c $(CC_SWITCHES) $<

