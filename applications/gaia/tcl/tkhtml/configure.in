# E.S.O. - VLT project 
# usage: % autoconf  # only if configure.in changed
#        % configure
#        % make

AC_INIT(htmlparse.c)

# -----------------------------------------------------------------------
#
# 	Set prefix variable if one wasn't provided
#
# -----------------------------------------------------------------------
if test "$prefix" = "NONE" ; then
    prefix=/usr/local
fi
echo "using prefix = $prefix"
AC_SUBST(prefix)

# -----------------------------------------------------------------------
#
# 	Set PWD variable (/bin/sh may inherit the wrong value...)
#
# -----------------------------------------------------------------------
PWD=`pwd`
SRC_ROOT=$PWD
AC_SUBST(SRC_ROOT)

# -----------------------------------------------------------------------
#
# C compiler and debugging flags
#
# -----------------------------------------------------------------------
AC_PROG_CC
AC_PROG_INSTALL
AC_PROG_RANLIB
AC_PROG_CPP
    
AC_ARG_WITH(gcc, [--with-gcc         use gcc compiler], CC=gcc; CXX=g++)
AC_ARG_WITH(cc,  [--with-cc          use cc compiler], CC=cc; CXX=CC)
if test -z "$CC" ; then 
    CC=gcc
fi
#compiler=`basename $CC`
#if test "$compiler" = "gcc" ; then
#    CC="$CC"
#fi
AC_SUBST(CC)

# -----------------------------------------------------------------------
#
# Read the Tcl, Tk, Itcl and TclX config files to find out where the X 
# and Tcl/Tk files and libraries are.
#
# -----------------------------------------------------------------------
getConfig() {
  name=${1}Config.sh
  echo "checking for ${name}"
  TCL_CONFIG_DIR=""
  places="$prefix/lib \
  $PWD/../tcl8.0.3/unix \
  $PWD/../tk8.0.3/unix \
  /usr/local/lib \
  /usr/lib"
  for dir in $places; do
    if test -r $dir/${name} ; then
      TCL_CONFIG_DIR=$dir
      break
    fi
  done
  while test -z "$TCL_CONFIG_DIR" ; do
    echo "What directory contains ${name} ?"
    read TCL_CONFIG_DIR
    if test ! -r $TCL_CONFIG_DIR/${name} ; then
      echo "can't read $TCL_CONFIG_DIR/${name}"
      TCL_CONFIG_DIR=""
    fi
  done
    
  # source the Tcl config file
  . $TCL_CONFIG_DIR/${name}
}

#  source the config files
getConfig tcl
getConfig tk

# package versions
AC_SUBST(TCL_VERSION)
AC_SUBST(TK_VERSION)

# major versions
AC_SUBST(TCL_MAJOR_VERSION)
AC_SUBST(TK_MAJOR_VERSION)

# tcl root for libraries and include files.
AC_SUBST(TCL_EXEC_PREFIX)

# -----------------------------------------------------------------------
#
# use CDEBUGFLAGS for C
#
# -----------------------------------------------------------------------
if test "$CC" = "gcc" ; then
	CDEBUGFLAGS="-g -O"
fi
AC_ARG_WITH(debug, [--with-debug       use debugging flag], 
	CDEBUGFLAGS="-g";
	CDEBUGFLAGS="-O")

AC_SUBST(CDEBUGFLAGS)

#--------------------------------------------------------------------
#	Propagate prefix argument as installation directory.
#--------------------------------------------------------------------
DESTDIR=$prefix
LIBDIR=$DESTDIR/lib

AC_SUBST(prefix)
AC_SUBST(DESTDIR)
AC_SUBST(LIBDIR)

#--------------------------------------------------------------------
#	Generate the Makefiles etc...
#--------------------------------------------------------------------
AC_OUTPUT(Makefile)
