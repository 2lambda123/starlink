^$STARLINK_DIR/share/smurf/dimmconfig.lis

# *** Specialized config for finely-spaced scans of bright sources ***
#
# To produce focal plane distortion maps we produce very finely-spaced
# maps of bright calibrators so that we can produce fully-sampled images
# for each bolometer. Bright sources can easily be confused as steps/spikes,
# so the thresholds have been set quite high. S/N is
# also very high, so a fairly weak high-pass filter is applied (0.1 Hz) at
# both wavelengths.
#
# The bolomap=1 flag has been set. This will produce a series of
# extensions (.MORE.SMURF.BOLOMAPS) in the main map for working
# bolometer:
#
#   gaia [output map name].more.smurf.bolomaps
#
# Finely, we set ensureflat=0 so that the bolometer data are left in raw
# DAC units. In these units sources will look like negative holes rather
# than positive peaks! The purpose of this is to enable us to compare
# flatfields from an astronomical source (relative intensities of a
# calibrator in each detector) with those from heater ramps.
#
# *******************************************************************


# We propagate the variance from the time series since it is the only way
# to get a reasonable estimate for the single-bolo maps where many pixels
# only have one or two samples (so sample variance is almost meaningless).
#
# method of estimating variance map:
#  0 = propagate from the time-domain noise (requires noi model component)
#  1 = sample variance of data that land in each pixel
varmapmethod = 0

# Create single-beam maps in addition to main map
bolomap = 1

# Do not flatfield data so that the maps are in DAC units.
ensureflat=0

# Much weaker noise clip
noiseclip = 10.0

# Less aggressive DC step finder to avoid problems with bright sources
dcthresh = 100

# ----------------------------------------------------------------------------
# The following parameters control data-cleaning before iterations start
# ----------------------------------------------------------------------------

# Less aggressive bolo flagging. Also, handle bolos in entire
# chunks. Even if we get chunked common-mode flagging to work much
# better, these maps of bright point sources may cause problems.

com.corr_tol = 7
com.gain_tol = 7
com.gain_abstol = 5
com.gain_box = 600000

# Don't do any extra de-spiking / step finding iteratively
noi.spikethresh = 0
noi.spikebox = 0
noi.dcfitbox = 0
noi.fillgaps = 0
