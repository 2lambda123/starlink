#! /bin/sh -

test -n "$RUN" || RUN=../astrom.x
test -x fitsdump || make fitsdump >&2
if test ! -x fitsdump; then
    echo "Can't build fitsdump"
    exit 1
fi

rm -f tmp*

cat >tmp1.astrom-in <<EOF
J2000
ASTR
17 27  9.120   74 20  8.160   J2000  1998.47
17 26 32.640   74 16 42.240 0.0  0.0  1998.47
 1653.995000    2482.706000
17 26 24.720   74 16 46.200 0.0  0.0  1998.47
 1644.335000    2581.196000
17 26 53.520   74 17 11.040 0.0  0.0  1998.47
 1563.551000    2229.920000
17 26 48.240   74 18  2.880 0.0  0.0  1998.47
 1406.641000    2295.989000
17 28  4.800   74 18  3.240 0.0  0.0  1998.47
 1390.010000    1359.541000
17 27 24.480   74 19 31.800 0.0  0.0  1998.47
 1131.300000    1859.745000
17 27 51.360   74 20 31.560 0.0  0.0  1998.47
  943.707000    1537.692000
17 27 44.640   74 22  0.120 0.0  0.0  1998.47
  681.152000    1624.824000
END
EOF

# This test file generated by applylm.f -- see comments within that
cat >tmp2.astrom-in <<EOF
* Components: 0.000E+00 -0.212E-07 -0.485E-05  0.000E+00 -0.485E-05 -0.212E-07
J2000
ASTR
17 00 00.000  +074 00 00.00  J2000 2000.0
16 59 53.362  +074 01 39.56  0.0  0.0  2000.0
   -100.00    100.00
16 59 53.333  +073 59 59.56  0.0  0.0  2000.0
      0.00    100.00
16 59 53.304  +073 58 19.56  0.0  0.0  2000.0
    100.00    100.00
17 00 00.029  +074 01 40.00  0.0  0.0  2000.0
   -100.00      0.00
17 00 00.000  +074 00 00.00  0.0  0.0  2000.0
      0.00      0.00
16 59 59.971  +073 58 20.00  0.0  0.0  2000.0
    100.00      0.00
17 00 06.696  +074 01 40.44  0.0  0.0  2000.0
   -100.00   -100.00
17 00 06.667  +074 00 00.44  0.0  0.0  2000.0
      0.00   -100.00
17 00 06.638  +073 58 20.44  0.0  0.0  2000.0
    100.00   -100.00
END
EOF



for t in tmp1 tmp2
do
    $RUN input=$t.astrom-in report=$t.rep summary=$t.sum log=$t.log \
        fits=$t-fits wcsstyle=qtan

    for f in $t.astrom-in $t.rep $t.sum $t.log
    do
        echo "!!!+ $f"
        cat $f
        echo "!!!- $f"
    done
    for f in $t-fits*
    do
        echo "!!!+ $f"
        ./fitsdump $f
        echo "!!!- $f"
    done

done

rm -f tmp*

exit 0
