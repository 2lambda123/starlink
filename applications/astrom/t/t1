#! /bin/sh -

test -n "$RUN" || RUN=../astrom.x
test -x fitsdump || make fitsdump >&2
if test ! -x fitsdump; then
    echo "Can't build fitsdump"
    exit 1
fi

rm -f tmp1*

cat >tmp1.astrom-in <<EOF
J2000
ASTR
17 27  9.120   74 20  8.160   J2000  1998.47
17 26 32.640   74 16 42.240 0.0  0.0  1998.47
 1653.995000    2482.706000
17 26 24.720   74 16 46.200 0.0  0.0  1998.47
 1644.335000    2581.196000
17 26 53.520   74 17 11.040 0.0  0.0  1998.47
 1563.551000    2229.920000
17 26 48.240   74 18  2.880 0.0  0.0  1998.47
 1406.641000    2295.989000
17 28  4.800   74 18  3.240 0.0  0.0  1998.47
 1390.010000    1359.541000
17 27 24.480   74 19 31.800 0.0  0.0  1998.47
 1131.300000    1859.745000
17 27 51.360   74 20 31.560 0.0  0.0  1998.47
  943.707000    1537.692000
17 27 44.640   74 22  0.120 0.0  0.0  1998.47
  681.152000    1624.824000
END
EOF


$RUN . tmp1.astrom-in tmp1.rep tmp1.sum tmp1-fits tmp1.log


for f in tmp1.astrom-in tmp1.rep tmp1.sum tmp1.log
do
    echo "!!!+ $f"
    cat $f
    echo "!!!-"
done
for f in tmp1-fits*
do
    echo "!!!+ $f"
    ./fitsdump $f
    echo "!!!-"
done

rm -f tmp1*

exit 0



testfailed=false

# Strip DATE records from fits files (contains today's date)
for f in *fits; do ./fitsdump $f > $f-ascii;done

for f in t1.rep t1.sum t1-fits*fits-ascii t1.log
do
	echo "Testing $f... "
	diff $f $f.correct >$f.diff
	if [ $? = 0 ]; then
		echo "ok"
	else
		echo "failed"
		testfailed=true
	fi
	mv $f $f.delete
done

exit 0

