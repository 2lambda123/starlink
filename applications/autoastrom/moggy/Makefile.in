# Makefile for program moggy
#
# Copyright 2001 Council for the Central Laboratory of the Research Councils.
# See file LICENCE for conditions.
#
# $Id$

# C++ all-warnings flags:
#  g++ -Wall  (GNU)
#  CC +w2     (Sun Workshop compilers)
#  cxx -w0    (Compaq compilers)
DEFS=@DEFS@
CPPFLAGS=@CPPFLAGS@
CXX=@CXX@
CXXFLAGS=-g -Wall @CXXFLAGS@ $(CPPFLAGS) $(DEFS)
LIBS=-lm @LIBS@



# Use suffix rules for stupid makes (hello, Tru64)
.SUFFIXES: .o .C
.c.o:
	$(CC) -I$$STARLINK/include -c $< -o $@

.C.o:
	$(CXX) $(CXXFLAGS) -c -o $@ $<


#%.o: %.f
#	$(F77) -fno-underscoring -I$$STARLINK/include -c $< -o $@
#
#%.o: %.c
#	$(CC) -I$$STARLINK/include -c $< -o $@
#
#%.o: %.C
#	$(CXX) $(CXXFLAGS) -c -o $@ $<



EXEC=moggy
OBJS=moggy.o CommandParse.o CatalogueHandler.o util.o

$(EXEC): $(OBJS)
	$(CXX) $(OBJS) $(LIBS) -o $@


# Distribution
configure: config/configure.in
	autoconf config/configure.in >configure
	chmod 755 configure

tags:
	etags --c++ *.C *.h

clean:
	rm -f $(EXEC)
	rm -f *~ *.o core

distclean: clean
	rm -f config.cache config.log config.status config.h

# Dependencies
depend:
	echo '# DO NOT DELETE THIS LINE (it is used by make depend)' >depend.tmp
	for i in *.C; do \
		echo `echo $$i|sed 's/\.C/.o/'`: $$i `sed -n '/^#include/s/^[^\"]*\"\(.*\)\".*/\1/p' $$i` >>depend.tmp; \
	done
	for i in *.h; do \
		echo "$$i:" `sed -n '/^#include/s/^[^\"]*\"\(.*\)\".*/\1/p' $$i` >>depend.tmp;\
	done
	sed -e '/^# DO NOT DELETE/,$$d' -e '$$r depend.tmp' Makefile >Makefile.tmp
	mv Makefile.tmp Makefile
	rm -f depend.tmp


# DO NOT DELETE THIS LINE (it is used by make depend)
CatalogueHandler.o: CatalogueHandler.C config.h stringstream.h \
	CatalogueHandler.h util.h
CommandParse.o: CommandParse.C config.h CommandParse.h util.h
moggy.o: moggy.C config.h moggy.h CommandParse.h CatalogueHandler.h util.h
util.o: util.C util.h
CatalogueHandler.h: moggy.h
CommandParse.h: config.h moggy.h verbosity.h
config.h:
moggy.h:
stringstream.h:
util.h:
verbosity.h:
