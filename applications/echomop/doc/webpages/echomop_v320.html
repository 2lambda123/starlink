<HTML>
<HEAD>
<TITLE>New Features in ECHOMOP Version 3.2-0</TITLE>
</HEAD>

<BODY>
<HR>
<H1>ECHOMOP Version 3.2-0</H1>
<HR>

This page lists the changes made to ECHOMOP between the last release
version 3.1-0, and the current release version 3.2-0.
<P>

Please note that this version was formerly to be v3.1-1.
<P>

<UL>
<LI><A HREF="echelle.html">Go back</A> to the EDR home page.
<LI><A HREF="#ECHOMOPBUGFIX">Go forward</A> to a list of
     bug fixes in this version of ECHOMOP.
</UL>

<H2><IMG SRC="gifs/ball.green.gif" ALT="o"> New features</H2>
<UL>

<LI>A new task ech_genflat has been added.  This task outputs flat-field
   balance factors as generated by ech_ffield to an image.  The image can
   then be inspected using, <I>e.g.</I>, KAPPA DISPLAY.
<LI>The design of the interface in the parameter editor has been altered
   to make it a little easier to use.
<LI>'QUIT' and 'Q' have been added as aliases for EXIT in the echmenu
   top-level menu.
<LI>'Q' has been added as an alias for 'E' (EXIT) in the ech_plot top-level
   menu.
<LI>The task ech_fcheck now checks both input and trace frames for BAD
   values in their data arrays.  The trace frame is now checked for saturated
   pixels.
<LI>In the plotting task the full option menu is displayed only once.
   The menu can be redisplayed by pressing 'M' as in other tasks.
<LI>In the plotting task when displaying reduction data the default prompt
   now automatically sets its self to point at the next order for the
   last data plotted.  For example a plot of 'OBJ[1,1]' - the first order
   of the object - will set the default value to 'OBJ[1,2]' - the next order.
   This means it is much faster to check through all the orders.

</UL>

<H2><IMG SRC="gifs/ball.green.gif" ALT="o"> Documentation notes</H2>
<UL>

<LI>ECHMENU option 1.5 has been documented in SUN/152.
<LI>Some errors in SUN/152 have been fixed, the text clarified in
   a few places, and several missing parameter details added.
<LI>Some errors in the on-line and hypertext HELP texts have been
   corrected.
<LI>The out-of-date and uninformative "Inputs-Outputs" and "Method"
   entries in the on-line and hypertext HELP text have been removed.

</UL>


<H2><IMG SRC="gifs/ball.green.gif" ALT="o"> Parameter default changes</H2>
<UL>

<LI>The default value of TUNE_MXSMP has been changed from 200 to 500.
   This reflects the increase in size of CCDs in recent years.
<LI>The default value of TUNE_MAXPOLY has been reduced from 50 to 32.
   This won't affect most users of ECHOMOP, it will save a (very) small
   amount of memory, disk space, and processing time.
<LI>The advertised default value of TUNE_TWTHR (0.9) was incorrect and
   has been corrected to 0.95.
<LI>The advertised default value of TUNE_AUTLOC (TRUE) was incorrect and
   has been corrected to FALSE.
<LI>The advertised default value of TUNE_NPLOY (7) was incorrect and
   has been corrected to 4.
<LI>The default value of TUNE_ARCHIVE has been changed to FALSE.

</UL>

<H2><IMG SRC="gifs/ball.green.gif" ALT="o"> Other changes</H2>
<UL>

<LI>There is a separate program to build the module definition database.
   This has to be done once for an ECHOMOP build.  This change makes a
   small reduction in the load time for the monolith.
<LI>Only one call to PSX_UNAME is made per invocation of the monolith.
   Previously, several routines called PSX_UNAME.
<LI>Calls to PGPOINT have been changed to call PGPT.
<LI>The subroutine calculating median values has been enhanced.
<LI>There is only one routine for mean/median/most-common-value calculation.
<LI>Several table look-up routines have been modified to exit-on-match,
   rather than searching the full table for an entry.
<LI>The trace-clipping task menu is only displayed once which speeds
   up the process of trace clipping.  The full menu can be displayed using
   option "M" in the same style as the profiling tasks.
<LI>In the spatial profiling task the display of "below"-trace pixel-distances
   has been changed to reflect the syntax used.  For example the dekker edge
   is now said to be "20" pixels "below trace" rather than "-20" pixels below
   which suggests that it is above the trace.
<LI>Messages of the form "Parameter XXX is set to non-default value: nn" have
   been shortened.
<LI>Some of the main menu text has been changed.
<LI>Several (140) calls to ECH_SET_CONTEXT which had no effect have been
   removed from subroutines.  This may lead to a small speed-up for
   some operations.
<LI>When DISPLAY=TRUE overlaid trace plots are labelled with the relevant
   order number.  The display scaling is calculated only once per frame,
   rather than once per order, which speeds up this option.
<LI>The routine ECH_FIND_CENTRE has been modified, speeding up
   centre-of-gravity mode tracing and echmenu option 9 (locate arc line
   candidates).
<LI>The file ech_dynamic_index_index.f (which was not used) has been
   removed.
<LI>The file ech_makefits.f (which was not used and is not needed) has been
   removed.
<LI>The file ech_plot_id_lines.f (which was not used) has been removed.
<LI>In the dekker/object "profiling" task (echmenu option 4) graph titles
   now include the number of the order displayed.
<LI>Many FORMAT statements have been changed by the addition of "1P"
   scale factors.  This makes output numbers easier to read.
<LI>The files ech_loop_nvariable.f and ech_loop_variable.f have been
   removed due to the process of speeding up the main ECHOMOP routine and
   introduction of extra functions.
<LI>The IDX_ parameters were being typed as _REAL by the program whilst
   they were (correctly) declared as _INTEGER in interface files.
   This has been corrected.
<LI>In the order blaze fitter the plots of function-verses-fit now
   use the same colour scheme as in the order trace fitter.
<LI>The displays and menus in the interactive flat-field modeller have all
   been tidied up.

</UL>

<H2><A NAME=ECHOMOPBUGFIX><IMG SRC="gifs/ball.green.gif" ALT="o"> Bug fixes</A></H2>
<UL>

<LI>In the order fitting/clipping process it is now possible to
   select an order of fit less than 4.
<LI>In the ech_spatial task it is no longer possible to set the
   value of DEK_BELOW greater than DEK_ABOVE and vice versa.
   Previously this would cause various problems.
<LI>Internal arrays in profiling tasks have been enlarged and
   range checks are now performed prior to array usage.  This
   has removed some intermittent crashes.
<LI>Most format statements using Hollerith characters have been updated.
<LI>An error in the data access layer relating to default object
   dimensions has been fixed.
<LI>Previously, in plots of order-trace versus fitted-curve the points
   of the order trace were shifted down.  This gave the impression that
   the fit was offset by a constant.  This bug has been removed.
   This bug also affected the order trace overlaid on image plots.
<LI>A limitation in ECH_MEAN_MEDIAN whereby only the first 5000 values of
   a dataset would be used in median determination has been removed.
<LI>An error causing a crash for USE_MEDIAN=TRUE in the order-location
   task has been removed.  USE_MEDIAN=TRUE now works OK.
<LI>An error in the call sequence causing unaligned memory access and
   crashing ECH_DECOS2 has been removed.
<LI>Spurious "Unknown fitting function" messages appearing when using
   ECH_DECOS2 have been removed.
<LI>Centroid-mode tracing now includes a filter for bad values in images.
   Previously, these bad values would break the centroiding code causing
   a crash with a floating-point exception.
<LI>The spatial-profiling task now includes various filters for bad values
   which would break it.
<LI>A commonly-occurring divide-by-zero error in the optimal extraction
   algorithm implementation has been removed.
<LI>The simple-extraction algorithm will now handle bad-pixel values as well
   as, or instead of, quality arrays in object images.
<LI>The simple-extraction algorithm will now handle bad-pixel values in
   arc images.
<LI>The profile-weighted extraction algorithm will now handle bad-pixel
   values as well as, or instead of, quality arrays in object images.
<LI>The profile-weighted extraction algorithm will now handle bad-pixel
   values in arc images.
<LI>The HELP facility is now accessible from the echmenu program (bug in
   v3.1-0).
<LI>The quick-look extraction algorithm will now handle bad-pixel
   values as well as, or instead of, quality arrays in object images.
<LI>The quick-look extraction algorithm will now handle bad-pixel
   values in arc images.
<LI>After running the quick-look extraction the colour of plots is now
   reset to black rather than being left blue.
<LI>The 2-D simple-extraction algorithm will now handle bad-pixel values in
   arc images.
<LI>The 2-D simple-extraction algorithm will now handle bad-pixel values as
   well as, or instead of, quality arrays in object images.
<LI>The arc-line width estimator routine can now handle bad values in the
   image.  The routine has been improved to scale data according to the
   number of good values obtained, previously no scaling was applied.
<LI>After running the trace consistency checker the colour of plots is
   now reset to black rather than being left red.
<LI>The blaze-fitting option now checks for the case TUNE_NOFLAT=TRUE,
   previously it would simply crash in this case.
<LI>After running the order trace plotting task the colour of plots is
   now reset to black rather than being left red.
<LI>Image displays autoscale to suit the data rather than using fixed
   (incorrect) values dependant on the image dimensions.
<LI>Order tracing with DISPLAY=TRUE now works, previously this caused
   a crash due to a type mismatch in a subroutine call.
<LI>Previously, order tracing with fitted traces displayed overlaid on
   the traced image only worked when some other plot had been made in the
   session.  This can now be the first plot in a session.
<LI>A crash when running the trace consistency checker with DISPLAY=TRUE
   has been removed.
<LI>Evaluation of SPLINE-fitted order traces in the order-tracing task
   was not done correctly, causing the program to crash in some cases.
   This bug has been removed.
<LI>Reporting of messages relating to NULL (!) and ABORT (!!) responses
   to parameter prompts is no longer deferred.
<LI>The faulty arc-line database file
   <A HREF="ftp://ftp.star.ucl.ac.uk/pub/mjc/THAR.sdf">$ARCDIRS/THAR.sdf</A>
   has been replaced.
<LI>Incomplete database entries in $ARCDIRS/ THAR.sdf and CUAR.sdf
   have been filled.  The first 10 and last 11 entries, which should be
   partially present, were completely omitted.  The database builder has
   been corrected to add the partial entries.
<LI>When using ech_idwave, in the case of one identified feature in an
   order, the program would crash when trying to determine the wavelength
   range for the order.  This bug has been removed.
<LI>Option 'M' in the ech_idwave task, order-processing menu, no longer
   crashes the program.
<LI>In the ech_idwave task, in the event of a wavelength polynomial being
   of such a low order that all points are fitted exactly (giving zero
   RMS error) the program no longer crashes on a divide-by-zero.
<LI>The interactive mode of ech_idwave, options '&lt;' and '&gt;' no-longer
   cause a crash when the display is not zoomed.
<LI>In the interactive mode of ech_idwave, option 'I' would work only
   once per option 'P' this has been fixed.
<LI>In the interactive mode of ech_idwave, option 'I', the list of nearby
   features is centred on the selected feature, rather than the next
   feature up in wavelength.
<LI>Arc line database files no longer have to have write access enabled.
   This means that files in $ARCDIRS do not have to be copied to an
   ECHOMOP user's working directory.
<LI>Several missing parameters have been added to the interface files.
<LI>An infinite loop on detection of bad columns or rows in ech_fcheck
   has been removed.
<LI>A divide-by-zero error in ech_ffield for local mean or median
   calculation has been removed.
<LI>In ech_ffield the calculation of local medians now uses the correct
   start point in the X-direction.  Previously, the median for the start
   point X-TUNE_FFLSMP rather than X-(TUNE_PFLSMP/2), was being used.
<LI>In ech_fitblz, a floating point overflow could occur when automatic
   fitting became unstable.  The overflows are now clipped.
<LI>The type of the parameter TUNE_SCFRACT was incorrectly set as _INTEGER.
   It is now _REAL.
<LI>Several internal changes to the scrunching routines have been made to
   prevent the scunched spectra being reflected in the wavelength axis,
   <I>i.e.</I>, all the fluxes being negative.
<LI>Errors in the sky modeller which would lead to attempted processing
   of points outside the bounds of an image have been removed.
<LI>The sky modeller now filters out bad-pixel values.
<LI>The object profile modeller now filters out bad-pixel values.
<LI>In several tasks, notably the extractions, weighting of the contribution
   from "boundary" pixels has been corrected to a smooth function.
   The function previously had two discontinuities at the top and bottom
   edges of the extraction channel - introducing a "jump" in some data.
<LI>Errors in the pixel-weighting scheme implementation and pixel selection
   in the blaze fitter have been removed.
<LI>ECHMENU Option 1.2 (ech_decos1) is now allowed to be an automated step.
   Previously the value of TUNE_CRTRC was always taken as FALSE in this
   case.  In the same way, Options 11.3 amd 11.4 now also work as elements
   in a TUNE_AUTOMATE request.

</UL>

Please report bugs in v3.2-0 to
<A HREF="mailto:ussc@star.rl.ac.uk,mjc@star.ucl.ac.uk">ussc@star.rl.ac.uk
and mjc@star.ucl.ac.uk</A>.
<P>

<A HREF="echelle.html"> Go back</A> to the EDR home page.<P>

<IMG SRC="gifs/pparc2.gif" ALT="|PPARC|">
&copy; 1996-1997 Particle Physics &amp; Astronomy Research Council.
<P>

<ADDRESS>
Martin Clayton<BR>
<A HREF="mailto:mjc@star.ucl.ac.uk">mjc</A>@<A
   HREF="http://www.star.ucl.ac.uk/">star</A>.<A
   HREF="http://www.ucl.ac.uk/">ucl</A>.ac.uk</A><BR>
Fri Apr 18 18:32:00 BST 1997
</ADDRESS>
</BODY>
</HTML>
