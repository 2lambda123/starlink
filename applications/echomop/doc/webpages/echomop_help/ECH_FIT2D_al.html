<HTML>
<HEAD>
<TITLE>
ECHOMOP Help: ECH_FIT2D_al.
</TITLE>
</HEAD>

<BODY>
<I>ECHOMOP-Online HELP</I>
<HR>
<B><A HREF="ECH_FIT2D.html">Previous topic</A></B>
 | <B><A HREF="echomop.html">ECHOMOP HELP page</A></B>
 | <B><A HREF="http://www.star.ucl.ac.uk/~mjc/echelle/">Starlink EDR home</A></B>
 | <B><A HREF="http://star-www.rl.ac.uk/documentation.html">Starlink Docs</A></B>
<HR><H2>Algorithm</H2><HR>
<P>
<PRE WIDTH=72>
 If any identified features then
    Copy polynomial degrees to local variables in case they are altered
    Generate coordinates of order trace
    Determine order of wavelength 1d polynomial
    Loop through each 'line' located and identified
       Determine line pixel-coords
       Loop from lower dekker to upper dekker pixel by pixel
          If y coord is on image then
            Loop Sampling line-width+5 values around estimated line
            position
              If lowest value so far, remember it
            End loop
            Copy local values into data array for fitting
            Try to fit a Gaussian of width line_width to the data
            If too far from first guess, reject it
            If we have obtained at least a marginal fit, then
          End if
       End loop
       Normalise the centroids around the mean value
    End loop
    Compose list a points to be fitted in 2D fit
    Loop until all points sorted into increasing order
     Loop through all points
       If pair of data triplets needs sorting then
         Exchange the pairs of data X,Y,F(x,y)
         Remember that at least one swap was made
       End if
     End loop
    End loop
    Remove any 'bad' data points
    Loop clipping and re-fitting
       Remove any clipped points ( weights set to -ve values )
       Remove all data for lines with Y=n for which there are less
       than w2_nxpoly+2 contributing data points.
       Fill the ancillary arrays required by the NAG surface fitting
       routines.
       Auto-reduce y degree of fit if necessary
       If still at least a one fifth of the original set
       if points remains then
         Fit a 2D Chebyshev to the surface
         Evaluate fit by calculating the residuals
         Calculate deviations from fit
         Determine RMS, max deviation, set acceptance if fit good enough
         Plot if enabled or automatically accepted
         Clip some more points from trace
       Else
          Abandon this orders' fit
       End if
    End loop
 Else
    Report non event
 End if
</PRE>
<P>
<P>
<HR>
<B><A HREF="ECH_FIT2D.html">Previous topic</A></B>
 | <B><A HREF="echomop.html">ECHOMOP HELP page</A></B>
 | <B><A HREF="http://www.star.ucl.ac.uk/~mjc/echelle/">Starlink EDR home</A></B>
 | <B><A HREF="http://star-www.rl.ac.uk/documentation.html">Starlink Docs</A></B>
<P>
<ADDRESS>
Martin Clayton<BR>
<A HREF="mailto:mjc@star.ucl.ac.uk">mjc@star.ucl.ac.uk</A><BR>
Mon Dec  4 15:45:45 1995
</ADDRESS>
</BODY>
</HTML>
