<HTML> <HEAD>
<TITLE> DUSTRING 
</TITLE>
</HEAD> <BODY>
 
<h1> DUSTRING - <br>
Correct image for dust rings
</h1>
<hr>

  Add and subtract the 'dustring' shadows of dust particles to and
  from an image.
<p>
 
  It is mainly useful for making a flat field match up to the desired flat
  field when a dust particle has blocked part of the image from complete
  illumination since the flat field was made.
  Likewise, by subtracting a ring, the flat can be corrected to before
  the particle fell.
<p>
 
  It is useful for combining flats with different flat field dustrings.
<p>
 
  It displays the image so that you can see wheat you are doing
  and uses the 'panel' push-buttons, but it also can be run without
  an image display.
<p>
 
 
 
Go to <a href="intro.html#dustring_back"> Starman Help </a><br>
Go to <a href="main.html"> Starman Help Main. </a>
 
<hr>
<h2> Index </h2>
 
<ul>
<li> 1 <a href="#use"> Use </a>
<li> 2 <a href="#choosing_options"> Choosing options </a>
<li> 3 <a href="#profile"> Profile </a>
<li> 4 <a href="#output_image"> Output image </a>
<li> 5 <a href="#output_table"> Output table </a>
<li> 6 <a href="#parameters"> Parameters </a>
<li> 7 <a href="#author"> Author </a>
</ul>
 
<hr>
 <h2> 1 <a name="use"> Use </h2> </a> <p>
 
 
  The program is a looping one, where you can repeatedly choose various
  options.
<p>
 
  Basically, you select a dustring, and manually by trial and error
  you adjust the position and background level for a theoretical ring
  which you then add or subtract from the image.
<p>
 
  The ring is added/subtracted as:-
<p>
 
            (Background Level) x (Profile(xo,yo))
<p>
 
    where Profile(x,y)     is a fixed profile which is a function of
                           X and Y, and is a percent of the background
                           level.
<p>
 
                xo,yo      is the position of the ring.
<p>
 
      Background Level     is the local background level at the ring
<p>
 
  The ring profile will have previously be determined, again by trail
  and error. (See help subsection on profile.)
<p>
 
  When you are happy with the position, profile, and background level,
  you can also store those parameters in the working table.
<p>
 
  When you done all the adding/subtraction, you can store the output
  image.
<p>
 
  You can also note into a table any ring you wish, and this table can
  later be output to a file. It would contain the parameters of the rings
  and will only have those rings actually noted, which is NOT necessarily
  the same as those added/subtracted from the image.
<p>
 
<hr>
 <h2> 2 <a name="choosing_options"> Choosing options </h2> </a> <p>
 
 
   In the looping mode, you are faced with a menu of actions to
   choose from.
<p>
 
   When using the image display, the looping options request can come
   through a 'panel' displayed in the display, with buttons to 'press'
   to select options.  Six lines of help are displayed as each button is
   pointed at. This mode is selected by choosing the 'panel'
   option.
<p>
 
   Choice of actions to do:-
<p>
<pre>
 
     Choice      Function
     ------      --------
     add           Add a ring of standard profile at position set
     bk_auto       Toggle the method of calculating the local level
     bk_ground     Input the level for the background
     bk_level      Measure local level - perhaps load into default
     bk_load       Toggle between loading background measure and not
     bk_size       Set the size of the area used to find background
     clear         Clear screen
     close         Close the display screen
     cursor        Add or subtract a set ring at cursor position
     cvalues       Show the cursor position and image pixel value
     display       Display image
     exit          Exit from this program
     flash         Display image in standard way
     im_get        Input new image
     im_reload     Load original input image into present image
     im_store      Output present image into a disk file
     open          Open the display screen
     panel         Switch between panel and keyboard option selection
     position      Set position via keyboard
     profile       Set the parameters of the ring profile
     reset         Reset zoom/pan to unity and centre
     show          Print out the ring paramaters and present controls
     subtract      Subtract a ring of set profile at position set
     tb_apply      Add or subtract rings from the input table
     tb_clear      Clear the table of set rings
     tb_get        Extract a ring from the table, ready for use
     tb_list       List the present contents of the set rings table
     tb_load       Load a table of set rings from a file
     tb_put        Put present ring parameters into table
     tb_store      Store present table of rings into a disk file
     tb_use        Set whether to use a particular ring in the table
     zoom          Zoom and pan image by using mouse location

</pre><p>
 
 
  For the zooming and panning, the mouse buttons have a complex
  mode of operation
<p>
 
   Buttons for Cursor add/subtract work:
                           Button 1 = add
                           Button 2 = subtract
                           Button 3 = exit
   Buttons for Zoom work:  Button 1 twice        = zoom /2
                           Button 2 twice        = zoom x2
                           Button 1 and Button 2 = pan
                           Button 3 twice        = exit
   Buttons for Cvalues work:
                           any button            = exit,
<p>
 
<hr>
 <h2> 3 <a name="profile"> Profile </h2> </a> <p>
 
 
   The profile is shaped like this:-
<p>
 
      xxxxxxxxxxxxx              xxxxxxxxxxxx              xxxxxxxxxxx
                   x            x            x            x
                    xxxxxxxxxxxx              xxxxxxxxxxxx
<p>
 
    Where the shape is determined by the parameters
<p>
 
       PERCENT     Percentage drop into shadow (in terms of local
                                                background)
       RIN         Inner radius of deep part of ring
<p>
 
       ROUT        Outer radius of deep part of ring
<p>
 
       SLOPEIN     Inwards distance from RIN to location of no shadow area
<p>
 
       SLOPEOUT    Outwards distance from ROUT to location of no shadow area
<p>
 
<hr>
 <h2> 4 <a name="output_image"> Output image </h2> </a> <p>
 
 
  The output image is a copy of the input image, with rings added
  and subtracted.
<p>
 
<hr>
 <h2> 5 <a name="output_table"> Output table </h2> </a> <p>
 
 
   Optionally, an output table, storing the parameters of the rings,
   can be stored.
<p>
 
   The contents are the parameter for each ring:-
<p>
 
      Column    Header          Content
      ------    -------         -------
        1         'X'            X position of centre
        2         'Y'            Y position of centre
        3         'BACK'         Background level in image
        4         'PERCENT'      Percentage of background ring drops
        5         'RIN'          Radius of inner edge of deep ring
        6         'ROUT'         Radius of outer edge of deep ring
        7         'SLOPEIN'      Distance covered by inner penumbra
        8         'SLOPEOUT'     Distance covered by outer penumbra
        9         'USE'          Flag for use this ring (0=yes:1=no)
<p>
 
   Only those rings actually 'noted' will be in this table. It does
   not passively record all those added or subtracted. from the image
<p>
 
 
<hr>
 <h2> 6 <a name="parameters"> Parameters </h2> </a> <p>
 
<ul>
<li> 6.1 <a href="#back"> Back </a>
<li> 6.2 <a href="#do_add"> Do&#95 add </a>
<li> 6.3 <a href="#imcomp"> Imcomp </a>
<li> 6.4 <a href="#imposn"> Imposn </a>
<li> 6.5 <a href="#in"> In </a>
<li> 6.6 <a href="#intab"> Intab </a>
<li> 6.7 <a href="#number"> Number </a>
<li> 6.8 <a href="#numbutt"> Numbutt </a>
<li> 6.9 <a href="#option"> Option </a>
<li> 6.10 <a href="#out"> Out </a>
<li> 6.11 <a href="#outtab"> Outtab </a>
<li> 6.12 <a href="#percent"> Percent </a>
<li> 6.13 <a href="#posn"> Posn </a>
<li> 6.14 <a href="#rin"> Rin </a>
<li> 6.15 <a href="#rout"> Rout </a>
<li> 6.16 <a href="#screen"> Screen </a>
<li> 6.17 <a href="#side"> Side </a>
<li> 6.18 <a href="#slopein"> Slopein </a>
<li> 6.19 <a href="#slopeout"> Slopeout </a>
<li> 6.20 <a href="#title"> Title </a>
<li> 6.21 <a href="#use"> Use </a>
<li> 6.22 <a href="#vrange"> Vrange </a>
<li> 6.23 <a href="#wrap"> Wrap </a>
</ul>
 
 
<hr>
 <h2> 6.1 <a name="back"> Back </h2> </a> <p>
 
  (Default - 1.0            Range -1.0e10 to 1.0e10)
<p>
 
   The local background level for the ring to use when being
   added or subtracted.
<p>
 
<hr>
 <h2> 6.2 <a name="do_add"> Do&#95 add </h2> </a> <p>
 
  (Default - 'add'            Choice - 'add:sub')
<p>
 
  Add or subtract all the rings, in the list of rings, to the
  image?
<p>
 
<hr>
 <h2> 6.3 <a name="imcomp"> Imcomp </h2> </a> <p>
 
  (Default - variable, usually 1,1     -     Range - 1 to 1000)
<p>
 
  Factor in X and Y by which to compress the displayed image.
<p>
 
<hr>
 <h2> 6.4 <a name="imposn"> Imposn </h2> </a> <p>
 
  (Default - so as to centre image in screen
   Range -  -100000 to 100000)
<p>
 
  Place to put b.l.h. corner of displayed image onto the
  screen. Thus an answer of `1,1' would put the b.l.h. pixel
  of the displayed image at the b.l.h corner of the screen.
<p>
 
<hr>
 <h2> 6.5 <a name="in"> In </h2> </a> <p>
 
  (Default - null)
<p>
 
  The name of the input image file.
<p>
 
  This must be a Starman NDF 'short' integer*2 16-bit or 'real'
  real*4 32-bit image.
<p>
 
<hr>
 <h2> 6.6 <a name="intab"> Intab </h2> </a> <p>
 
  (Default - null)
<p>
 
  The name of the input file containing the list of rings.
<p>
 
  This must have 9 columns and up to 1000 rows. The contents
  must be in the format of a table output from this program
  via the 'OUTTAB' parameter.
<p>
 
  This must be a Starman NDF table format file.
<p>
 
<hr>
 <h2> 6.7 <a name="number"> Number </h2> </a> <p>
 
  (Default - 1          Range - 1 to Number of rings input)
<p>
 
  The number in the working table of the wanted ring.
<p>
 
<hr>
 <h2> 6.8 <a name="numbutt"> Numbutt </h2> </a> <p>
 
  (Default - see below          Range - 2 to 3)
<p>
 
  Number of `X-Window' buttons available on the mouse.
<p>
 
  Some devices have two and some have three buttons available. This
  can depend both on their actual presence, and also on the X Windows
  software that is being run.
<p>
 
  With three buttons, then the Starman programs use all three, with
  the right-hand button being used mainly as the 'exit' button.
<p>
 
  With two buttons, then the third button is simulated by pressing
  both of the buttons down, with the middle one being pressed slightly
  BEFORE the left-hand one. Use of the middle button in its normal
  way has to be modified, in that one has to pause for half a second
  after using it.
<p>
 
  [This parameter is usally 'hidden', with the machine manager setting
   it to the appropriate value for the local set-up. Sometimes it will
   be left to the user to set, depending on his software configuartion.]
<p>
 
<hr>
 <h2> 6.9 <a name="option"> Option </h2> </a> <p>
 
  (Default - last choice      Choice - see below)
<p>
 
   In the looping mode, you are faced with a menu of actions to
   choose from.
<p>
 
   When using the image display, the looping options request can come
   through a 'panel' displayed in the display, with buttons to 'press'
   to select options.  Six lines of help are displayed as each button is
   pointed at. This mode is selected by choosing the 'panel'
   option.
<p>
 
   Choice of actions to do:-
<p>
<pre>
 
     Choice      Function
     ------      --------
     add           Add a ring of standard profile at position set
     bk_auto       Toggle the method of calculating the local level
     bk_ground     Input the level for the background
     bk_level      Measure local level - perhaps load into default
     bk_load       Toggle between loading background measure and not
     bk_size       Set the size of the area used to find background
     clear         Clear screen
     close         Close the display screen
     cursor        Add or subtract a set ring at cursor position
     cvalues       Show the cursor position and image pixel value
     display       Display image
     exit          Exit from this program
     flash         Display image in standard way
     im_get        Input new image
     im_reload     Load original input image into present image
     im_store      Output present image into a disk file
     open          Open the display screen
     panel         Switch between panel and keyboard option selection
     position      Set position via keyboard
     profile       Set the parameters of the ring profile
     reset         Reset zoom/pan to unity and centre
     show          Print out the ring paramaters and present controls
     subtract      Subtract a ring of set profile at position set
     tb_apply      Add or subtract rings from the input table
     tb_clear      Clear the table of set rings
     tb_get        Extract a ring from the table, ready for use
     tb_list       List the present contents of the set rings table
     tb_load       Load a table of set rings from a file
     tb_put        Put present ring parameters into table
     tb_store      Store present table of rings into a disk file
     tb_use        Set whether to use a particular ring in the table
     zoom          Zoom and pan image by using mouse location
 
   Buttons for Cursor add/subtract work:
                           Button 1 = add
                           Button 2 = subtract
                           Button 3 = exit
   Buttons for Zoom work:  Button 1 twice        = zoom /2
                           Button 2 twice        = zoom x2
                           Button 1 and Button 2 = pan
                           Button 3 twice        = exit
   Buttons for Cvalues work:
                           any button            = exit,

</pre><p>
 
<hr>
 <h2> 6.10 <a name="out"> Out </h2> </a> <p>
 
  (Default - null)
<p>
 
  The name of the output image file. This holds a copy of
  the input image with the effect of all rings that have been added
  or subtracted.
<p>
 
  This is either a 'short' integer*2 16-bit or 'ral' real*4 32-bit
  Starman NDF format image, with BZERO, BSCALE and INVAL/RINVAL
  from the input image.
<p>
 
<hr>
 <h2> 6.11 <a name="outtab"> Outtab </h2> </a> <p>
 
  (Default - null)
<p>
 
   The output table, storing the parameters of the rings noted.
<p>
 
   This is a Starman table format file.
<p>
 
   The contents are the parameter for each ring:-
<p>
 
      Column    Header          Content
      ------    -------         -------
        1         'X'            X position of centre
        2         'Y'            Y position of centre
        3         'BACK'         Background level in image
        4         'PERCENT'      Percentage of background ring drops
        5         'RIN'          Radius of inner edge of deep ring
        6         'ROUT'         Radius of outer edge of deep ring
        7         'SLOPEIN'      Distance covered by inner penumbra
        8         'SLOPEOUT'     Distance covered by outer penumbra
        9         'USE'          Flag for use this ring (0=yes:1=no)
<p>
 
   Only those rings actually 'noted' will be in this table. It does
   not passively record all those added or subtracted. from the image
<p>
 
<hr>
 <h2> 6.12 <a name="percent"> Percent </h2> </a> <p>
 
   (Default - 0.5 or last value       Range -  0 to ?)
<p>
 
   The percentage dip into the deep part of the ring profile,
   in terms of the defined background level
<p>
 
<hr>
 <h2> 6.13 <a name="posn"> Posn </h2> </a> <p>
 
  (Default - Centre or last position           Range - -1.0e10 to 1.0e10)
<p>
 
   The X,Y position to put the ring at.
<p>
 
<hr>
 <h2> 6.14 <a name="rin"> Rin </h2> </a> <p>
 
  (Default - 8.0 or last value       Range - 0.0 to 1.0e8)
<p>
 
   The radius at the inner ring edge of the deep part of the ring.
<p>
 
<hr>
 <h2> 6.15 <a name="rout"> Rout </h2> </a> <p>
 
  (Default - 12.0 or last value       Range - 0.0 to 1.0e8)
<p>
 
   The radius at the outer ring edge of the deep part of the ring.
<p>
 
<hr>
 <h2> 6.16 <a name="screen"> Screen </h2> </a> <p>
 
  (Default - 1, size of image      Range - 1 to large)
<p>
 
  Size of screen or window to open.
<p>
 
  The default size is that of the image, unless the image is too large
  to fit on the screen, when the image will be binned down by an integer
  factor for display. The default size will then be this binned down size.
<p>
 
<hr>
 <h2> 6.17 <a name="side"> Side </h2> </a> <p>
 
  (Default - 5 or last value           Range -  3 to size of image)
<p>
 
   The size of the side of the box, about the last defined
   position, to define the area in which to find the local level.
<p>
 
<hr>
 <h2> 6.18 <a name="slopein"> Slopein </h2> </a> <p>
 
  (Default - 1.0 or last value           Range -  3 to size of image)
<p>
 
   Inwards distance from RIN to location of no shadow area.
<p>
 
   (The inner penumbra of the shadow.)
<p>
 
<hr>
 <h2> 6.19 <a name="slopeout"> Slopeout </h2> </a> <p>
 
  (Default - 3.0 or last value           Range -  3 to size of image)
<p>
 
 
   Outwards distance from ROUT to location of no shadow area.
<p>
 
   (The outer penumbra of the shadow.)
<p>
 
<hr>
 <h2> 6.20 <a name="title"> Title </h2> </a> <p>
 
  (Default - input image title        Choice - any)
<p>
 
   The title to apply to the output image or table
<p>
 
<hr>
 <h2> 6.21 <a name="use"> Use </h2> </a> <p>
 
  (Default - default                  Choice - `yes:no')
<p>
 
 Is this ring to be used?
<p>
 
 The default is 'yes' if not used before, or the last flag for
 this ring.
<p>
 
<hr>
 <h2> 6.22 <a name="vrange"> Vrange </h2> </a> <p>
 
  (Default - suggested values              Range - -1.0e10 to 1.0e10)
<p>
 
  The range of values to be displayed as black to white on the image
  display.
<p>
 
<hr>
 <h2> 6.23 <a name="wrap"> Wrap </h2> </a> <p>
 
  (Default - `no'        \hspace{4ex}    Choice - `yes:no')
<p>
 
 When displaying image on image display, for those image pixel values that
 lie above or below the display values for white or black, do you want
 these values to be shown as white or black (`no'), or do you want them to
 be `wrapped' round - that is considered as modulo the display range
 (`yes')?
<p>
 
 
<hr>
 <h2> 8 <a name="author"> Author </h2> </a> <p>
 
         A.J.Penny  RAL             1990-10-05
<p>
 

<hr>
All rights reserved. &copy 1995 RAL. Starlink conditions and disclaimers apply.
  
<hr>
 
<address>
<a href="http://ast.star.rl.ac.uk/dev/ajp_page.html">
Alan J Penny </a>
 - <a href="http://www.rl.ac.uk/rutherford.html">
 Rutherford Appleton Laboratory </a> (RAL) </address>
<i> a.j.penny@rl.ac.uk </i> -
<i> This page last modified: 1994 Dec 20 </i>
 
