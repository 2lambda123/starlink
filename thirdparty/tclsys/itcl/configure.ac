dnl    Process this file with autoconf to produce a configure script
AC_REVISION($Revision$)

dnl    Initialisation: package name and version number
AC_INIT(itcl, 3.1.0, ussc@star.rl.ac.uk)

dnl    Require autoconf-2.50 at least
AC_PREREQ(2.50)
dnl    Require Starlink automake
AM_INIT_AUTOMAKE(1.8.2-starlink)

dnl    Sanity-check: name a file in the source directory -- if this
dnl    isn't found then configure will complain
AC_CONFIG_SRCDIR([tcl.m4])

dnl    Include defaults for Starlink configurations
STAR_DEFAULTS

STAR_DECLARE_DEPENDENCIES([build], [tcl tk])

dnl    Locate a suitable Tcl/Tk
STAR_CHECK_PROGS(tcl,Tcl_AppInit)
STAR_CHECK_PROGS(tk,Tk_Init)

dnl    We may want to invoke make recursively
AC_PROG_MAKE_SET

dnl    Define subdirectories which need to be recursed into
itcl_subdirs="itcl itk iwidgets2.2.0 iwidgets3.0.0"
AC_SUBST(itcl_subdirs)

dnl    To configure iTcl, run ./configure in the subdirectories.

#  Look for --disable-shared and pass it on.
star_extra_items=
for ac_arg in $ac_configure_args; do
   case $ac_arg in 
      *-disable-shared*)
         star_extra_items="--disable-shared"
      ;;
   esac
done
export star_extra_items
(
    for d in $itcl_subdirs
    do
       ( cd $d; \
         cmd="./configure --prefix=$prefix \
                          --srcdir=. \
                          $star_extra_items \
                          --cache-file=../config.cache"; \
         echo $cmd; \
         $cmd; ) \
    done
)
           
STAR_SPECIAL_INSTALL_COMMAND([
        for d in @itcl_subdirs@;
        do
           ( cd $$d; $(MAKE) INSTALL_ROOT=$$DESTDIR install );
        done])

AC_CONFIG_FILES([Makefile component.xml])

AC_OUTPUT
