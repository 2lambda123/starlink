      SUBROUTINE FILLIN
C
      SAVE
      COMMON /ISOSR2/ LX         ,NX         ,NY         ,ISCR(8,128),
     1                ISCA(8,128)
      COMMON /ISOSR5/ NBPW       ,MASK(16)   ,GENDON
      LOGICAL         GENDON
      COMMON /ISOSR7/ IENTRY     ,IONES
C
      IF (IENTRY .EQ. 0) RETURN
C
C  THIS IS A SHADING ALGORITHM IT IS USED TO DETERMINE CONTOUR LINES
C  THAT ARE HIDDEN BY THE PRESENT LINE. THE ALGORITHM PROCESSES
C  HORIZONTAL ROWS. IT ASSUMES THAT THE BIT PATTERN PASSED TO IT
C  HAS ONLY BITS SET TO MARK THE START AND END OF SHADING. THE
C  ALGORITHM ALSO ASSUMES THAT WHEN AN ON BIT IS ENCOUNTERED THAT A
C  CORRESPONDING OFF BIT IS INCLUDED IN THE SAME ROW.
C
C
C  PULL OUT ROWS OF THE CONTOUR PATTERN
C
      IBVAL = 0
      DO  80 IYNOW=1,NY
         DO  40 IXNOW=1,LX
C
C  IF NO ACTIVATED BITS BRANCH
C
            ICRWD = ISCR(IXNOW,IYNOW)
            IF (ICRWD .EQ. 0) GO TO  30
C
C  ACTIVATED BITS IN WORD SET SHADING FLAG
C
C  CHECK BIT BY BIT FOR ON/OFF FLAGS
C
            DO  20 IB=1,NBPW
               IBIT = (NBPW+1)-IB
C
C
C  PULL OUT THE CURRENT GRID POINT VALUE
C
               IVAL = IAND(ICRWD,MASK(IBIT))
C
C  IF IVAL SET, THIS IS AN ON/OFF FLAG
C
               IF (IVAL .EQ. 0) GO TO  10
C
C  FLAG BIT, ALWAYS SET
C
               IBVAL = MOD(IBVAL+1,2)
               GO TO  20
C
C  SHADE THE SCREEN ACCORDING TO THE STATUS OF IBVAL
C
   10          IF (IBVAL .NE. 0) ICRWD = IOR(ICRWD,MASK(IBIT))
C
   20       CONTINUE
C
C  ZERO OUT THE SCREEN
C
            ISCR(IXNOW,IYNOW) = 0
            ISCA(IXNOW,IYNOW) = IOR(ICRWD,ISCA(IXNOW,IYNOW))
            GO TO  40
C
   30       IF (IBVAL .NE. 0) ISCA(IXNOW,IYNOW) = IONES
   40    CONTINUE
C
C  FIX FOR NONCORRECTABLE RUNAWAYS
C
         IF (IBVAL .EQ. 0) GO TO  80
         IBVAL = 0
         DO  70 K=1,LX
            ITEST = 0
            IF (IYNOW .EQ. 1) GO TO  50
            ITEST = ISCA(K,IYNOW-1)
            IF (IYNOW .EQ. NY) GO TO  60
   50       ITEST = IOR(ITEST,ISCA(K,IYNOW+1))
   60       ISCA(K,IYNOW) = ITEST
   70    CONTINUE
C
   80 CONTINUE
      RETURN
      END
