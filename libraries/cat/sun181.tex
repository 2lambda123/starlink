\documentclass[11pt,twoside]{starlink}
%
% CAT Catalogue and Table Manipulation Library: Programmer's Manual

% Copyright 2000 Council for the Central Laboratory of the Research
% Councils.

% This document is offered in good faith.  However, no guarantee or
% warranty whatsoever is offered or implied.  Neither myself, the
% University of Edinburgh nor the Particle Physics and Astronomy
% Research Council accept any responsibility for loss, damage or injury
% resulting from the use of this document.

% A.C. Davenhall,
% 9th October 1995.

%-------------------------------------------------------------------

%
% Set the CAT version number.

\providecommand{\CATversion}{9.0~}

%
% Commands for displaying sexagesimal angles.

\providecommand{\tmin}   {\mbox{$^{\rm m}\!\!.$}}
\providecommand{\hm}[3] {$#1^{\rm h}\,#2\tmin#3$}
\providecommand{\dm}[2] {$#1^{\circ}\,#2\raisebox{-0.5ex}{$^{'}$}$}
\providecommand{\arcmin} {\raisebox{-0.5ex}{$^{'}$} }

\providecommand{\arcsec} {$\hspace{-0.05em}\raisebox{-0.5ex}
                     {$^{'\hspace{-0.1em}'}$}
                     \hspace{-0.7em}.\hspace{-0.05em}$}
\providecommand{\tsec}   {\mbox{$^{\rm s}\!\!.$}}
\providecommand{\hms}[4] {$#1^{\rm h}\,#2^{\rm m}\,#3\tsec#4$}
\providecommand{\dms}[4] {$#1^{\circ}\,#2\raisebox{-0.5ex}{$^{'}$}\,#3\arcsec#4$}


%-------------------------------------------------------------------

% ? Document identification
\stardoccategory    {Starlink User Note}
\stardocinitials    {SUN}
\stardocsource      {sun\stardocnumber}
\stardoccopyright
{Copyright \copyright\ 2001 Council for the Central Laboratory of the Research Councils}

\stardocnumber      {181.12}
\stardocauthors     {A.C.~Davenhall \& D.S.~Berry}
\stardocdate        {27th July 2020}
\stardoctitle       {CAT \\ [\latex{1ex}]
                              Catalogue and Table Manipulation Library}
\stardocversion     {Version \CATversion\ }
\stardocmanual      {Programmer's Manual}
\stardocabstract{%
CAT is the Starlink Fortran subroutine library for manipulating
astronomical catalogues and similar tabular datasets. This manual is
intended for programmers who plan to write applications which use the
CAT library to manipulate such datasets. It is introductory in the
sense that it contains sufficient information to enable a programmer new
to the CAT library to write applications which use it. The version of
the library intended for use in conjunction with the Starlink ADAM
programming environment is described. All the subroutines in the
interface to the library are covered. However, the principles underlying
the library, and their justification, are described only insofar as they
affect its use.
}
% ? End of document identification

%  Title Page.
%  ===========
\begin{document}
\scfrontmatter

\subsection*{Readership}

This manual is intended for programmers who wish to use the Starlink
CAT subroutine library to manipulate astronomical catalogues and
similar tabular datasets. The reader is assumed to be familiar with the
following: standard Fortran 77 and the extensions permitted by Starlink,
Starlink programming practices and procedures and the various packages
and libraries of the ADAM programming environment.


\subsection*{How to use this document}

You will not usually need to read this document from beginning to end in
order to use the CAT subroutine library. The document is divided into
three parts:

\begin{description}

   \item[{\rm Part I}] -- Preliminaries,

  \item[{\rm Part II}] -- Tutorial,

  \item[{\rm Part III}] -- Reference.

\end{description}

Part~I contains some preliminary details, such as an introduction to
the terminology of CAT and details of how to access the library.
Part~II is a tutorial example of how to write a simple application which
accesses the library and Part~III contains reference material which
describes the library.

If the CAT library is new to you, you should start by reading Part~I
and working through the tutorial in Part~II. Finally, read
Section~\ref{COMP} of Part III, but skipping the detailed descriptions
of individual attributes.

If you are already familiar with the library you should consult the
reference material in Part~III, and probably also the details in
Section~\ref{START} of Part I, as necessary.


\subsection*{Assistance and further information}

I am happy to answer queries about using the CAT subroutine library
and to receive comments or suggestions about how it could be improved.
Details of how to contact me are included below.

\vspace{2mm}

Clive Davenhall.

\vspace{2mm}

Postal address: Institute for Astronomy, Royal Observatory, Blackford Hill,
Edinburgh, \\
\begin{tabular}{l}
EH9 3HJ, United Kingdom.  \\
\end{tabular}

Electronic mail: \texttt{acd@roe.ac.uk}

Fax: \\
\begin{tabular}{lr}
from within the United Kingdom: &    0131-668-8416 \\
from overseas:                  & +44-131-668-8416 \\
\end{tabular}

\vspace*{\fill}
\stardoccopyright

\newpage
\subsection*{Acknowledgments}

The CAT subroutine library is far from being all my own work. Its
specification evolved during extensive discussions with (alphabetically)
Dave~Giaretta, Clive~Page, Rodney~Warren-Smith and Alan~Wood, all of
whom have contributed substantially to its final form. Also, at various
times, Brian~Read, Malcolm~Currie and Steven~Beard have made useful
comments.

Clive~Page wrote the expression parser which CAT uses and
Appendix~\ref{EXPR} is based on documentation which he supplied. CAT
accesses FITS tables through Bill~Pence's FITSIO subroutine library
and CHI/HDS catalogues through Alan Wood's CHI subroutine library.

Martin~Bly assisted in preparing the Unix version for release.
Alan~Wood, Malcolm~Currie and Peter~Draper tested a pre-release version
and suggested several useful improvements.

I am grateful to all these people for sharing their time and expertise.
\begin{flushright}
Clive Davenhall \\
\latex{\raggedright} \textit{Department of Physics and Astronomy, University of
Leicester \\
Saint Edmund's Day 1994}
\end{flushright}

\newpage
\subsection*{Revision history}

\begin{enumerate}

  \item 23rd June 1994: Original draft (ACD).

  \item 9th October 1995: Version 1 (ACD).

  \item 12th April 1996: Version 2.  Modified so that the Latex source
   could be used to create an HTML as well as a paper version (ACD).

  \item 23rd January 1997: Version 3.  Modified for release 3.1 of the
   CAT library.  The major change was the addition of support for the
   Small Text List (STL) catalogue format (ACD).

  \item 12th June 1997: Version 4.  Modified for release 4.1 of the
   CAT library.  There are no major enhancements in this release, just
   some bug fixes.  Perhaps the most important of these is the ability
   to handle catalogue file names longer than fifteen characters (ACD).

  \item 9th November 1997: Version 5.  Modified for release 4.2 of the
   CAT library.  There are no major enhancements in this release, just
   a couple of bug fixes and some minor revisions to the document (ACD).

  \item 11th June 1998: Version 6.  Modified for release 5.1 of the
   CAT library.  There were major internal changes to the CAT library
   in order to speed it up and to reclaim internal work-space for
   reuse when a catalogue is closed.  Most of these changes should
   not be visible to the user (except that the library should be
   somewhat faster).  One visible change is that the capitalisation
   of the file type specified by the user when a new catalogue is
   opened is now preserved.  One new routine has been added: \texttt{CAT\_IINQ} (ACD).

  \item 26th November 1998: Version 7.  Modified for release 6.1 of the
   CAT library.  The major enhancement to the library in this release
   was additional features for reading sexagesimal angles from STL
   format catalogues.  Rather than document these features here the
   entire description of the STL format was removed.  The STL format
   is now documented solely in the CURSA manual, \xref{SUN/190}{sun190}{}.
   This rationalisation removes a duplication which was becoming
   increasingly cumbersome.  Release 6.1 also includes some further
   improvements to the error reporting (ACD).

  \item 15th November 1999: Version 8. Modified for release 7.1 of the
   CAT library.  The major change was the addition of support for the
   Tab-Separated Table (TST) catalogue format.  All references to
   the VAX/VMS version of CAT were removed from the manual (ACD).

  \item 16th July 2000: Version 9.  Modified for release 7.2 of the
   CAT library.  There are no major enhancements in this release, just
   some bug fixes and minor changes, most notably to the implementation
   of the Tab-Separated Table (TST) format.  There are also some minor
   revisions to the document (ACD).

  \item 4th April 2001: Version 10.  Modified for release 8.1 of the
   CAT library.  Support for the CHI/HDS catalogue format has been removed
   from this version of the library.  There are also a few bug fixes and
   some minor revisions to the document (ACD).

  \item 17th January 2017: Modified for release 8.4 of the CAT library.
   Catalogues can now be stored in files with names that include
   non-alphanumeric characters. (DSB)

  \item 27th July 2020: Modified for release 9.0 of the CAT library.
   Null values are no longer supported for _LOGICAL columns. (DSB)

\end{enumerate}


\part{Preliminaries}


\section{\label{INTRO}\xlabel{INTRO}Introduction}

\begin{quote}
\begin{center}
A harmless necessary cat.
\end{center}
\textit{The Merchant of Venice} \latex{\raggedleft}
\end{quote}
% Dictionary of Quotations: p202:4


CAT is the Starlink subroutine library for manipulating astronomical
catalogues and similar tabular datasets. This manual provides you with
the information necessary to write applications which use it. The manual
describes version \CATversion of CAT. CAT is written in Fortran
and is part of the Starlink ADAM programming environment. It conforms
to all relevant Starlink standards and provides the facilities normally
associated with ADAM libraries. A stand-alone version separate from ADAM
is possible, but is not described here. Version \CATversion of CAT is
available on all the variants of Unix supported by Starlink.  The Fortran
subroutine interface is identical in all these cases.

CAT provides basic facilities to:

\begin{itemize}

  \item create,

  \item write,

  \item read

\end{itemize}

catalogues and tabular datasets. Unlike most similar Starlink libraries
it supports catalogues held in various different formats. Currently the
formats supported are:

\begin{itemize}

  \item FITS tables (both ASCII and binary),

  \item STL (Small Text List; simple lists in text files),

  \item TST (Tab-Separated Table; tab-separated lists in text files).

\end{itemize}

There are idiosyncrasies and limitations associated with each of these
formats and they are described in Appendix~\ref{FORMAT}.


\section{\label{TERM}\xlabel{TERM}Terminology}

\begin{quote} \latex{\raggedright}
`When \textit{I}\, use a word,' Humpty Dumpty said, in a rather scornful
tone, `it means just what I choose it to mean --- neither more nor
less.' \\
\textit{Through the Looking-Glass and What Alice Found There} \latex{\raggedleft}
\\ Lewis Carroll
\end{quote}

An astronomical \textbf{catalogue} is basically a \textbf{table} of values,
consisting of the measurements of the same property for a set of
objects, together with the auxiliary information necessary to describe
this table. There are several different terminologies for describing
the elements of such tables. In this manual a terminology which
corresponds loosely to that used intuitively for the paper versions of
astronomical catalogues is used:

\begin{description}

  \item[row] the values for all the properties associated with some
   particular object,

  \item[column] the value of a single property for all the objects in
   a catalogue,

  \item[field] the value of a single property for a single object
   (that is, the intersection of a row and a column).

\end{description}

Some of the other terminologies are shown for comparison in
Table~\ref{TABLE_NOT}\footnote{This table is adapted from \textit{Database Systems in Science and Engineering}\, by J.R.~Rumble and
F.J.~Smith\cite{RUMBLE}, p158.}.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{lll}
CAT               &  Fortran           &  Relational Database \\ \hline
table             &  file              &  relation      \\
row               &  record            &  tuple         \\
column            &  field             &  attribute     \\
field             &  data item, field  &  component     \\
format            &  format            &  schema        \\
number of columns &  number of fields  &  arity, degree \\
number of rows    &  number of records &  cardinality   \\
\end{tabular}
\end{center}

\caption{\label{TABLE_NOT}Alternative terminologies for the components of
tables}

\end{table}

In the CAT library each \textbf{catalogue} can contain only one \textbf{table} and the two terms can usually be used interchangeably without
introducing any ambiguity. However, where it is necessary to
differentiate between the two sorts of entities, \textbf{table} is used
to denote the simple matrix of rows and columns and \textbf{catalogue} is
used to denote the combination of a table and its associated auxiliary
information. Note that this usage implies nothing about the contents
of the catalogue; it may contain a published astronomical catalogue, a
set of private astronomical results or, indeed, data which are entirely
non-astronomical.

In CAT the auxiliary information which applies to the entire catalogue
comprises an arbitrary number of \textbf{parameters}. Each parameter
comprises a single datum. Examples might be the epoch or equinox of
celestial coordinates stored in a catalogue. CAT parameters are
similar to FITS keywords (in fact, CAT interprets named keywords in
a FITS table as parameters).

Columns and parameters both have a number of \textbf{attributes}, such
as their name and data type. A full list of the attributes of
columns and parameters is given in Sections~\ref{COLS} and
\ref{PARS} respectively, though normally you will only need to
manipulate a few of them.  All columns have the same set of attributes
(though they take different values, of course) and similarly all
parameters have the same set of attributes.

Columns may either be \textbf{scalars} in which case each field comprises
a single datum, or \textbf{vectors}, one-dimensional arrays where each
field comprises a one-dimensional array of values. Parameters may only
be scalars.

This section has introduced the terminology for the more important
items in a CAT catalogue. Section~\ref{COMP} contains a more extensive
discussion.


\section{\label{START}\xlabel{START}Getting started}

CAT is an optional Starlink software item. Before proceeding you should
check with your local site manager whether it is installed at your site,
and if not attempt to persuade him to install it.

Version \CATversion of CAT comprises a subroutine library and two INCLUDE
files.  In addition, the CAT-EXAMPLES package provides five simple
applications which are either examples of how to write CAT applications
or simple utilities to examine catalogues (\textit{cf}\, the \texttt{hdstrace}
utility for examining HDS files). To write programs which use CAT you
should have access to the library, the INCLUDE files and the CAT-EXAMPLES
package.  Some of the CAT-EXAMPLES applications serve as examples in
Part~II of this manual.

You do not need any special quotas or privileges to use CAT.


\subsection{\label{ACCESS}Accessing CAT-EXAMPLES}

The following description applies to all the variants of Unix supported
by Starlink.  Simply type:

\begin{terminalv}
source /star/bin/examples/cat/cat-examples.csh
\end{terminalv}

The following message should appear:

\begin{terminalv}
CAT example programs now available -- (for CAT Version 4.2-1)
\end{terminalv}

If it does not, then the probable cause is that CAT-EXAMPLES is not
installed correctly at your site; check with your local site manager.

\subsection{\label{INCLUDE}INCLUDE files}

The programming interface to the CAT library includes two INCLUDE files:
\texttt{CAT\_PAR} and \texttt{CAT\_ERR}. These INCLUDE files define symbolic
constants which your application programs may use:

\begin{description}

  \item[\texttt{CAT\_PAR}] contains general constants pertaining to the
   CAT library,

  \item[\texttt{CAT\_ERR}] contains constants corresponding to the various
   error codes which can be set by the CAT library.

\end{description}

All the symbolic constants defined in both these files begin with the
prefix \texttt{CAT\_\_} (in conformance with normal Starlink practice).

You can INCLUDE either or both of these files in a subroutine by
including either or both of the following lines in the subroutine,
as appropriate:

\begin{terminalv}
INCLUDE 'CAT_PAR'   ! CAT symbolic constants.
INCLUDE 'CAT_ERR'   ! CAT error codes.
\end{terminalv}

If you are using a standard ADAM prologue for the subroutine these
lines will go in the `global constants' section.

The example applications included with CAT (see Section~\ref{SIMPLE}),
and probably your own applications, also need to access the standard
ADAM INCLUDE file \texttt{SAE\_PAR}. For convenience the instructions
given below include setting up access to this file.

The following description applies to all the variants of Unix supported
by Starlink.  The files are kept in
directory \texttt{/star/include} with names \texttt{cat\_par} and \texttt{cat\_err}. You should set up soft links to these files, following the
normal Starlink procedure, which is described in
\xref{SUN/111.2}{sun111}{}\cite{SUN111}.  See in particular Section 4.4,
p6.  Simply type:

\begin{terminalv}
star_dev
cat_dev
\end{terminalv}

\subsection{\label{LINK}Linking}

It might seem slightly perverse to describe how to link with the CAT
library before describing how to write an application which calls it.
However the rest of this manual describes various aspects of writing
applications which call CAT and it seems sensible to get the somewhat
separate question of linking out of the way first.

Your application should be written as an ADAM A-task.  The Starlink
shell script for linking an A-task, \texttt{alink}, will automatically compile
the source code for the A-task. Type:

\begin{verse}
\texttt{alink}\,\, \textit{your\_source\_code}\,\,  \texttt{`cat\_link\_adam`}
\end{verse}

This description applies to all the variants of Unix supported by
Starlink.

\subsection{\label{UTIL}Utility applications for examining catalogues}

Once you have written an application which uses the CAT library to
manipulate a catalogue you will often want to examine the contents of
the catalogues which the application reads or writes.  The catalogue
browser \texttt{xcatview} in the Starlink package CURSA (see
\xref{SUN/190}{sun190}{}\cite{SUN190}) is a convenient way to examine
catalogues.  It can access catalogues in any of the formats supported
by CAT\footnote{CURSA uses the CAT library to access catalogues.}.

Catalogues written in the STL or TST formats (see Appendix~\ref{FORMAT})
are text files and can be examined with standard Unix commands such
as \texttt{more} or \texttt{cat}.

In addition, CAT-EXAMPLES contains two simple utilities for examining the
contents of catalogues.  These utilities are largely of historical
interest and are less easy to use than \texttt{xcatview}.  They are mentioned
here for completeness.  The utilities are:

\begin{description}

  \item[\texttt{details}] reports the details of all the parameters and
   columns in a catalogue. All the attributes of every column and
   parameter are listed. The output is directed to the standard Fortran
   output stream.

  \item[\texttt{listout}] lists selected columns from a catalogue to the
   terminal screen or a text file, or both. You are prompted for the
   columns which are to be displayed.

\end{description}

To invoke either of these applications simply type either \texttt{details}
or \texttt{listout}, as appropriate, and answer the prompts, which are
self-explanatory.


\newpage
\part{Tutorial}


\section{\label{SIMPLE}\xlabel{SIMPLE}A simple example application}

\begin{quote}
\begin{center}
Example is always more efficacious than precept.
\end{center}
\textit{Lives of the English Poets} vol. ii \latex{\raggedleft}
\\ Samuel Johnson
\end{quote}
% Dictionary of Quotations: p116:25

This section will walk you through the Fortran source code for a simple
application which uses the CAT library to write a small catalogue.
First, however, a few preliminaries.

\begin{itemize}

  \item The programming interface to the CAT library comprises two
   components: the CAT subroutines and two INCLUDE files, \texttt{CAT\_PAR}
   and \texttt{CAT\_ERR}. These INCLUDE files define symbolic constants
   which application programs may use. Section~\ref{INCLUDE} explains
   how to access these files. It is worth your while printing out and
   examining copies of both files. The comments included in the files
   should be sufficient to explain the purpose of each constant. \texttt{CAT\_PAR} contains general constants pertaining to the CAT library.
   \texttt{CAT\_ERR} contains constants corresponding to the various error
   codes which can be set by the CAT library. If your application needs
   to access one of these values you should \textit{always}\, use the
   appropriate symbolic constant; \textit{never}\, hard-code the actual
   value into your code. The values may (and probably will) change in
   subsequent releases of the CAT library.

  \item Within the CAT interface items in a catalogue, such as columns
   and parameters, and, indeed, the catalogue itself, are identified
   by an \textbf{identifier}. This approach is consistent with the
   treatment of data items in other ADAM libraries. Each identifier is
   an INTEGER number. The value of an identifier is unique (within a
   given invocation of an application) and is sufficient to identify
   the item to which it refers. You should observe the following simple
   rules when using identifiers in applications.

  \begin{itemize}

    \item You should \textit{never}\, set the value of a new identifier
     yourself; CAT will \textit{always}\, generate an identifier for you.

    \item You should \textit{never}\, alter the value of an identifier
     once CAT has allocated it.

    \item You never need to know the actual value of an identifier. I
     suppose that you can print them out, if you really want to (they
     are just numbers), but the information is of no use to you.

  \end{itemize}

  \item Null values for fields are indicated by a separate flag
   indicating whether the associated datum is null or not. This flag is
   of type LOGICAL and is coded as follows:

  \begin{description}

    \item[\texttt{.TRUE.}] -- the field is null; no datum is available,

    \item[\texttt{.FALSE.}] -- the field is not null; a valid datum is
     available.

  \end{description}

   This scheme is adopted in both the routines to get a value from a
   catalogue and those to put a value to a field in a catalogue. It is
   adopted to avoid any possible ambiguity in interpreting null values.

   When a null value is obtained from a catalogue the actual datum
   returned will be the ADAM `bad' value for the appropriate data type
   (where one is available). This procedure facilitates passing values
   obtained from CAT into other ADAM subroutines. It means, however,
   that the null value returned through the CAT interface is not
   necessarily the same as the representation of the null stored in the
   catalogue. Existing catalogues, for example FITS tables from external
   sources, can come with a variety of values used to represent null
   values. The necessary checks and substitutions are performed
   automatically and invisibly within the catalogue-format specific
   parts of the CAT library. Your application will simply see the
   appropriate ADAM `bad' value.

   Not all catalogues support null values in all their columns. If a
   column does not support null values then the null value flag will
   always be returned set to \texttt{.FALSE.}

   The treatment of null values is described in greater detail in
   Section~\ref{NULLS}. In particular, Section~\ref{NULLAPP} prescribes
   how applications should handle null values.

\end{itemize}

We are now ready to examine a simple application which uses the CAT
library. We will use one of the example applications released with
the library, \texttt{EXAMPLE\_WRITE}. This example creates and writes
values to a small catalogue. I strongly recommend that you print out a
copy of the source code and refer to it as you work through the example.
The source code is available in file:

\begin{center}
\texttt{/star/share/cat/example\_write.f}
\end{center}

This example program is simpler than a real application. Starting at the
beginning, the first thing to notice about the application is that,
because it is an ADAM A-task, at its top level it is a subroutine, not
a main program:

\begin{terminalv}
      SUBROUTINE EXAMPLE_WRITE (STATUS)
\end{terminalv}

The status argument is used to keep track of the success of the
application as it proceeds with its task.

\begin{terminalv}
*+
*  Name:
*     EXAMPLE_WRITE
    .
    .
    .
\end{terminalv}

After the ADAM prologue comments the CAT symbolic constants are
INCLUDEd. Some of the constants defined in this file will be used by
the application.

\begin{terminalv}
*  Global Constants:
      INCLUDE 'SAE_PAR'
      INCLUDE 'CAT_PAR'
\end{terminalv}

The various variables used in the application are defined next.

\begin{terminalv}
*  Status:
      INTEGER STATUS             ! Global status.
*  Local Variables:
      INTEGER
     :  CI,       ! Catalogue identifier.
     :  QII,      ! Identifier for a real parameter.
     :  QIR,      ! Identifier for a real parameter.
     :  QIC,      ! Identifier for a character parameter .
     :  FII,      ! Identifier for an integer column (or field).
     :  FIR,      ! Identifier for a real column (or field).
     :  FIC,      ! Identifier for a character column (or field).
     :  LOOP      ! Loop index.
      INTEGER
     :  VALI      ! Integer value.
      REAL
     :  VALR      ! Real value.
      CHARACTER
     :  VALC*10   ! Character value.
      LOGICAL
     :  NULI,     ! Null flag corresponding to VALI.
     :  NULR,     !  "    "         "       "  VALR.
     :  NULC      !  "    "         "       "  VALC.
*.
\end{terminalv}

The first executable statement is the usual check that the status is ok.
This check is mandatory in ADAM applications.

\begin{terminalv}
      IF (STATUS .EQ. SAI__OK) THEN
\end{terminalv}

Once it is out of the way the application proper can start. It starts
with a call to \texttt{CAT\_CREAT}:

\begin{terminalv}
      CALL CAT_CREAT ('CNAME', CI, STATUS)
\end{terminalv}

This subroutine will create a new catalogue, whose name it obtains
from the ADAM parameter system (in practice the user will be prompted
for it)\footnote{It is possible to create or open a CAT catalogue
without going through the ADAM parameter system by calling routine
\texttt{CAT\_TOPEN} rather than \texttt{CAT\_CREAT}. This routine is not used
in the present example, but is described in Section~\ref{NONADAM},
below.}. The first argument of \texttt{CAT\_CREAT} is the name of the ADAM
parameter which will supply the catalogue name. The remaining two
arguments are returned by \texttt{CAT\_CREAT}; \texttt{CI} is the identifier
for the catalogue. We will use this variable to refer to the catalogue
throughout the application. \texttt{STATUS} is the running status argument
which is usual in ADAM libraries. If the routine has succeeded its value
is \texttt{SAI\_\_OK}.

After \texttt{CAT\_CREAT} has executed successfully a new catalogue has
been created, but no columns or parameters have been defined for it,
and it contains no data. The next step is to define some columns. The
first column defined is an INTEGER column called \texttt{COLI}. Subroutine
\texttt{CAT\_PNEW0} is used for this task:

\begin{terminalv}
         CALL CAT_PNEW0 (CI, CAT__FITYP, 'COLI', CAT__TYPEI, FII,
     :     STATUS)
\end{terminalv}

The first argument, \texttt{CI}, identifies the catalogue to which the
new column belongs. The second argument tells \texttt{CAT\_PNEW0} that it
has to create a new column; this argument should always be \texttt{CAT\_\_FITYP} when a column is to be created. The third argument is the
name of the column, \texttt{COLI} in the present case, and the fourth
argument defines its data type. There are symbolic constants defined in
\texttt{CAT\_PAR} for each of the data types supported by CAT. \texttt{COLI}
is an INTEGER column, so the code for an INTEGER is used. The codes for
the different data types are listed in Table~\ref{DTYPES}.

The fifth argument, \texttt{FII}, is returned rather than given and is an
identifier for the column; subsequent references to the column will be
via this identifier. The final argument is the usual ADAM running
status.

The mandatory information which you must supply to define a column is:
the catalogue to which it belongs, its name and its data type. All these
values are specified using routine \texttt{CAT\_PNEW0}. However, as
explained in Section~\ref{TERM}, a column is defined by a set of
attributes, of which the name and data type are but two, albeit
mandatory ones. Section~\ref{COLS} lists all the attributes for a
column. If you do not specify the remaining attributes default
values are adopted for them. You can, however, supply your own values to
over-ride the defaults. The next line is an example of doing so.

\begin{terminalv}
         CALL CAT_TATTC (FII, 'COMM', 'Integer column', STATUS)
\end{terminalv}

This routine is one of a family of similar routines, one for each
data type (\texttt{CAT\_TATTC} for attributes of data type CHARACTER,
\texttt{CAT\_TATTI} attributes of type INTEGER etc). Here it is used
to set the comment attribute, COMM of column \texttt{FII} to the
value `Integer column'. Other attributes of column \texttt{COLI} could have
been set in the same way, but in this example they are not, and the
defaults are adopted\footnote{For convenience two additional routines,
which are not used in the present example, are provided for creating
columns. \texttt{CAT\_CNEWS} creates a column and simultaneously sets some
of the more commonly used attributes; \texttt{CAT\_CNEWA} creates a column
and simultaneously sets all of its attributes. These routines may be
more convenient to use than a call to \texttt{CAT\_PNEW0} followed by
multiple calls to \texttt{CAT\_TATT$<$t$>$}. They are described in
Section~\ref{SUBINT_COL}, below.}.

Two additional columns are created in the same way; the REAL column
\texttt{COLR} and the CHARACTER column \texttt{COLC}. Note that in the case of
\texttt{COLC} the CHARACTER size attribute CSIZE is set using routine \texttt{CAT\_TATTI}.

\begin{terminalv}
         CALL CAT_PNEW0 (CI, CAT__FITYP, 'COLR', CAT__TYPER, FIR,
     :     STATUS)
         CALL CAT_TATTC (FIR, 'COMM', 'Real column', STATUS)

         CALL CAT_PNEW0 (CI, CAT__FITYP, 'COLC', CAT__TYPEC, FIC,
     :     STATUS)
         CALL CAT_TATTC (FIC, 'COMM', 'Character column', STATUS)
         CALL CAT_TATTI (FIC, 'CSIZE', 10, STATUS)
\end{terminalv}

An important restriction to remember is that columns must be created,
and their attributes set, before any rows of data are written to the
catalogue. Once a table of values have been written to a catalogue the
details of its existing columns are frozen and no new columns can be
created for it.

After creating the columns, some parameters are created. The first of
these is the INTEGER parameter \texttt{PARI}. It is created with the same
routine that was used to create the columns, \texttt{CAT\_PNEW0}:

\begin{terminalv}
         CALL CAT_PNEW0 (CI, CAT__QITYP, 'PARI', CAT__TYPEI, QII,
     :     STATUS)
\end{terminalv}

Again the first argument is the catalogue identifier. The second
argument indicates that a parameter is to be created; this argument
should always be set to \texttt{CAT\_\_QITYP} when a parameter is to be
created. The remaining arguments are exactly the same as they were for
creating a column: \texttt{PARI} is the parameter name, \texttt{CAT\_\_TYPEI}
the data type and \texttt{QII} and \texttt{STATUS} are the identifier for the
parameter and the running status, respectively.

As for columns, only the minimum, mandatory attributes for the parameter
are set with \texttt{CAT\_PNEW0}, and default values are adopted for the
remaining attributes. Section~\ref{PARS} lists the attributes of a
parameter. Also just like columns, the attributes of parameters can be
set using the \texttt{CAT\_TATT$<$t$>$} family of routines (where \texttt{t = C} for CHARACTER attributes, \texttt{I} for INTEGER etc). In the
example \texttt{CAT\_TATTC} is used to set the comments attribute, COMM of
parameter \texttt{PARI} and \texttt{CAT\_TATTI} is used to set the value
attribute VALUE. The latter point is worth remembering; having created
a parameter with \texttt{CAT\_PNEW0} it is necessary to use one of the \texttt{CAT\_TATT$<$t$>$} routines to set its value, and the routine chosen
should correspond to the data type of the parameter\footnote{For
convenience two additional routines, which are not used in the present
example, are provided for creating parameters. \texttt{CAT\_PPTS$<$t$>$}
creates a parameter and simultaneously sets some of the more commonly
used attributes; \texttt{CAT\_PPTA$<$t$>$} creates a parameter and
simultaneously sets all of its attributes. These routines may be more
convenient to use than a call to \texttt{CAT\_PNEW0} followed by multiple
calls to \texttt{CAT\_TATT$<$t$>$}. They are described in
Section~\ref{SUBINT_PAR}, below.}.

\begin{terminalv}
         CALL CAT_TATTC (QII, 'COMM', 'Integer parameter', STATUS)
         CALL CAT_TATTI (QII, 'VALUE', 23, STATUS)
\end{terminalv}

Two additional parameters are created; the REAL parameter \texttt{PARR} and
the CHARACTER parameter \texttt{PARC}. Note that, as was the case for
columns, for the CHARACTER parameter \texttt{PARC} the CHARACTER size
attribute `CSIZE' must be set using \texttt{CAT\_TATTI}.

\begin{terminalv}
         CALL CAT_PNEW0 (CI, CAT__QITYP, 'PARR', CAT__TYPER, QIR,
     :     STATUS)
         CALL CAT_TATTC (QIR, 'COMM', 'Real parameter', STATUS)
         CALL CAT_TATTR (QIR, 'VALUE', 42.0, STATUS)

         CALL CAT_PNEW0 (CI, CAT__QITYP, 'PARC', CAT__TYPEC, QIC,
     :     STATUS)
         CALL CAT_TATTC (QIC, 'COMM', 'Character parameter', STATUS)
         CALL CAT_TATTI (QIC, 'CSIZE', 20, STATUS)
         CALL CAT_TATTC (QIC, 'VALUE', 'Example string', STATUS)
\end{terminalv}

Note that, unlike columns, parameters can be created at any stage
while writing a catalogue. They do not have to be created prior to
writing the table of values for the catalogue.

Once the parameters have been created the example starts a loop which
will write the table of values.

\begin{terminalv}
         DO LOOP = 1, 25
\end{terminalv}

In the CAT interface the basic method of writing (and reading) a
catalogue is one row at a time. Each increment of the loop will
correspond to a separate row of the catalogue, and thus in total
twenty-five rows will be written, numbered from one to twenty-five.

The first few lines of code inside the loop are concerned with inventing
values to write to the catalogue. The next few lines  set the null value
flags (all the rows contain non-null values, except row ten, where the
flags are set to null). In a real application, of course, these values
would not be invented, but would either be the results of a calculation
or read from an external file.

\begin{terminalv}
            VALI = LOOP
            VALR = 2.3E1 + REAL(LOOP)
            VALC = ' '
            WRITE(VALC, 4000) LOOP
 4000       FORMAT(' Loop ',I3, '%')

            NULI = .FALSE.
            NULR = .FALSE.
            NULC = .FALSE.

*
*          Make all the columns contain null values for row 10.

            IF (LOOP .EQ. 10) THEN
               NULI = .TRUE.
               NULR = .TRUE.
               NULC = .TRUE.
            END IF
\end{terminalv}

The line:

\begin{terminalv}
            CALL CAT_PUT0I (FII, VALI, NULI, STATUS)
\end{terminalv}

writes a single value to column \texttt{COLI}. \texttt{FII} is the column
identifier, \texttt{VALI} and \texttt{NULI} the value and null value flag
respectively. \texttt{STATUS} is, of course, the running status. \texttt{CAT\_PUT0I} is one of the family of \texttt{CAT\_PUT0$<$t$>$} routines,
with one routine per data type. (\texttt{I} for INTEGER, \texttt{C} for
CHARACTER etc). Thus there are corresponding calls to write the REAL and
CHARACTER columns \texttt{COLR} and \texttt{COLC}:

\begin{terminalv}
            CALL CAT_PUT0R (FIR, VALR, NULR, STATUS)
            CALL CAT_PUT0C (FIC, VALC, NULC, STATUS)
\end{terminalv}

CAT has the concept of the `current row buffer', which is an internal
copy of the row of the catalogue which it is working on currently. The
\texttt{CAT\_PUT0$<$t$>$} routines put fields to the current row buffer
(and the corresponding \texttt{CAT\_GET0$<$t$>$} routines read values from
it).

\begin{terminalv}
            CALL CAT_RAPND (CI, STATUS)
\end{terminalv}

Writes out the current row buffer for catalogue \texttt{CI} to the actual
catalogue file, appending it to the end of the catalogue. The internal
current row buffer is initialized ready to receive new values, and the
internal count of the actual catalogue row number to which the current
row buffer corresponds is incremented by one. That is, \texttt{CAT\_RAPND}
takes care of writing the current row buffer to the catalogue and
readies CAT to receive values for a new current row buffer. When a
catalogue is created the current row buffer is initialized automatically
and the row number to which it corresponds is set to one.

Thus a loop with one increment corresponding to one row in the
catalogue and containing calls to \texttt{CAT\_PUT0$<$t$>$} routines to put
values to the current row buffer and a call to \texttt{CAT\_RAPND} to
append the current row buffer to the catalogue is all that is necessary
to write a table of values to a catalogue. The current row has been
written, so the loop generating each row can now terminate:

\begin{terminalv}
         END DO
\end{terminalv}

There is one final call to a CAT routine:

\begin{terminalv}
         CALL CAT_TRLSE (CI, STATUS)
\end{terminalv}

This call `releases' catalogue identifier \texttt{CI} and closes the
corresponding catalogue. Identifiers to items within the catalogue, such
as the various columns and parameters, are also released. Any remaining
values are written to disk, the files are closed etc. The creation of
the catalogue is complete. Finally, if all has succeeded, the
application reports a message and then terminates.

\begin{terminalv}
         IF (STATUS .EQ. SAI__OK) THEN
            CALL MSG_OUT (' ', 'Catalogue created successfully.',
     :        STATUS)
         ELSE
            CALL ERR_REP ('EXAMPLE_WRITE_ERR', 'Failed to create '/
     :        /'catalogue.', STATUS)
         END IF

      END IF

      END
\end{terminalv}

Having worked through this example application you might like to try
it out. Type:

\begin{terminalv}
example_write
\end{terminalv}

You will be prompted for the catalogue name. Reply, for example:

\begin{terminalv}
test.fit
\end{terminalv}

After a couple of moments the message `\texttt{Catalogue created
successfully.}' should appear and a binary FITS table called \texttt{test.fit} should have been created in your current directory. You can
examine its contents using the \texttt{xcatview} catalogue browser in
CURSA (see \xref{SUN/190}{sun190}{}\cite{SUN190}) or the \texttt{listout}
utility in CAT-EXAMPLES.  For the latter simply type:

\begin{terminalv}
listout
\end{terminalv}

and answer the prompts (see Section~\ref{UTIL} for details).

Another example program is available which reads back the catalogue
created by \texttt{EXAMPLE\_WRITE}. It is called \texttt{EXAMPLE\_READ}
and the source code is available in file:

\begin{terminalv}
/star/share/cat/example_read.f
\end{terminalv}

You might like to print out a copy and try to understand it. If you
have followed the discussion for \texttt{EXAMPLE\_WRITE} you should be
able to do so without any difficulty.


\section{\xlabel{CARRYON}Carrying on}

This section will briefly introduce some features of the CAT library
which were not covered in the preceding example: celestial coordinates,
vector columns, expressions, selections and indices. The description is
introductory and informal; for a full description of these topics you
should see the reference material in Part III.


\subsection{Celestial coordinates in catalogues}

Most astronomical catalogues contain columns of celestial
coordinates of some sort: usually Right Ascension and
Declination for some equinox and epoch, or perhaps Galactic or
ecliptic coordinates. The storage, manipulation and presentation
for display of celestial coordinates in the computer-readable
version of astronomical catalogues is something of a vexed topic
which has caused a deal of confusion and difficulty, much of it,
in principle, unnecessary. Celestial coordinates are angles. The
basic conundrum in storing and processing them is as follows:

\begin{itemize}

  \item for use in computations inside a program the only
  sensible way to represent coordinates is as DOUBLE PRECISION or
  REAL numbers expressed in radians,

  \item for display to a user the coordinates should almost
   invariably be expressed in units of hours or degrees and
   formatted as a sexagesimal value, with subdivisions into minutes
   and seconds.

\end{itemize}

For preexisting catalogues the format of the celestial
coordinates will already be fixed and they must simply be used
in whatever way is possible. For example, many catalogues
contain the hours, or degrees, minutes and seconds which
comprise a coordinate as separate columns; a form which is
singularly inconvenient for further processing. However, CAT has
some special facilities for processing and displaying angles
which conveniently and automatically provide for:

\begin{itemize}

  \item representation inside a program as a DOUBLE PRECISION or
   REAL number expressed in radians,

  \item representation for display to a user as a CHARACTER
   string expressed in hours or degrees and formatted as a
   sexagesimal value.

\end{itemize}

This facility works as follows:

\begin{itemize}

  \item when the value for a field in a column containing angles
   is obtained using
  \newline \texttt{CAT\_EGT0D} or \texttt{CAT\_EGT0R} it is returned as a
   DOUBLE PRECISION or REAL value in radians,

  \item when the value for a field in a column containing angles
   is obtained formatted for display using \texttt{CAT\_EGT0F} it is
   returned as a CHARACTER string containing the value expressed in
   hours or degrees and formatted as a sexagesimal value.

\end{itemize}

In order to use this facility CAT must know that the column
contains an angle and the units (hours or degrees) and format to
use when formatting the angle for display. The prescription for
creating a column of angles in a CAT catalogue is as follows.

\begin{enumerate}

  \item Create the column with data type DOUBLE PRECISION.

  \item The UNITS attribute should start with the string \texttt{RADIANS} to indicate that the column contains an angle in
   radians and this should be followed by a specifier enclosed in
   curly brackets `\{\}' indicating how it is to be formatted for
   display. For example:

  \begin{description}

    \item[\texttt{RADIANS\{HOURS\} }] if it is to be displayed in
     hours,

    \item[\texttt{RADIANS\{DEGREES\} }] if it is to be displayed in
     degrees.

  \end{description}

   Specifying `HOURS' will cause the angle to be displayed in
   hours, minutes and seconds, with the seconds displayed to one
   place of decimals; `DEGREES' will cause the angle to be
   displayed in degrees, minutes and seconds, with the seconds
   displayed as whole numbers\footnote{This discussion covers only
   the simplest specifiers for formatting angles for display,
   though these are adequate for most cases and are the easiest to
   use. The full set of specifiers, which allow considerable
   flexibility in representing angles, are described in
   Section~\ref{ANGLES}.}.

  \item When writing the table of values for the catalogue,
   express the angles in radians as DOUBLE PRECISION variables and
   write them to the catalogue using \texttt{CAT\_PUT0D}.

\end{enumerate}

An example program is available which illustrates the creation
of columns containing angular celestial coordinates. It creates
a catalogue containing (fake) equatorial coordinates and B
magnitudes for a set of stars. It is called \texttt{EXAMPLE\_ANGLES} and
the source code is available in file:

\begin{terminalv}
/star/share/cat/example_angles.f
\end{terminalv}

The overall structure is very similar to the previous example of
writing a catalogue,
\newline \texttt{EXAMPLE\_WRITE}, but note the way that the three points
outlined above are followed in order to create the angular columns.


\subsection{Vector columns}

CAT does not provide facilities to simultaneously GET or PUT all the
values for a given field in a vector column; rather the individual
elements of each field must be GOT or PUT separately. Individual
vector elements have their own identifiers. To process a vector element
you should first get an identifier for the element and then GET or
PUT values using the identifier just as you would for a scalar column.

The name of a vector element is the name of the vector column followed
by the number of the element\footnote{The first element of a vector
is numbered one.} enclosed in square brackets. Thus, \texttt{FLUX[4]}
corresponds to the fourth element of vector \texttt{FLUX}. Identifiers for
vector elements are obtained using \texttt{CAT\_TIDNT}, just as for scalar
columns.

The following example illustrates obtaining the values of the fourth
element of vector \texttt{FLUX} for the first twenty-five rows of a
catalogue. The value obtained for each row is read into REAL variable
\texttt{FLXVAL}. In the example the value is overwritten by each successive
row; in a real application it would be processed or stored in some way.

\begin{terminalv}
      INTEGER
     :  CI,      ! Catalogue identifier.
     :  VEI,     ! Vector element identifier.
     :  ROW      ! Current row.
      REAL
     :  FLXVAL   ! Value read for current row.
      LOGICAL
     :  NULFLG   ! Null value flag.
       .
       .
       .
\end{terminalv}

First get an identifier for the vector element.

\begin{terminalv}
      CALL CAT_TIDNT (CI, 'FLUX[4]', VEI, STATUS)
\end{terminalv}

Then loop through the first twenty-five rows getting the value for the
vector element.

\begin{terminalv}
      DO ROW = 1, 25
         CALL CAT_RGET (CI, ROW, STATUS)

         CALL CAT_EGT0R (VEI, FLXVAL, NULFLG, STATUS)
           .
           .
           .

      END DO
\end{terminalv}


\subsection{Expressions}

In CAT an expression is an algebraic expression involving the names of
columns and parameters and constants, linked by arithmetic operators and
mathematical and astronomical functions. The syntax for expressions is
described in Appendix~\ref{EXPR}. The first step towards manipulating an
expression is to obtain an identifier for it. Routine \texttt{CAT\_EIDNT}
is used for this purpose. If the expression is invalid (for example
because it contains the name of a column which does not exist in the
catalogue) this routine will return with an error status. Once you have
an identifier for an expression the expression can be evaluated using
the same routines that GET the values of a column (you are `getting the
value of the expression'). Clearly, values cannot be written to
expressions and there is no equivalent of PUTting a value to a column.

Suppose that a catalogue contained columns called \texttt{x} and \texttt{y}
and parameter \texttt{p}. The following example illustrates evaluating the
expression `\texttt{x + y + p + 2.0}' (that is, getting its value) for the
first twenty-five rows of the catalogue. The evaluated expression for
each row is read into REAL variable\footnote{Internally, inside CAT,
numeric expressions are always evaluated using data type DOUBLE
PRECISION. If you are unsure about the data type to use for the
evaluated result of an expression the safest choice is to use DOUBLE
PRECISION in order to ensure that accuracy is not lost.} \texttt{EXPVAL}.
In the example the value is overwritten for each successive row; in a
real application it would be processed or stored in some way.

\begin{terminalv}
      INTEGER
     :  CI,      ! Catalogue identifier.
     :  EI,      ! Expression identifier.
     :  ROW      ! Current row.
      REAL
     :  EXPVAL   ! Value read for current row.
      LOGICAL
     :  NULFLG   ! Null value flag.
       .
       .
       .
\end{terminalv}

First get an identifier for the expression.

\begin{terminalv}
      CALL CAT_EIDNT (CI, 'x + y + p + 2.0', EI, STATUS)
\end{terminalv}

Then loop through the first twenty-five rows getting the value for the
expression.

\begin{terminalv}
      DO ROW = 1, 25
         CALL CAT_RGET (CI, ROW, STATUS)

         CALL CAT_EGT0R (EI, EXPVAL, NULFLG, STATUS)
           .
           .
           .

      END DO
\end{terminalv}

Null values for expressions work just like null values for scalar
columns. If a null value is generated \texttt{CAT\_EGT0$<$t$>$} returns
the appropriate Starlink `bad' value rather than a genuine datum, and
the null value flag (argument \texttt{NULFLG} in the example) is set to
\texttt{.TRUE.} Expressions can evaluate to null in a number of ways:
perhaps individual fields in the expression are themselves null, or
an arithmetic exception (such as $\div$ by zero) might occur in the
expression.


\subsection{Selections}

In CAT a selection is a set of rows in a catalogue which satisfy some
criteria. Every selection that you create has a unique identifier.
Once you have obtained a selection identifier it can be passed to
\texttt{CAT\_RGET} instead of a catalogue identifier, and \texttt{CAT\_RGET} will operate on just the rows in the selection, rather than
all the rows in the catalogue.

There are two routines for creating selections (that is, generating
selection identifiers): \texttt{CAT\_SELCT} and \texttt{CAT\_SFND$<$t$>$}.
\texttt{CAT\_SELCT} allows selections to be made on complex criteria
whereas \texttt{CAT\_SFND$<$t$>$} selects values in a simple range for a
given sorted column. \texttt{CAT\_SFND$<$t$>$} will usually be faster than
\texttt{CAT\_SELCT} (a useful mnemonic is F for Fast and Find, S for Slow
and Select), but is much less flexible. Both these routines optionally
allow you to create a second selection comprising the rejected rows,
as well as the primary selection of selected rows.

Suppose a catalogue was sorted on column \texttt{DEC} of data type REAL
and you wished to find the rows for which \texttt{DEC} was in the range
10.0 to 20.0. Because this is a simple range selection on a sorted
column routine \texttt{CAT\_SFND$<$t$>$} can be used.

\begin{terminalv}
      INTEGER
     :  CI,      ! Catalogue identifier.
     :  FI,      ! Identifier for column DEC.
     :  SI,      ! Selection identifier for selected rows.
     :  NUMSEL,  ! Number of selected rows.
     :  SIR,     ! Selection identifier for rejected rows.
     :  NUMREJ,  ! Number of rejected rows.
     :  ROW      ! Current row.
      REAL
     :  DECVAL   ! Value read for DEC from current row in selection.
      LOGICAL
     :  NULFLG   ! Null value flag.
       .
       .
       .
\end{terminalv}

First get an identifier for column DEC.

\begin{terminalv}
      CALL CAT_TIDNT (CI, 'DEC', FI, STATUS)
\end{terminalv}

Next create the selection and get an identifier for it. Note that
because column \texttt{DEC} is of type REAL, the REAL version of \texttt{CAT\_SFND$<$t$>$}, \texttt{CAT\_SFNDR}, is used, and in this example the
optional second selection, comprising the rejected rows, is not
generated.

\begin{terminalv}
      CALL CAT_SFNDR (CI, FI, 10.0, 20.0, .FALSE., SI, NUMSEL,
     :  SIR, NUMREJ, STATUS)
\end{terminalv}

Loop through all the rows in the selection, getting values for
column \texttt{DEC}.  Note how the selection identifier, \texttt{SI}, rather
than the catalogue identifier, is passed to routine \texttt{CAT\_RGET}.


\begin{terminalv}
      DO ROW = 1, NUMSEL
         CALL CAT_RGET (SI, ROW, STATUS)

         CALL CAT_EGT0R (FI, DECVAL, NULFLG, STATUS)
           .
           .
           .

      END DO
\end{terminalv}

As a second example, suppose that the catalogue was not sorted on column
\texttt{DEC}. \texttt{CAT\_SFND$<$t$>$} could not now be used to create the
selection, and \texttt{CAT\_SELCT} would have to be used instead. The
procedure would then be as follows.

\begin{terminalv}
      INTEGER
     :  CI,      ! Catalogue identifier.
     :  FI,      ! Identifier for column DEC.
     :  EI,      ! Expression identifier.
     :  SI,      ! Selection identifier for selected rows.
     :  NUMSEL,  ! Number of selected rows.
     :  SIR,     ! Selection identifier for rejected rows.
     :  NUMREJ,  ! Number of rejected rows.
     :  ROW      ! Current row.
      REAL
     :  DECVAL   ! Value read for DEC from current row in selection.
      LOGICAL
     :  NULFLG   ! Null value flag.
       .
       .
       .
\end{terminalv}

First \texttt{CAT\_EIDNT} is used to get an expression identifier for the
expression representing the criteria.  This identifier is then passed
to \texttt{CAT\_SELCT}. Remember that the criterion is that \texttt{DEC}
should be in the range 10.0 to 20.0.

\begin{terminalv}
      CAT_EIDNT (CI, '(DEC >= 10.0) & (DEC <= 20.0)', EI, STATUS)

      CAT_SELCT (CI, EI, .FALSE., SI, NUMSEL, SIR, NUMREJ, STATUS)
\end{terminalv}

Next get an identifier for column \texttt{DEC}, then loop through all the
rows in the selection, getting values for \texttt{DEC}.  Again note how the
selection identifier, \texttt{SI}, rather than the catalogue identifier,
is passed to routine \texttt{CAT\_RGET}.

\begin{terminalv}
      CAT_TIDNT (CI, 'DEC', FI, STATUS)

      DO ROW = 1, NUMSEL
         CALL CAT_RGET (SI, ROW, STATUS)

         CALL CAT_EGT0R (FI, DECVAL, NULFLG, STATUS)
           .
           .
           .

      END DO
\end{terminalv}


\subsection{Indices}

In CAT an index is a mechanism for accessing the rows of a catalogue in
the order that they would have were the catalogue sorted into ascending
or descending order on some (numeric) column. That is, an index presents
the application with a `virtual catalogue' which appears to have been
sorted on the specified column. Every index that you create has a unique
identifier. Once you have obtained an index identifier it can be passed to
\texttt{CAT\_RGET} instead of a catalogue identifier, and \texttt{CAT\_RGET} will return subsequent rows corresponding to ascending or
descending order of the column used to generate the index.

Indices are created using routine \texttt{CAT\_INEW}. \textit{Version
\CATversion of CAT supports only temporary indices which persist only
for the duration of the application which generated them and perish
when it terminates.} Future versions of CAT will support permanent
indices which persist after the program which generated them terminates.

Suppose that you wished to generate an index on column \texttt{DEC} of data
type REAL\footnote{Indices can be generated on columns of any of the
numeric data types.} and then process the rows of the catalogue
using this index.

\begin{terminalv}
      INTEGER
     :  CI,      ! Catalogue identifier.
     :  FI,      ! Identifier for column DEC.
     :  II,      ! Identifier for index generated from column DEC.
     :  NUMROW,  ! Number of rows in the catalogue.
     :  ROW      ! Current row.
      REAL
     :  DECVAL   ! Value read for DEC from current row in index.
      LOGICAL
     :  NULFLG   ! Null value flag.
       .
       .
       .
\end{terminalv}

First get an identifier for column DEC.

\begin{terminalv}
      CALL CAT_TIDNT (CI, 'DEC', FI, STATUS)
\end{terminalv}

Next create an index and get an identifier for it.

\begin{terminalv}
      CALL CAT_INEW (FI, 'TEMP', CAT__ASCND, II, STATUS)
\end{terminalv}

The second argument indicates that the index is temporary rather than
permanent; `\texttt{TEMP}' is the only permitted value here in version
\CATversion of CAT. The third argument indicates whether the index is to
correspond to ascending (`\texttt{CAT\_\_ASCND}') or descending (`\texttt{CAT\_\_DSCND}') order.

To access the rows via the index simply determine the number of rows in
the catalogue and then loop through the rows, passing the index identifier,
\texttt{II}, rather than then catalogue identifier, to routine \texttt{CAT\_RGET}. The values obtained might be processed in some way, or
written out to generate a sorted catalogue.

\begin{terminalv}
      CALL CAT_TROWS (CI, NUMROW, STATUS)

      DO ROW = 1, NUMROW
         CALL CAT_RGET (II, ROW, STATUS)

         CALL CAT_EGT0R (FI, DECVAL, NULFLG, STATUS)
           .
           .
           .

      END DO
\end{terminalv}


\newpage
\part{Reference}


\section{\label{COMP}\xlabel{COMP}Components of a CAT catalogue}

This section describes the components of a CAT catalogue. It is
necessary to understand the structure of a CAT catalogue in order to use
the CAT library effectively. An idealized computer-readable version of
an astronomical catalogue, or similar tabular dataset, might comprise
the following elements:

\begin{enumerate}

  \item the table of values which comprise the catalogue,

  \item a description of this table; the details of all the columns that
   it contains, the number of rows etc,

  \item textual information about the catalogue; perhaps a short
   description of the catalogue or a copy of a published paper
   describing it. This information is intended to be read by a human
   rather than interpreted by a computer.

\end{enumerate}

The CAT library is mostly concerned with the first two items. However,
it also provides some simple facilities to retrieve and write the
textual information of the third item. These latter facilities are
provided so that the textual information in a catalogue can be displayed
to a user or copied when a new catalogue is created from an old one.
The routines for manipulating textual information are described in
Section~\ref{SUBINT_TEXT}. They do not interact with any other items
in a CAT catalogue and they are not mentioned again in this section.

The table in a CAT catalogue is very similar to a \textbf{relation} in the
theory of relational databases, and has many of the same properties.
Each row in the table must contain the same number of fields.
Corresponding fields in different rows must be of the same type. The
table may contain an arbitrary number of rows. In the formal theory of
relational databases, no two rows may be identical. CAT relaxes this
rule by permitting identical rows, though it is difficult to see what
purpose such rows might serve.

The internal organization of a CAT catalogue (the way it is formatted
on disk) is unknown to an application using the CAT library. The values
in the catalogue are accessed purely through the subroutine interface to
the CAT library.


\subsection{Provision for future enhancements}

This manual describes version \CATversion of the CAT library.  The
original specification for the library is described in the document \textit{The Starlink Subroutine Interface for Manipulating Catalogues}
(StarBase/ACD/3.4)\cite{STARBASE34}.  Version \CATversion of CAT is a
subset of this full implementation and some of the items present in it
serve no apparent purpose.  These items correspond to features which were
in the original specification but which are not currently implemented.
These items may be implemented in future versions and have been included
so that applications written now will be compatible with future versions
of the library.

\subsection{Symbolic constants}

Various symbolic constants are referred to throughout this section.
These constants are defined in INCLUDE file \texttt{CAT\_PAR}, which may
be INCLUDEd in the subroutines of an application. See
Section~\ref{INCLUDE} for details of how to access this file.


\subsection{\label{CCA}Catalogues, components and attributes}

In the CAT model of a catalogue a catalogue comprises a number of \textbf{components}. In version \CATversion of CAT a catalogue may contain
two sorts of components: \textbf{columns} and \textbf{parameters}:

\begin{description}

  \item[columns] define the individual columns (scalars or vectors) in
   the table,

  \item[parameters] provide single items of information which apply to
   the entire catalogue. Examples might be the epoch or equinox of
   celestial coordinates in the catalogue.

%  \item[indices] the name of any indices which exist on the table.
%   Indices may be either ascending or descending.

\end{description}

A catalogue may contain an arbitrary number of columns and an arbitrary
number of parameters. Columns and parameters are permanent entities
which persist in between invocations of applications accessing the
catalogue through the CAT library (typically as items in a disk file).
In addition to these permanent components additional sorts of temporary
components may be created by CAT: \textbf{expressions}, \textbf{selections}
and \textbf{indices}.

\begin{description}

  \item[expressions] define a quantity computed from existing columns
   (and parameters) using some algebraic or logical (boolean)
   expression,

  \item[selections] define a set of rows selected from the catalogue
   according to some criteria.

  \item[indices] define an order for accessing rows in the catalogue
   equivalent to sorting the catalogue on a specified column.

\end{description}

Unlike columns and parameters, expressions, selections and indices are
ephemeral entities\footnote{Future versions of CAT will support permanent
indices.} which perish when the application using CAT which created them
terminates.

Every component consists of a number of \textbf{attributes}. Each type of
component (permanent or temporary; column, parameter, expression,
selection or index) has a fixed set of attributes, each identified by name.
The values of the attributes differ between components, and their totality
defines the component. Additionally there are two special attributes
which apply to the entire catalogue, rather than to a particular
component. This hierarchy is illustrated in Figure~\ref{CHIER}.
Subsequent sections describe these catalogue attributes and the
attributes of columns, parameters, expressions, selections and indices.

\begin{figure}[htbp]
\begin{center}

\begin{picture}(120,115)(0,0)
\thicklines

\put(30,80){ \line(10,0){10} }  % components descending from
\put(40,71){ \line(9,0){9} }    % 'catalogue'.
\put(40,71){ \line(0,9){9} }
\put(47,61){ \line(2,0){2} }
\put(47,51){ \line(2,0){2} }
\put(47,41){ \line(2,0){2} }
\put(47,31){ \line(2,0){2} }
\put(47,31){ \line(0,40){40} }

\put(70,71){ \line(19,0){19} }  % lines descending from
\put(87,61){ \line(2,0){2} }    % 'columns'.
\put(87,51){ \line(2,0){2} }
\put(87,49){ \line(0,22){22} }
\put(87,43){ $\vdots$ }         % vertical ellipsis.

\put(70,61){ \line(11,0){11} }  % lines descending from
\put(81,31){ \line(8,0){8} }    % 'parameter'.
\put(87,21){ \line(2,0){2} }
\put(87,11){ \line(2,0){2} }
\put(81,31){ \line(0,30){30} }
\put(87,9){ \line(0,22){22} }
\put(87,3){ $\vdots$ }          % vertical ellipsis.

\put(70,51){ \line(3,0){3} }    % lines from the
\put(70,41){ \line(3,0){3} }    % remaining components.
\put(70,31){ \line(3,0){3} }
% \put(70,21){ \line(3,0){3} }

\put(74,51){ \ldots }           % horizontal ellipsis.
\put(74,41){ \ldots }
\put(74,31){ \ldots }
% \put(74,21){ \ldots }

\put(11,105){\underline{catalogues} } % catalogues.
\put(11,80){catalogue}

\put(51,105){\underline{components} } % components.
\put(51,70){columns}
\put(51,60){parameters}
\put(51,50){expressions}
\put(51,40){selections}
\put(51,30){indices}
% \put(51,20){joins\S}

\put(91,105){\underline{attributes} } % attributes.
\put(91,70){name}
\put(91,60){genus}
\put(91,50){expression}
\put(91,30){name}
\put(91,20){type}
\put(91,10){dimensionality}

\put(95,43){ $\vdots$ }              % vertical ellipsis
\put(95,3){ $\vdots$ }

\put(30,82){ \line(10,0){10} }       % attributes of a
\put(40,91){ \line(47,0){47} }       % catalogue
\put(87,96){ \line(2,0){2} }
\put(87,86){ \line(2,0){2} }
\put(40,82){ \line(0,9){9} }
\put(87,86){ \line(0,10){10} }
\put(91,95){name}
\put(91,85){modification date}

\end{picture}

% \begin{quote}
%   \S Join components are special because they refer to not one,
%   but two, catalogues.
% \end{quote}

\caption{\label{CHIER}The hierarchy of catalogues, components and
attributes}

\end{center}
\end{figure}


\subsection{Identifiers}

Catalogues, columns, parameters, expressions, selections and indices are
all identified by an \textbf{identifier}. Each identifier is an INTEGER
number. The value of an identifier is unique (within a given invocation of
an application) and is sufficient to identify the item to which it refers.
The following rules apply when using CAT identifiers in applications:

\begin{itemize}

  \item an application should \textit{never}\, set the value of a new
   identifier itself; the CAT library will \textit{always}\, generate a
   new identifier,

  \item an application should \textit{never} modify the value of an
   existing identifier once CAT has allocated it,

  \item an application never needs to know the actual value of an
   identifier.

\end{itemize}

An application can inquire what sort of item (catalogue, column,
parameter etc.) an identifier represents using subroutine \texttt{CAT\_TIDTP}. The various types of identifiers are represented using
INTEGER codes, and symbolic constants are defined for these codes. They
are listed in Table~\ref{IDTYPE}.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{lc}
Type of identifier        &  CAT symbolic constant \\ \hline
Catalogue                 &  \texttt{CAT\_\_CITYP}   \\
Column or field           &  \texttt{CAT\_\_FITYP}   \\
Vector column element     &  \texttt{CAT\_\_FETYP}   \\
Parameter                 &  \texttt{CAT\_\_QITYP}   \\
Expression                &  \texttt{CAT\_\_EITYP}   \\
Selection                 &  \texttt{CAT\_\_SITYP}   \\
Index                     &  \texttt{CAT\_\_IITYP}   \\
% Join                      &  \texttt{CAT\_\_JITYP}   \\
% Vector parameter element  &  \texttt{CAT\_\_QETYP}   \\
Null identifier           &  \texttt{CAT\_\_NOID}   \\
\end{tabular}
\end{center}

\caption{\label{IDTYPE}The types of identifiers}

\end{table}

The catalogue to which a component (column, parameter etc.) belongs is
referred to as the \textbf{parent} of that component. Subroutine \texttt{CAT\_TIDPR} can be used to inquire the parent of an identifier. In
CAT version \CATversion catalogues do not have parents. If \texttt{CAT\_TIDPR} is used to try to find the parent of a catalogue then the
null identifier is returned.

\subsubsection{The null identifier}

When CAT is asked to generate an identifier for an item which does not
exist (such as the parent of a catalogue) it will return the `null
identifier'. The meaning of this identifier is that the specified
component does not exist. The symbolic constant for the null identifier
is \texttt{CAT\_\_NOID}.


\subsection{Attributes}

Attributes do not have their own identifiers. An attribute is
specified by the identifier of the component of which it is a part and
its name. This combination is unique for a given attribute. For example
the `data type' attribute of a column (see Section~\ref{COLS}) is
specified by the identifier of the column and the name of the attribute
(`DTYPE' in this case). Each attribute has a data type associated with
it. Families of subroutines (one per data type) are available to set
and inquire the values of attributes:

\begin{description}

  \item[\texttt{CAT\_TATT$<$t$>$}] -- set an attribute,

  \item[\texttt{CAT\_TIQA$<$t$>$} ] -- inquire the value of an attribute.

\end{description}

See Section~\ref{SUBINT_ATT} for details of using these subroutines.

All the attributes for a given component adopt values when the component
is created. Some attributes are mandatory, in which case values must
be supplied for them. For the remaining attributes values are optional,
and if they are not supplied defaults are adopted.

Most attributes are immutable; they are specified once when the
component is created and are fixed thereafter. A few, however, are
mutable and may be changed at any stage during the life of the
component. The immutable attributes of all the columns in a catalogue
are frozen when values are first written to the table\footnote{This
description extends the discussion in Section~\ref{SIMPLE}, which for
simplicity omitted to mention mutable attributes.}.

\subsection{Catalogue attributes}

In addition to its collection of column and parameter
% and index
components,
all with their individual attributes, a catalogue also has several
attributes which apply directly to the entire catalogue, rather than to
an individual component (see Figure~\ref{CHIER} in Section~\ref{CCA}).
These attributes are described below.

\paragraph{NAME}
(data type: \_CHAR, size = \texttt{CAT\_\_SZCNM}) The name of the
catalogue. It is specified when the catalogue is created and is
mandatory and immutable. The NAME attribute is related to the file name
of the catalogue as follows. It is the same as the file name, but
without any preceding directory specification or trailing file type.
Thus, if \texttt{CATNAME} is the NAME attribute then the corresponding
file name is:

\begin{center}
\texttt{directory\_specification/CATNAME.file\_type}
\end{center}

The file type corresponds to the format of the catalogue (FITS table,
Small Text List etc). The various options are described in
Appendix~\ref{FORMAT}.

\paragraph{DATE}
(data type: \_DOUBLE)
In version \CATversion of CAT the modification date is present, but
not used. It is set to 0.0D0 when the column is created.
% The creation date of the catalogue. It
% is created automatically when the catalogue is created and is fixed
% thereafter.

\paragraph{BACK}
(data type: \_INTEGER)
The back-end type of the catalogue. It will be one of the CAT\_\_BKFIT,
CAT\_\_BKSTL or CAT\_\_BKTST. These symbolic constants are defined in
include file CAT\_PAR.

In version \CATversion of CAT the modification date is present, but
not used. It is set to 0.0D0 when the column is created.
% The creation date of the catalogue. It
% is created automatically when the catalogue is created and is fixed
% thereafter.

\paragraph{PATH}
(data type: \_CHAR, size = \texttt{CAT\_\_SZCNF}) The full path of the
catalogue file. It is specified when the catalogue is created and is
mandatory and immutable.

\subsection{\label{COLS}Columns}

A column may contain either a single value for each row (as in
standard relational database theory) or a one-dimensional array of
values for each row. An array must be of fixed size, defined when the
column is created. There is no upper limit to the number of elements
which an array may contain. A single-valued column is called a \textbf{scalar} and a column containing an array is called  a \textbf{vector}.
The attributes of a column are listed in Table~\ref{CATTRIB} and
described below.

The attributes of an individual element of a vector column are somewhat
different and are described in Section~\ref{COLUMN_ELM}, below.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{lllccl}
Attribute         & Name    & Data       & Mut-      & Mand-     & Default \\
                  &         & type       & -able     & -atory    &         \\ \hline
Name              & NAME    & \_CHAR     &           & $\bullet$ &         \\
Genus             & GENUS   & \_INTEGER  &           &           & physical: \texttt{CAT\_\_GPHYS} \\
Expression        & EXPR    & \_CHAR     &           &           & `~'     \\
Data type         & DTYPE   & \_INTEGER  &           & $\bullet$ &         \\
Character size    & CSIZE   & \_INTEGER  &           &           & 20\dag  \\
Dimensionality    & DIMS    & \_INTEGER  &           &           & scalar: \texttt{CAT\_\_SCALR} \\
Size\S            & SIZE    & \_INTEGER  &           &           & 1       \\
Null or locum     & NULL    & \_INTEGER  &           &           & HDS: \texttt{CAT\_\_NULLD} \\
Exception values  & EXCEPT  & \_CHAR     &           &           & `~'  \\
Scale factor      & SCALEF  & \_DOUBLE   &           &           & 1.0D0   \\
Zero point        & ZEROP   & \_DOUBLE   &           &           & 0.0D0   \\
Order             & ORDER   & \_INTEGER  &           &           & none: \texttt{CAT\_\_NOORD} \\
Units             & UNITS   & \_CHAR     & $\bullet$ &           & `~'     \\
External format   & EXFMT   & \_CHAR     & $\bullet$ &           & varies with data type \\
Preferential display & PRFDSP & \_LOGICAL & $\bullet$ &          & true    \\
Comments          & COMM    & \_CHAR     & $\bullet$ &           & `~'     \\
Modification date & DATE    & \_DOUBLE   & $\bullet$ &           & 0.0D0   \\
\end{tabular}
\end{center}


\begin{description}

  \item[{\rm \dag}] The size of character strings; other data types
   have CSIZE = 0.

  \item[{\rm \S}] SIZE is a single-element array, not a scalar.

\end{description}

\caption{\label{CATTRIB}Attributes of columns}

\end{table}

\paragraph{NAME}
(data type: \_CHAR, size = \texttt{CAT\_\_SZCMP})
The name of the column. The rules for column names are as follows.

\begin{itemize}

  \item The name must be unique within the totality of parameters and
   columns for the catalogue. This condition is necessary in order that
   a component (parameter or column) may be identified unambiguously
   when its name is used in an expression.

  \item A name may comprise up to fifteen characters \texttt{(CAT\_\_SZCMP}). This value is chosen for consistency with HDS and
   is adequate for FITS tables.

  \item The name can contain only: upper or lower case alphabetic
   characters (a-z, A-Z), numeric characters (0-9) and the underscore
   character (`\_'). Note that lower case alphabetic characters must
   be allowed in order to access existing FITS tables. \textit{However,
   corresponding upper and lower case characters are considered to be
   equivalent.} Thus, for example, the names: \texttt{HD\_NUMBER}, \texttt{HD\_Number} and \texttt{hd\_number} would all refer to the same column.

  \item The first character must be a letter.

\end{itemize}

\paragraph{GENUS}
(Data type: \_INTEGER)
In version \CATversion of CAT the genus attribute is present, but not
used. It is set to \texttt{CAT\_\_GPHYS} when the column is created.
% The genus of a column indicates whether it is physical or virtual.
% Two values are permitted. Unsurprisingly they correspond to
% physical and virtual columns.

\paragraph{EXPR}
(Data type: \_CHAR, size = \texttt{CAT\_\_SZEXS})
In version \CATversion of CAT the expression attribute is present, but
not used. It is set to blank (`~~') when the column is created.
% The expression used to define a virtual column. In practice this
% expression will usually be algebraic, though it could be logical
% or character.

\paragraph{DTYPE}
(Data type: \_INTEGER)
The data type of values held in the column. The types permitted are
listed in Table~\ref{DTYPES}. They are deliberately the same as the
types permitted in HDS and include the standard types of Fortran 77.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{llllc}
 HDS Type    & DEC Fortran & CAT symbolic & Description & Standard     \\
             & Type        & constant     &             & Fortran 77?  \\ \hline
% \_UBYTE      & BYTE             & \texttt{CAT\_\_TYPEUB} & Unsigned byte    & No   \\
\_BYTE       & BYTE             & \texttt{CAT\_\_TYPEB}  & Signed byte      & No   \\
% \_UWORD      & INTEGER$*$2      & \texttt{CAT\_\_TYPEUW} & Unsigned word    & No   \\
\_WORD       & INTEGER$*$2      & \texttt{CAT\_\_TYPEW}  & Signed word      & No   \\
\_INTEGER    & INTEGER          & \texttt{CAT\_\_TYPEI}  & Signed integer   & Yes  \\
\_REAL       & REAL             & \texttt{CAT\_\_TYPER}  & Single precision & Yes  \\
\_DOUBLE     & DOUBLE PRECISION & \texttt{CAT\_\_TYPED}  & Double precision & Yes  \\
\_LOGICAL    & LOGICAL          & \texttt{CAT\_\_TYPEL}  & Logical          & Yes  \\
\_CHAR[$*n$] & CHARACTER[$*n$]  & \texttt{CAT\_\_TYPEC}  & Character string & Yes  \\
\end{tabular}
\end{center}

\begin{quote}
$n$ is the number of elements in the character string; it is a positive
integer. In a CAT CHARACTER column the size of the string is stored in
attribute CSIZE.

\_BYTE and \_WORD correspond exactly to the DEC Fortran data types
BYTE and INTEGER*2 respectively; equivalent types exist in most other
implementations of Fortran. The non-standard data types typically are
required to accommodate raw data generated by instruments.
% The \_UBYTE
% type provides a value range of 0 to 255, and the \_UWORD type provides
% a value range of 0 to 65535.
The ranges of the
% other
primitive numeric
types will be defined by the particular implementation of Fortran on the
computer being used (this table is adapted from
\xref{SUN/92}{sun92}{}\cite{SUN92}.  See in particular the table in
Section 2.2, p3).
\end{quote}

\caption{\label{DTYPES}Permitted data types (adapted from
\xref{SUN/92}{sun92}{})}

\end{table}

\paragraph{CSIZE}
(Data type: \_INTEGER)
For a CHARACTER column, the size of the column, otherwise not used and
by convention set to zero.

\paragraph{DIMS}
(Data type: \_INTEGER)
The dimensionality of the column; a flag indicating whether it is a
scalar or a vector. For a scalar column it is set to \texttt{CAT\_\_SCALR}
and for a vector to \texttt{CAT\_\_VECTR}.

\paragraph{SIZE}
(Data type: \_INTEGER; a single element array\footnote{An array is used
instead of a scalar to allow the possibility of introducing
multi-dimensional arrays in a future version of CAT.})
If the column is a vector this attribute contains the number of
elements in the vector. If the column is a scalar it is set to one.

\paragraph{NULL}
(Data type: \_INTEGER)
A flag indicating whether or not null values are recognized in the
column. Three cases are recognized:

\begin{itemize}

  \item null values are present and are represented using the
   standard HDS null values (code: \texttt{CAT\_\_NULLD}),

  \item null values are present and are represented using a value
   specified when the column was created (code: \texttt{CAT\_\_NULLS}),

  \item null values are not present in the column (code:
   \texttt{CAT\_\_LOCUM}).

\end{itemize}

The treatment of null values is discussed in Section~\ref{NULLS}, below.

\paragraph{EXCEPT}
(Data type: \_CHAR, size = \texttt{CAT\_\_SZVAL})
The value used to represent the null value, or the locum value
generated if nulls are not supported in the column. See
Section~\ref{NULLS} for a full description.

\paragraph{SCALEF}
(Data type: \_DOUBLE)
The scale factor used to calculate the actual value of a scaled column
from the scaled value stored. The actual value is computed according to
the formula

\begin{equation}
{\rm actual~value} =
                ( {\rm SCALEF} \times {\rm stored~value} ) + {\rm ZEROP}
\end{equation}

\paragraph{ZEROP}
(Data type: \_DOUBLE)
The zero point used to calculate the actual value of a scaled column
from the scaled value stored. See above for the formula used.

\paragraph{ORDER}
(Data type: \_INTEGER)
The order in which individual fields in the column are stored. The
three possibilities, together with the corresponding symbolic constants,
are listed in Table~\ref{CORDER}.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{lc}
Column order  &  CAT symbolic constants \\ \hline
ascending     &  \texttt{CAT\_\_ASCND}     \\
descending    &  \texttt{CAT\_\_DSCND}     \\
unordered     &  \texttt{CAT\_\_NOORD}     \\
\end{tabular}
\end{center}

\caption{\label{CORDER}Alternatives for the ordering of columns}

\end{table}

\paragraph{UNITS}
(Data type: \_CHAR, size = \texttt{CAT\_\_SZUNI})
The units in which values stored in the column are expressed. The UNITS
attribute is used to identify, and control the appearance of, columns
of angles (see Section~\ref{ANGLES}). Apart from this exception the units
are treated purely as comments and no attempts
are made to automatically propagate and convert units in calculations
and selections. Case sensitivity is irrelevant for units since they are
treated purely as comments. The units attribute can be left completely
blank; a blank units attribute implies that the units are unknown. If
it were desired to distinguish a dimensionless quantity from one with
unknown units, the string `DIMENSIONLESS' could be put in the units
attribute\footnote{Magnitudes, which properly are dimensionless, can,
of course, have units of `MAGNITUDES' or `MAG' or whatever, if so
desired.}.

\paragraph{EXFMT}
(Data type: \_CHAR, size = \texttt{CAT\_\_SZEXF})
The format used to represent a datum extracted from a column for
external display on a screen or in a text file. These formats are used
solely for external display, not internal conversion.  The external
format specifier should be a valid Fortran 77 format specifier for the
data type of the column.

\paragraph{PRFDSP}
(Data type: \_LOGICAL)
The preferential display flag; a logical flag which indicates to
reporting applications whether, \textit{by default}, the column is to be
displayed or not. It is coded as follows:

\begin{description}

  \item[\texttt{.TRUE.}] -- display the column by default,

  \item[\texttt{.FALSE.}] -- do not display the column by default.

\end{description}

\paragraph{COMM}
(Data type: \_CHAR, size = \texttt{CAT\_\_SZCOM})
Explanatory comments describing the column. The comments may be up to
eighty characters long (\texttt{CAT\_\_SZCOM}).

\paragraph{DATE}
(Data type: \_DOUBLE)
In version \CATversion of CAT the modification date is present, but
not used. It is set to 0.0D0 when the column is created.
% The date and time when the column was most recently modified.
% Unlike all the other attributes, the modification date is set
% automatically by CAT; it cannot be set by an application or the
% user. It may, however, be inquired by an application.


\subsection{\label{COLUMN_ELM}Vector column elements}

CAT treats vectors in quite a simple fashion. Values can only be GOT
or PUT for individual vector elements; there are no routines for
processing entire vectors. In order to access individual elements it
is necessary to assign identifiers to them. Identifiers for vector
elements, like those for scalar columns and parameters, are obtained
using \texttt{CAT\_TIDNT}. The name of a vector column element passed to
\texttt{CAT\_TIDNT} has the same syntax as the NAME attribute of the
element, as described below. The attributes of a vector column element
identifier are different to the identifiers for the whole column; they
are listed in Table~\ref{VCOL_ELEM}.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{lll}
Attribute       & Name    & Data type  \\ \hline
Name            & NAME    & \_CHAR     \\
Data type       & DTYPE   & \_INTEGER  \\
Character size  & CSIZE   & \_INTEGER  \\
Base identifier & BASEID  & \_INTEGER  \\
Vector element  & ELEM    & \_INTEGER  \\
\end{tabular}
\end{center}

\caption{\label{VCOL_ELEM}Attributes of a vector column element}

\end{table}

All these attributes are created automatically when an identifier is
obtained for the element; they are all mandatory and immutable.

The vector column to which a vector column element belongs is
referred to as the column element's \textbf{base column}. The DTYPE and
CSIZE attributes of a vector column element are necessarily identical
to the corresponding attributes for its base column. The details of the
remaining attributes are as follows.

\paragraph{NAME}
(data type: \_CHAR, size = \texttt{CAT\_\_SZCMP})
The name of the vector column element. That is, the name of the base
column, followed by the number of the vector element, enclosed in
square brackets. The number of the first element is one. Thus, the name
of the fourth element of vector column \texttt{FLUX} would be \texttt{FLUX[4]}.

\paragraph{BASEID}
(data type: \_INTEGER)
The identifier of the base column of the vector element.

\paragraph{ELEM}
(data type: \_INTEGER)
The sequence number of the element in the column vector. The first
element is numbered one. Thus, for example, if the name of the vector
column element was \texttt{FLUX[4]} the value of the ELEM attribute
would be four.


\subsection{\label{PARS}Parameters}

Parameters are items of information which apply to the entire catalogue.
Examples are the equinox or epoch of the celestial coordinates in the
catalogue. The attributes of a parameter are given in
Table~\ref{PATTRIB}. In CAT version \CATversion parameters must be
scalars. However, they have the attributes dimensionality and size to
allow for the possibility of vector parameters in future versions of
CAT.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{lllcl}
Attribute          & Name    & Data       & Mand-     & Default \\
                   &         & type       & -atory    &       \\ \hline
Name               & NAME    & \_CHAR     & $\bullet$ &         \\
Data type          & DTYPE   & \_INTEGER  & $\bullet$ &         \\
Character size     & CSIZE   & \_INTEGER  &           & \texttt{CAT\_\_SZVAL}\dag \\
Dimensionality     & DIMS    & \_INTEGER  &           & scalar: \texttt{CAT\_\_SCALR} \\
Size\S             & SIZE    & \_INTEGER  &           & 1       \\
Units              & UNITS   & \_CHAR     &           & `~'     \\
External format    & EXFMT   & \_CHAR     &           & varies with data type \\
Preferential display & PRFDSP & \_LOGICAL &           & true    \\
Comments           & COMM    & \_CHAR     &           & `~'     \\
Value              & VALUE   & varies     &           & zero or `~' \\
Modification date  & DATE    & \_DOUBLE   &           & 0.0D0   \\
\end{tabular}
\end{center}

\begin{description}

  \item[{\rm \dag}] The size of character strings; other data types
   have CSIZE = 0.

  \item[{\rm \S}] SIZE is a single-element array, not a scalar.

\end{description}

\caption{\label{PATTRIB}Attributes of parameters}

\end{table}

All these attributes, except \textbf{VALUE}, are deliberately identical to
the corresponding attributes for columns (see Table~\ref{CATTRIB} and
Section~\ref{COLS}, above, for details).

\paragraph{VALUE}
(Data type: variable, corresponds to attribute DTYPE)
The value of the parameter; it is mutable.


\subsection{Expressions}

Expressions define a quantity computed from the existing scalar columns,
vector column elements and parameters of a catalogue using some
algebraic or logical (boolean) expression. An expression adopts a value
for every row in the catalogue. It is similar to a column, except that
its value is computed `on the fly' from existing columns (and
parameters), rather than being stored in the catalogue. Usually an
expression will evaluate to a numeric value, but it may equally well
evaluate to a LOGICAL or CHARACTER value. For example, if a catalogue
contained columns \texttt{x} and \texttt{y} an expression might be `\texttt{x + y}'. The syntax for specifying expressions is described in
Appendix~\ref{EXPR}.

An expression has a set of attributes which are identical to those for
a scalar column (see Section~\ref{COLS} and Table~\ref{CATTRIB}), but
with the following exceptions.

\begin{itemize}

  \item The GENUS attribute is always set to \texttt{CAT\_\_GVIRT}.

  \item The EXPR attribute is set to the algebraic expression used to
   compute the value of the expression.

  \item The DIMS attribute is always \texttt{CAT\_\_SCALR}; expressions are
   always scalars and vector expressions are forbidden.

\end{itemize}


\subsection{Selections}

Selections define a set of rows selected from a catalogue according to
some criteria. For example, if a catalogue contained column \texttt{x}
then the selection criterion might be `\texttt{x $>$ 10.0}', that is, the
selection would comprise the set of rows for which the field of column
\texttt{x} was greater than 10.0. The syntax for specifying expressions is
described in Appendix~\ref{EXPR}.

The attributes of a selection are listed in Table~\ref{SELECT_ATT}
and described below. With the exception of the comments attribute,
COMM, they are all mandatory and immutable and are set automatically
when the selection is created.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{lll}
Attribute         & Name    & Data type  \\ \hline
Expression        & EXPR    & \_CHAR     \\
Number of rows    & NUMSEL  & \_INTEGER  \\
Comments          & COMM    & \_CHAR     \\
Modification date & DATE    & \_DOUBLE   \\
\end{tabular}
\end{center}

\caption{\label{SELECT_ATT}Attributes of a selection}

\end{table}

\paragraph{EXPR}
(Data type: \_CHAR, size = \texttt{CAT\_\_SZEXS})
The expression which rows in the catalogue must satisfy in order to be
included in the selection.

\paragraph{NUMSEL}
(Data type: \_INTEGER)
The number of rows in the selection.

\paragraph{COMM}
(Data type: \_CHAR, size = \texttt{CAT\_\_SZCOM})
Explanatory comments describing the selection.

\paragraph{DATE}
(Data type: \_DOUBLE)
In version \CATversion of CAT the modification date is present, but
not used. It is set to 0.0D0 when the selection is created.
% The date and time when the selection was created.
% Unlike all the other attributes, the modification date is set
% automatically by CAT; it cannot be set by an application or the
% user. It may, however, be inquired by an application.


\subsection{Indices}

Indices are a mechanism for accessing the rows of a catalogue as though
they were sorted into ascending or descending order on some column.  For
example, if an ascending index was created on REAL column \texttt{DEC} and
the rows of the catalogue were accessed through this index the rows
would appear in ascending order of \texttt{DEC}. \textit{In CAT version
\CATversion indices are temporary entities which persist only for the
duration of the application which generated them and perish when it
terminates.} Future versions of CAT will support permanent indices which
persist after the application which generated them terminates.

Indices can be created from columns of any of the numeric data types.
They should not be created from columns of data type CHARACTER or
LOGICAL. If an index is created on a column which contains null values
then the rows for which the column is null will appear after all the
rows with a valid value. The order of such rows is unpredictable.

The attributes of an index are listed in Table~\ref{INDEX_ATT} and
described below. They are all mandatory and immutable and are set
automatically when the index is created.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{lll}
Attribute         & Name    & Data type  \\ \hline
Column identifier & COLID   & \_INTEGER  \\
Order             & ORDER   & \_INTEGER  \\
Number of rows    & NUMSEL  & \_INTEGER  \\
Comments          & COMM    & \_CHAR     \\
Modification date & DATE    & \_DOUBLE   \\
\end{tabular}
\end{center}

\caption{\label{INDEX_ATT}Attributes of an index}

\end{table}

\paragraph{COLID}
(Data type: \_INTEGER)
The identifier of the column from which the index was created.

\paragraph{ORDER}
(Data type: \_INTEGER)
The order of the index. The possibilities are:

\begin{verse}
\texttt{CAT\_\_ASCND} -- ascending,  \\
\texttt{CAT\_\_DSCND} -- descending.
\end{verse}

\paragraph{NUMSEL}
(Data type: \_INTEGER)
The number of rows in the index. In CAT version \CATversion the number
of rows in the index is necessarily the number of rows in the catalogue.
The attribute is present in order to allow indices to be created from
selections in future versions of CAT.

\paragraph{COMM}
(Data type: \_CHAR, size = \texttt{CAT\_\_SZCOM})
Explanatory comments describing the index.

\paragraph{DATE}
(Data type: \_DOUBLE)
In version \CATversion of CAT the modification date is present, but
not used. It is set to 0.0D0 when the selection is created.
% The date and time when the index was created.
% Unlike all the other attributes, the modification date is set
% automatically by CAT; it cannot be set by an application or the
% user. It may, however, be inquired by an application.


\section{\label{SUBINT}\xlabel{SUBINT}Subroutine interface}

% -- Subroutine interface ----------------------------------------------

% \input{subsum.tex}


% This section gives summary documentation for the external subroutines
% in the CAT library.

This section introduces all the subroutines in the CAT library, with the
subroutines arranged by function. For each subroutine the calling
sequence and a brief description is given. Standard names are used for
the calling arguments. A complete description of each subroutine is
given in Appendix~\ref{DETAIL}. Following normal Starlink practice the
subroutine arguments are arranged in the order:

\begin{verse}
given,  \\
given and returned,  \\
returned,  \\
global (or running) status.
\end{verse}

A semi-colon (`;') is used to separate these various categories in the
calling sequences given in this section.


\subsection{Provision for future enhancements}

This manual describes version \CATversion of the CAT library.  The
original specification for the library is described in the document \textit{The Starlink Subroutine Interface for Manipulating Catalogues}\/
(StarBase/ACD/3.4)\cite{STARBASE34}.  Version \CATversion of CAT is a
subset of this full implementation and some of the items present in it
serve no apparent purpose.  These items correspond to features which were
in the original specification but which are not currently implemented.
These items may be implemented in future versions and have been included
so that applications written now will be compatible with future versions
of the library.

\subsection{Symbolic constants}

Two INCLUDE files of symbolic constants are available for use with these
subroutines: \texttt{CAT\_PAR} and \texttt{CAT\_ERR}. \texttt{CAT\_PAR} contains
symbolic constants which specify the size of various items, codes
corresponding to various types of items, values for various flags etc.
\texttt{CAT\_ERR} contains symbolic constants corresponding to the various
error codes which the CAT library can set. Section~\ref{INCLUDE}
explains how to access these files. I recommend that you print out
copies of these files and have them to hand when writing applications.
The comments included in the files should be sufficient to explain the
purpose of each constant. If your application needs to access one of
these values you should \textit{always}\, use the appropriate symbolic
constant; \textit{never}\, hard-code the actual value into your code.
The values may (and probably will) change in subsequent releases of
the CAT library.


\subsection{Subroutine names}

The CAT subroutine names follow the normal Starlink format of a prefix,
an underscore (`\_') and a five-character routine name (see
SGP/16\cite{SGP16}).

For most routines, the first letter of the main body of the subroutine
name denotes the sort of item that the subroutine operates on, according
to the following scheme:

\begin{tabular}{lcl}
T & - & total, or whole catalogue, \\
P & - & part (column or parameter), \\
C & - & columns (entire columns), \\
R & - & rows,        \\
Q & - & parameters,  \\
% I & - & indices,     \\
E & - & expressions (algebraic expressions), \\
S & - & selections,  \\
% J & - & joins.       \\
\end{tabular}

The ADAM routines (see Section~\ref{ADAM}) are exceptions; they have
names chosen to be consistent with the corresponding routines in other
ADAM libraries.

\subsection{Identifiers}

CAT identifies catalogues and components by various sorts of
\textbf{identifiers}; INTEGER numbers, each with a unique value. In the
calling arguments for the subroutines the following names are usually
used for the various sorts of identifier:

\begin{tabular}{lcl}
GI & - & generic, \\
CI & - & catalogue, \\
PI & - & part (column or parameter), \\
FI & - & column (F for field), \\
QI & - & parameter, \\
EI & - & expression, \\
% II & - & index, \\
SI & - & selection \\
% JI & - & join \\
\end{tabular}

The following rules apply:

\begin{enumerate}

  \item A generic identifier may be substituted by \textit{any}\, type
   of identifier,

%  \item a catalogue identifier may be substituted by an index, selection
%   or join identifier for any READ operation, but \textit{never}\, for an
%   UPDATE or WRITE operation,

  \item there are circumstances where it is sensible to consider columns
   and parameters to be a single sort of component; in these
   circumstances, components and parameters are referred to collectively
   as \textit{parts;}\, a part identifier may be substituted by either a
   column or a parameter identifier.

  \item an expression identifier may be substituted by a field,
   parameter (or hence part) identifier.

\end{enumerate}

% The relations between the various sorts of identifiers are shown in
% Figure~\ref{HIERID}.

% \textsf{I am still not sure that this is either correct or useful.}

% \begin{figure}[htbp]
% \begin{center}

% \begin{tabular}{ll}
% Hierarchy   &  Description      \\ \hline
% GI          &  generic          \\
% ~~CI        &  catalogue        \\
% ~~SI        &  selection        \\
% ~~EI        &  expression       \\
% ~~PI        &  part             \\
% ~~~~FI      &  column or field  \\
% ~~~~QI      &  parameter        \\
% \end{tabular}
% \end{center}

% Subordinate classes of identifiers are indented to the right. Thus a
% part identifier may be substituted by a column or parameter identifier
% and an expression identifier may be substituted by a part, column or
% parameter identifier etc.

% \caption{\label{HIERID}The hierarchy of types of identifiers}

% \end{figure}


\subsection{\label{NONADAM}Initialization, opening and closing catalogues}

Every open catalogue is identified to CAT by a catalogue identifier;
an INTEGER number with a unique value. The catalogue identifier is
subroutine argument \texttt{CI} in the following notes. The ADAM routines
(see Section~\ref{ADAM}, below) provide an alternative to \texttt{CAT\_TOPEN} for opening or creating a catalogue.

\begin{description}

  \item[ \texttt{CAT\_TOPEN (CNAME, STATE, MODE; CI; STATUS) } ] ~
  \newline Open a catalogue and obtain an identifier to it.
  \newline STATE = one of: NEW or OLD,
  \newline MODE = one of: WRITE or READ.

  \item[ \texttt{CAT\_TRLSE (CI; STATUS) } ] ~
  \newline Release a catalogue identifier.

  \item[ \texttt{CAT\_RSET (CI, ROWS, STATUS) } ] ~
  \newline Set the number of rows which a new catalogue is expected to
   contain.  This routine is optional.  If used, then it is ignored by
   some catalogue formats.  With others, such as the Small Text List,
   then the catalogue may be created more efficiently.

\end{description}


\subsection{\label{ADAM}ADAM subroutines}

These subroutines interact with the ADAM parameter system. They provide
alternatives to \texttt{CAT\_TOPEN} (see Section~\ref{NONADAM}, above) for
opening a catalogue. They are provided for compatibility with other
ADAM libraries and each provides analogous functionality to equivalently
named routines in other ADAM libraries.

\begin{description}

  \item[ \texttt{CAT\_ASSOC (PCNAME, MODE; CI; STATUS) } ] ~
  \newline Open an existing catalogue; the name of the catalogue is
   obtained from an ADAM parameter. Argument \texttt{MODE} must always
   be \texttt{`READ'} in version \CATversion of CAT.

  \item[ \texttt{CAT\_CREAT (PCNAME; CI; STATUS) } ] ~
  \newline Create a new catalogue; the name of the catalogue is obtained
   from an ADAM parameter.

  \item[ \texttt{CAT\_EXIST (PCNAME, MODE; CI; STATUS) } ] ~
  \newline Attempt to open a catalogue, the name being taken from the
   ADAM parameter system. If the attempt fails then instead of
   re-prompting the subroutine returns with an error status. This
   subroutine can be used to check the existence of a catalogue.

\end{description}


\subsection{Catalogue inquiry routines}

These routines perform general `high-level' inquiries on a catalogue.
\texttt{CAT\_TCOLS} is not strictly necessary; its function is
provided by \texttt{CAT\_TDETL}. However, it is convenient in practice.

\begin{description}

  \item[ \texttt{CAT\_TDETL (CI, COLFLG; NUMROW, NUMCOL, NUMIND, NUMPAR,
   DATE; STATUS) } ] ~
  \newline Get the details of a catalogue. In CAT version \CATversion
   argument \texttt{COLFLG} should be set to \texttt{CAT\_\_GPHYS}.

  \item[ \texttt{CAT\_TROWS (CI; NUMROW; STATUS) } ] ~ \\
   Get the number of rows in a catalogue, selection or index. This
   routine may be given a catalogue, selection or index identifier.  It
   will return the number of rows in the catalogue, selection or index,
   as appropriate.

  \item[ \texttt{CAT\_TCOLS (CI, COLFLG; NUMCOL; STATUS) } ] ~ \\
   Get the number of columns in a catalogue. In CAT version \CATversion
   argument \texttt{COLFLG} should be set to \texttt{CAT\_\_GPHYS}.

  \item[ \texttt{CAT\_TIDTP (GI; IDTYP; STATUS) } ] ~ \\
   Determine the type of an identifier. The codes for the various types
   of identifiers are shown in Table~\ref{IDTYPE}.

\end{description}

\subsection{Component manipulation}

\begin{description}

  \item[ \texttt{CAT\_TIDNT (CI, GNAME; GI; STATUS) } ] ~
  \newline Get an identifier for a named pre-existing component.

  \item[ \texttt{CAT\_TNDNT (CI, IDTYP, N; GI; STATUS) } ] ~
  \newline Get an identifier for the $n$\/th (pre-existing) component of a
   given type.  Note that if component $n$\, could not be found then the
   routine returns an ok status, but \texttt{GI} is set to null identifier
   \texttt{CAT\_\_NOID}.

  \item[ \texttt{CAT\_TIDPR (GI; CI; STATUS) } ] ~
  \newline Determine the parent of a component.

\end{description}

\subsubsection{\label{SUBINT_ATT}Manipulating attributes of a component}

\begin{description}

  \item[ \texttt{CAT\_TATT<t> (GI, ATTRIB, VALUE; STATUS) } ] ~
  \newline Set an attribute of a component to a given value. Type
   conversions are performed if necessary.

  \item[ \texttt{CAT\_TIQA<t> (GI, ATTRIB; VALUE; STATUS) } ] ~ \\
   Inquire the value of a single attribute for a component.

\end{description}

\subsubsection{Parts: columns and parameters}

\begin{description}

  \item[ \texttt{CAT\_PNEW0 (CI, PTYPE, PNAME, DTYPE; PI; STATUS) } ] ~
  \newline Create a scalar part (column or parameter).

\end{description}

\subsubsection{\label{SUBINT_COL}Columns}

\begin{description}

  \item[ \texttt{CAT\_CNEWA (CI, FNAME, EXPR, DTYPE,
   CSIZE, DIMS, SIZEA, NULL, EXCEPT, } ] ~
  \newline \texttt{SCALEF, ZEROP, ORDER, UNITS, EXTFMT, PRFDSP, COMM;
   FI; STATUS) }
  \newline Create a column, simultaneously setting all its attributes.

  \item[ \texttt{CAT\_CNEWS (CI, FNAME, DTYPE, CSIZE, UNITS, EXTFMT, COMM;
   FI; STATUS)} ] ~
  \newline Create a column, simultaneously setting some of the more
   frequently used attributes. These attributes deliberately correspond
   to the ones usually used in FITS tables. Note that if a CHARACTER
   column is created then the default CHARACTER size of twenty will be
   adopted unless \texttt{CAT\_TATTC} is used to set the character size.

  \item[ \texttt{CAT\_CINQ (FI, SZDIM; CI, FNAME, GENUS, EXPR, DTYPE,
   CSIZE, DIMS, SIZEA, } ] ~
  \newline \texttt{NULL, EXCEPT, SCALEF, ZEROP, ORDER, UNITS, EXTFMT,
   PRFDSP, COMM,}
  \newline \texttt{DATE; STATUS) }
  \newline Inquire the values of all the attributes for a column. Type
   conversions are performed if necessary. If the conversion fails a
   status is set (this is only likely to be important for null values).
   Note that the exception value is forced into type CHARACTER in order
   to avoid having a family of routines. Note also that the genus
   attribute is returned explicitly.

\end{description}

\subsubsection{\label{SUBINT_PAR}Parameters}

\begin{description}

  \item[ \texttt{CAT\_PPTA$<$t$>$ (CI, QNAME, CSIZE, DIMS, SIZEA, UNITS,
   EXTFMT, PRFDSP, COMM, } ] ~
  \newline \texttt{VALUE; QI; STATUS) }
  \newline Create a parameter, simultaneously setting all its
   attributes.

  \item[ \texttt{CAT\_PPTS$<$t$>$ (CI, QNAME, VALUE, COMM; QI; STATUS)
   } ] ~
  \newline Create a parameter, simultaneously setting its value and
   comment attributes. These attributes deliberately correspond to the
   ones usually used in FITS tables. Note that if a CHARACTER
   parameter is created then the default character size of \texttt{CAT\_\_SZVAL} will be adopted unless \texttt{CAT\_TATTC} is used to set
   the character size.

  \item[ \texttt{CAT\_PINQ (QI, SZDIM; CI, PNAME, DTYPE, CSIZE, DIMS,
   SIZEA, UNITS, EXTFMT, } ] ~
  \newline \texttt{PRFDSP, COMM, VALUE, DATE; STATUS) }
  \newline Inquire the values of all the attributes for a parameter.

\end{description}

\subsubsection{Expressions}

\begin{description}

  \item[ \texttt{CAT\_EIDNT (CI, EXPR; EI; STATUS) } ] ~
  \newline Get an identifier for an expression. The syntax of
   expressions is described in Appendix~\ref{EXPR}.

\end{description}

\subsubsection{Selections}

The selection routines return a selection identifier which corresponds
to the set of rows which satisfy the criteria of the selection. There
are two routines for generating a selection: \texttt{CAT\_SELCT} and
\texttt{CAT\_SFND$<$t$>$}. \texttt{CAT\_SELCT} allows complex selections to be
performed according to complicated criteria. A logical (or boolean)
expression defining the selection is supplied and all the rows in the
catalogue for which this expression evaluates to \texttt{.TRUE.} are
selected. \texttt{CAT\_SFND$<$t$>$} allows a simple range of values to be
selected for a sorted column. Usually \texttt{CAT\_SELCT} will execute
more slowly than \texttt{CAT\_SFND$<$t$>$} because whereas \texttt{CAT\_SELCT} must necessarily access every row in the catalogue,
\texttt{CAT\_SFND$<$t$>$} can exploit the ordering of the chosen column to
immediately identify the required rows (remember the mnemonic F for
Find and Fast, S for Select and Slow).

\texttt{CAT\_SLIST} allows a specialized application to create a non-standard
selection.

All the selection routines may operate on either an entire catalogue
or some previous selection. They all uniformly and consistently
provide an option to create a second selection of all the rejected rows.

\begin{description}

  \item[ \texttt{CAT\_SELCT (CI, EI, REJFLG; SI, NUMSEL, SIR, NUMREJ;
   STATUS) } ] ~
  \newline Create a selection of rows satisfying some expression.

  \item[ \texttt{CAT\_SFND$<$t$>$ (CI, FI, MINRNG, MAXRNG, REJFLG; SI,
   NUMSEL, SIR, NUMREJ; } ] ~
  \newline \texttt{STATUS) }
  \newline Create a selection of the rows in a catalogue for which the
   fields of a specified sorted column lie within a given range.

  \item[ \texttt{CAT\_SLIST (NUMSEL, SELIST, CRIT, REJFLG, CI, SI, SIR,
   NUMREJ, STATUS) } ] ~
  \newline Create a selection from an array of row numbers.

  \item[ \texttt{CAT\_SINQ (SI; CI, EXPR, NUMSEL, COMM, DATE; STATUS) } ] ~
  \newline Inquire all the attributes of a selection.

\end{description}

\subsubsection{Indices}

The index generation routine generates an index from a given numeric
column and returns an identifier which allows the rows in the catalogue
to be accessed as though they were sorted on the column.   \textit{In CAT
version \CATversion only temporary indices, which persist for the
duration of the application which generated them, are supported.}

\begin{description}

  \item[ \texttt{CAT\_INEW (FI, DISP, ORDER; II; STATUS) } ] ~
  \newline Create an index on a column.

  \item[ \texttt{CAT\_IINQ (II; CI, FI, ORDER, NUMSEL, COMM, DATE; STATUS) } ] ~
  \newline Inquire all the attributes of an index.

\end{description}

\subsubsection{Row level manipulation routines}

These routines manipulate a single row in a catalogue. They are based
around the concepts of the `current row' and the `current row buffer'.
The current row is a single row in a catalogue which CAT is
currently operating on. A copy of the current row is kept in a buffer
within CAT. The various row and field manipulation routines operate
on the copy of the current row in the current row buffer. As
appropriate, the current row buffer can be copied out to the catalogue
and a new row copied into the current row buffer.

The `current row buffer' is an abstract concept to describe how CAT
behaves when an application calls it. It is my solution to obtaining
an arbitrary number of fields of arbitrary type in a single
% troll
pass through a catalogue. The trick is separating reading rows in the
catalogue into the `current row buffer' and having the GET and PUT
operations operate on this buffer. Applications should be written in the
form:

\begin{terminalv}
for all the rows to be processed
  Read the required row into the current row buffer.
  Get a field from the buffer.
  Get another field from the buffer.
  Get yet another field from the buffer.
  and so on...
end for
\end{terminalv}

None of the solutions to this problem are ideal and the disadvantage of
the one adopted is that the resulting subroutine interface is quite
`low level' and verbose to use. However, it does allow an arbitrary
number of columns of arbitrary type to be extracted in a single
% troll
pass through the catalogue.

New rows can be added to an existing catalogue only by appending them
to the end of the catalogue.

When a catalogue is opened (that is, an identifier is obtained for it),
its first row is copied into the current row buffer.  Thus, if the
current row buffer is accessed without first GETting a specified
row with \texttt{CAT\_RGET} the contents of the first row will be obtained.

\begin{description}

  \item[ \texttt{CAT\_RGET (CI, ROWNO; STATUS) } ] ~
  \newline Read a specified row from the catalogue into the current row
   buffer. \texttt{CI} may be either a catalogue, selection or index
   identifier.

  \item[ \texttt{CAT\_RAPND (CI; STATUS) } ] ~
  \newline Append the current row buffer as a new row at the end of the
   catalogue. \texttt{CI} must necessarily be a catalogue identifier.

\end{description}


\subsubsection{Getting and putting values}

The basic routines for getting and putting values GET from and PUT to
the current row buffer. The following rules apply:

\begin{itemize}

  \item scalar values are always GOT from expressions (that is, an
   expression is evaluated using the values of fields extracted from
   the current row buffer). However, simple column names and parameter
   names are valid expressions. Therefore, any one of an: expression,
   column, vector column element or parameter identifier may be used
   in the GET routine \texttt{CAT\_EGT0$<$t$>$},

  \item values can only be PUT to scalar columns or vector column
   elements, not to expressions or parameters (the notion of PUTting to
   an expression is a nonsense and there are alternative routines for
   setting the value of a parameter).

\end{itemize}

Section~\ref{NULLAPP} prescribes how applications should handle null
values.

\begin{description}

  \item[ \texttt{CAT\_EGT0<t> (GI; VALUE, NULFLG; STATUS) } ] ~
  \newline Get the value of a scalar expression, evaluated from the
   current row buffer. \texttt{GI} may be either: an expression, column,
   vector column element or parameter identifier.

  \item[ \texttt{CAT\_EGT0F (GI; VALUE, NULFLG; STATUS) } ] ~
  \newline Get the value of a scalar expression, evaluated from the
   current row buffer and formatted into a character string using the
   external display format for the column, parameter or expression. \texttt{GI} may be either: an expression, column, vector column element or
   parameter identifier.

  \item[ \texttt{CAT\_PUT0<t> (FI, VALUE, NULFLG; STATUS) } ] ~
  \newline Put a value to a field. The value is written to the current
   row buffer. \texttt{FI} may be either a column or vector column element
   identifier.

\end{description}

For convenience two additional routines are provided for getting
values which include the row from which the value is to be obtained.
Otherwise they are similar to \texttt{CAT\_EGT0<t>} and \texttt{CAT\_EGT0F}
(indeed they are wrap-arounds of \texttt{CAT\_RGET} followed by
\texttt{CAT\_EGT0<t>} or \texttt{CAT\_EGT0F}).

\begin{description}

  \item[ \texttt{CAT\_FGT0<t> (CI, ROWNO, GI; VALUE, NULFLG; STATUS) } ] ~
  \newline Get the value of a scalar expression, evaluated from a
   specified row. \texttt{CI} may be either: a catalogue, selection or
   index identifier. \texttt{GI} may be either: an expression, column,
   vector column element or parameter identifier.

  \item[ \texttt{CAT\_FGT0F (CI, ROWNO, GI; VALUE, NULFLG; STATUS) } ] ~
  \newline Get the value of a scalar expression, evaluated from a
   specified row. and formatted into a character string using the
   external display format for the column, parameter or expression. \texttt{CI} may be either: a catalogue, selection or index identifier. \texttt{GI} may be either: an expression, column, vector column element or
   parameter identifier.

\end{description}

\subsection{\label{SUBINT_TEXT}Textual information}

This set of routines provide access to any textual information
associated with the catalogue\footnote{These routines were not included
in the original specification for the CAT subroutine interface, as
described in \textit{The Starlink Subroutine Interface for Manipulating
Catalogues}\/ (StarBase/ACD/3.4)\cite{STARBASE34}; they were added later.}.
They try to keep access to the textual information as simple as possible.
The text is accessed one line at a time, with each line corresponding, for
example, to a single FITS COMMENT or HISTORY keyword. No facilities are
provided to interpret a line. It is assumed that each line will either
be displayed to the user or copied to another catalogue.

\texttt{CAT\_GETXT} returns a single line of text. Subsequent calls to
\texttt{CAT\_GETXT} work sequentially through the textual information,
returning the lines in sequence.  The application cannot specify that it
wants a particular line.  However \texttt{CAT\_RSTXT} is provided to `reset'
the sequence for a catalogue, so that the textual information can be
read through an arbitrary number of times.

Each line has a class associated with it. When a line is read the
class is returned; an application cannot prescribe that it wants a
class of a particular value. The classes supported vary for the
different catalogue formats, though on output the standard classes
COMMENT and HISTORY are always available. Appendix~\ref{FORMAT}
lists the classes supported by individual catalogue formats.

A call to \texttt{CAT\_PUTXT} appends a line of textual information to the
end of the existing textual information for a catalogue.  The only way
to add new textual information is by appending it to the end.

In all these routines \texttt{CI} must be a catalogue identifier.

\begin{description}

  \item[ \texttt{CAT\_GETXT (CI; FINISH, CLASS, TEXT; STATUS)} ] ~
  \newline Get the next line of textual information from a catalogue.

  \item[ \texttt{CAT\_PUTXT (CI, CLASS, TEXT; STATUS)} ] ~
  \newline Put a line of textual information to a catalogue.

  \item[ \texttt{CAT\_RSTXT (CI; STATUS)} ] ~
  \newline Reset the access to the textual information in a given
   catalogue. A subsequent call to \texttt{CAT\_GETXT} would return the
   first line of textual information.

  \item[ \texttt{CAT\_SZTXT (CI, ACCESS; LINESZ; STATUS)} ] ~
  \newline Return the maximum permitted size of a line of textual
   information in a catalogue.  The maximum size is determined by the
   format of the catalogue and the access mode (READ or WRITE).

\end{description}

\subsection{Miscellaneous}

\begin{description}

  \item[ \texttt{CAT\_TUNES (CATPRM, VALUE; STATUS) } ] ~
  \newline Set a CAT tuning parameter. Note that all these parameters
   are of type CHARACTER.

  \item[ \texttt{CAT\_TUNEG (CATPRM; VALUE; STATUS) } ] ~
  \newline Get a CAT tuning parameter. Note that all these parameters
   are of type CHARACTER.

  \item[ \texttt{CAT\_TYFMT (DTYPE, CSIZE; STRING, POSN; STATUS) } ] ~
  \newline Construct a character string representation of a CAT
   data type and append it to a character string. This character string
   representation is (deliberately) identical to that used by HDS.

  \item[ \texttt{CAT\_SRNG$<$t$>$ (CI, FI, MINRNG, MAXRNG; FIRSTR, LASTR;
   STATUS) } ] ~
  \newline Get the rows corresponding to a range for a sorted column.
   This routine is similar to \texttt{CAT\_SFND$<$t$>$}, but it returns
   the first and last rows within the specified range, rather than
   generating a selection.

\end{description}

% ----------------------------------------------------------------------


\section{\label{PRINC}\xlabel{PRINC}Features of the library}

This section describes some aspects of the behaviour of the CAT library.

\subsection{Copying parameters and fields}

Parameters and fields have a defined data type (\_DOUBLE, \_REAL etc.).
Families of subroutines are available for transferring the values of
parameters, columns and fields between a catalogue and Fortran variables
in an application program invoking the CAT interface. These Fortran
variables may be of a variety of types. The type of the column or
parameter need not correspond to the type of the Fortran variable; the
interface will automatically attempt a type conversion. However,
depending on the types involved, a conversion may not be possible for
some values. The matrix of possibilities is shown in
Table~\ref{CONVMAT}. This matrix is used for \textit{all}\, conversions:
both GET and PUT operations for both columns (or fields) and parameters.

\begin{table}[htbp]

\begin{center}
{\footnotesize
\begin{tabular}{r|ccccccccc}
Destination &\multicolumn{9}{c}{Start or initial type} \\
type    & UBYTE & BYTE  & UWORD & WORD  & INTEGER & REAL  & DOUBLE & LOGICAL & CHAR   \\ \hline
UBYTE   &  yes  & maybe & maybe & maybe & maybe   & maybe & maybe  &   yes   & maybe  \\
BYTE    & maybe &  yes  & maybe & maybe & maybe   & maybe & maybe  &   yes   & maybe  \\
UWORD   &  yes  &  yes  &  yes  & maybe & maybe   & maybe & maybe  &   yes   & maybe  \\
WORD    &  yes  &  yes  & maybe &  yes  & maybe   & maybe & maybe  &   yes   & maybe  \\
INTEGER &  yes  &  yes  &  yes  &  yes  &  yes    & maybe & maybe  &   yes   & maybe  \\
REAL    &  yes  &  yes  &  yes  &  yes  &  yes    &  yes  & maybe  &   yes   & maybe  \\
DOUBLE  &  yes  &  yes  &  yes  &  yes  &  yes    &  yes  &  yes   &   yes   & maybe  \\
LOGICAL &  yes  &  yes  &  yes  &  yes  &  yes    &  yes  &  yes   &   yes   &  yes   \\
CHAR    & maybe & maybe & maybe & maybe & maybe   & maybe & maybe  &   yes   & maybe  \\
\end{tabular}  }
\end{center}

\begin{quote}
\textbf{Key:}

\begin{description}

  \item[yes] conversion is always possible,

  \item[maybe] conversion may be possible.

%*****  \item[err] conversion is never possible.

\end{description}

Note that converting a character string to a character string may result
in an error because truncation may occur.
\end{quote}

\caption{\label{CONVMAT}Conversion matrix for copying different types}

\end{table}

If a type conversion fails the appropriate exception value (null or
locum, see Section~\ref{NULLS}, below) is substituted for the missing
value. The error status is not set (that is, it remains ok) and no
error message is generated.
% However, a warning message may be generated
% if a locum is generated (again see see Section~\ref{NULLS}, below).
This procedure is followed consistently for all type conversions. It is
adopted because, in practice, conversion failures are common.

The rules for converting to and from the \_LOGICAL data type are as
follows

\begin{description}

  \item[From logical] ~
  \begin{itemize}

    \item Conversion from LOGICAL to CHARACTER*$n$ gives `TRUE' or
     `FALSE' if $n$ is greater than or equal to 5 and `T' or `F'
     otherwise.

    \item Conversion from LOGICAL to INTEGER is defined such that true
     converts to 1 and false converts to 0.

    \item Conversion from LOGICAL to a numeric type except INTEGER is
     equivalent to converting LOGICAL to INTEGER and then INTEGER to the
     required numeric type.

  \end{itemize}

  \item[To logical] ~
  \begin{itemize}

    \item Any character string beginning with `T' (upper or lower case)
     converts to true; any other string converts to false.

    \item Any even INTEGER converts to false; any odd INTEGER converts
     to true (this behaviour is specified for compatibility with HDS).

    \item Conversion for other numeric types is equivalent to
     conversion from the type to INTEGER and then from INTEGER to
     LOGICAL.

  \end{itemize}

\end{description}

% Implicit, automatic conversions between LOGICAL and numeric data types
% are permitted. However, in addition, the parser contains explicit
% functions for this purpose.


\subsection{\label{NULLS}Null and locum values}

\subsubsection{Rationale and behaviour}

Null values are used to represent a datum where no actual value is
available. An example might be multi-colour photometry for a set of
stars where measures for some colours are missing for some of the stars.
Null values would be used to represent the missing values. Throughout
CAT, and the applications that call it, nulls have the single,
simple meaning that `no value is available for this datum'. It is
possible to invent schemes where a set of null values are supported,
each with a subtly different gradation of meaning (see, Roth \textit{et
al.}\cite{ROTH}).  However, such schemes were adjudged un-necessary for
manipulating astronomical catalogues and  tables, and they are \textit{not}\,
supported.

The treatment of nulls in CAT was designed with the following
assertions about null values in astronomical catalogues in mind:

\begin{itemize}

  \item null values occur in existing catalogues. A wide variety of
   values are used to represent null values. Null values are common
   rather than rare,

  \item in general, it is \textit{always}\, possible that a genuine datum
   will not be available when any field in a catalogue is being written;
   in general an arithmetic exception, such as $\div$ by zero, is always
   possible. \textit{It is not possible to proscribe exceptions when
   generating a column},

  \item conversely, for some columns, all the values permitted by the
   data type of the column will be required for genuine values, leaving
   no value available for representing the null value. An example might
   be a column of type \_UBYTE used to record values generated by an
   astronomical instrument. The entire range of values permitted by this
   data type is 0 to 255, and if the instrument could generate genuine
   values in this entire range, there is no unused value left to
   represent the null case.

\end{itemize}

An additional, though less compelling, constraint was that it may be
necessary to generate tables where the value of the null was specified,
rather than adopting a fixed, pre-defined value. This feature may be
required, for example, so that the table can be input to existing
programs.

In order to meet these various requirements, the following behaviour
was specified for null values in CAT:

\begin{itemize}

  \item when a column is created, it may be specified as either
   supporting, or not supporting, null values,

  \item if a column supports nulls then a fixed, pre-defined null
   value will be used by default. These default nulls are the
   standard HDS `bad values' for the various data types, where they
   exist. The HDS bad values are defined in SUN/39\cite{SUN39}.
   See in particular Sections 1.2 and 5.1.  It is necessary to define
   a set of values for each operating system and type of computer that
   CAT runs on.  Table~\ref{DEFNUL} gives the values for some of the
   types currently used by Starlink. Note that the HDS parametric
   constants for the values are used to define the corresponding CAT
   types, rather than merely making their values the same. This approach
   reduces the possibility of incompatibilities arising if the values
   change,

  \item alternatively, for a column which supports nulls, the null
   value may be replaced with a specified value,

  \item if a column does not support nulls, exceptions can still occur
   when its fields are generated (as described above). When an exception
   occurs a \textbf{locum} value is written. The locum value for a column
   \textit{must}\, be specified when a column which does not support nulls
   is created.

\end{itemize}

\begin{table}[htbp]

\begin{center}
\begin{tabular}{ll}
 HDS type    & HDS symbolic \\
             & constant     \\ \hline
\_UBYTE      & VAL\_\_BADUB \\
\_BYTE       & VAL\_\_BADB  \\
\_UWORD      & VAL\_\_BADUW \\
\_WORD       & VAL\_\_BADW  \\
\_INTEGER    & VAL\_\_BADI  \\
\_REAL       & VAL\_\_BADR  \\
\_DOUBLE     & VAL\_\_BADD  \\
\_CHAR[$*n$] & -            \\
\end{tabular}
\end{center}

{\footnotesize
\begin{center}
\begin{tabular}{lllc}
 HDS type    & \multicolumn{2}{c}{HDS bad value}         & Notes \\
             & DECstation          & SUN                 &   \\ \hline
\_UBYTE      & 'FF'X               & 'FF'X               &   \\
\_BYTE       & '80'X               & '80'X               &   \\
\_UWORD      & 'FFFF'X             & 'FFFF'X             &   \\
\_WORD       & '8000'X             & '8000'X             &   \\
\_INTEGER    & '80000000'X         & '80000000'X         &   \\
\_REAL       & 'FF7FFFFF'X         & 'FF7FFFFF'X         &   \\
\_DOUBLE     & 'FFEFFFFFFFFFFFFF'X & 'FFEFFFFFFFFFFFFF'X &   \\
\_CHAR[$*n$] & '0'X                & '0'X                & 1 \\
\end{tabular}
\end{center} }

\textbf{Notes:}

\begin{enumerate}

  \item The ASCII standard defines a byte with a value of 0 (that is,
   all bits set to 0) as a null character.
  \item No NULL value is defined for the \_LOGICAL data type since by
   definition a \_LOGICAL value can only take two values (true or false).

\end{enumerate}

\caption{\label{DEFNUL}HDS bad values}

\end{table}

The difference between null and locum values is subtle and, at first, a
little confusing. It may be summarized as follows:

\begin{itemize}

  \item on writing a field there is no difference; if an exception
   occurs, a column with nulls generates a null and a column without
   nulls generates a locum,

  \item on reading a field (and this is the crux of the matter),
   CAT can differentiate a null from a genuine data value, but
   it \textit{cannot}\, differentiate a locum: \textit{once written a locum is
   indistinguishable from a genuine datum.}

\end{itemize}

Thus, generating a locum corresponds to CAT inventing data, and in
theory (and often in practice) will invalidate the contents of the
column. This invalidation is the reason why the value of a locum \textit{must}\, be specified, rather than making a default available; a value
can at least be chosen to minimize the damage.

\subsubsection{Reporting the generation of null and locum values}

The generation of nulls when writing a new field is common. Therefore,
the generation of a null is not reported in any way: no error message
is generated and no error status is set.

% The generation of a locum is more important because it potentially
% invalidates the column. Therefore the generation of a locum is reported
% by a warning message, though again no error status is set. Because there
% are circumstances where many locum values may be generated intentionally
% (or at least with the user's acquiescence), a mechanism is provided to
% suppress these warning messages.

\subsubsection{CAT subroutine interface}

The NULL and EXCEPT attributes of a column (see Section~\ref{COLS})
control the way that null or locum values are handled for that column.
They are specified when the column is created and are immutable
thereafter. The NULL attribute defines the type of null or locum which
the column supports. The possibilities are:

\begin{itemize}

  \item standard, HDS bad value (\texttt{CAT\_\_NULLD}),

  \item explicitly specified null value (\texttt{CAT\_\_NULLS}),

  \item locum (\texttt{CAT\_\_LOCUM}).

\end{itemize}

If the standard HDS null value is being used then it is not necessary
to associate its actual value with the column; knowing that the standard
value is to be used is adequate. Conversely, if either:

\begin{itemize}

  \item the value of the null has been specified explicitly,

  \item a locum value has been specified,

\end{itemize}

then the required value must be associated with the column. In either
case, this value is stored in the exception attribute of the column.

In the routines to GET and PUT values through the CAT subroutine
interface, null values are indicated by flags which appear as separate
arguments in the calling sequences for the GET and PUT subroutines.
However, the appropriate Starlink bad value is also substituted for
the value in the actual data variable or array. The advantages of this
approach are:

\begin{itemize}

  \item the separate flag for nulls is convenient for processing in
   database applications,

  \item the embedded values in the data variable or array mean that
   arrays (or variables, though variables are less likely to be
   important in practice) can be passed straight into existing Starlink
   subroutines.

\end{itemize}

\subsubsection{Handling nulls in expressions}

The following rules apply to evaluating an expression in which one or
more of the fields is null.

\begin{enumerate}

  \item A numeric expression containing column names evaluates to
   null if any of the fields are null.

  \item Logical expressions can evaluate to one of three states: \textit{true}, \textit{false}\, or \textit{null}. However, the expression is only
   satisfied if the value is \textit{true}.

  \item A relational operation ($> < =$, etc.) between two columns
   evaluates to null if either or both of the fields is null.

  \item The logical operators AND, OR and NOT operate on a three-valued
   logic\footnote{Under Scottish law three verdicts are possible:
   guilty, not guilty and `not proven.' If Scottish judges, advocates
   and juries can manage three-valued logic, it seemed reasonable that
   CAT could.}.  Their truth tables are shown in Table~\ref{TRUTH}.

  \item The parser provides the function \texttt{NULL} to detect null
   values. It returns the logical value \texttt{.TRUE.} if its argument is
   null and \texttt{.FALSE.} if its argument is not null.

\end{enumerate}

\begin{table}[htbp]

\begin{center}
\textbf{AND}
\begin{tabular}{cc|ccc}
\multicolumn{5}{c}{a}  \\
  &     &  T  &  N  &  F  \\ \hline
  &  T  &  T  &  N  &  F  \\
b &  N  &  N  &  N  &  F  \\
  &  F  &  F  &  F  &  F  \\
\end{tabular}

\vspace{5.0 mm}
\textbf{OR}
\begin{tabular}{cc|ccc}
\multicolumn{5}{c}{a}  \\
  &     &  T  &  N  &  F  \\ \hline
  &  T  &  T  &  T  &  T  \\
b &  N  &  T  &  N  &  N  \\
  &  F  &  T  &  N  &  F  \\
\end{tabular}

\vspace{5.0 mm}
\textbf{NOT}
\begin{tabular}{cc|ccc}
  &  T  &  F  \\
a &  F  &  T  \\
  &  N  &  N  \\
\end{tabular}
\end{center}

\caption{\label{TRUTH}Truth tables for three-valued logic}

\end{table}

\subsubsection{\label{NULLAPP}Handling nulls in applications}

Normally \textit{applications}\, should observe the following rules when
manipulating null values. If applications usually follow these rules
they will all present consistent and predictable behaviour to their
users. In a perfect world applications would always follow the rules.
However, I recognize that some \textit{ad hoc}\, applications may need to
behave differently because of some idiosyncrasy of their required
functionality. Nonetheless, applications should follow the rules unless
there are very good reasons not to. The recommended rules are:

\begin{enumerate}

  \item \textit{applications}\, extracting a single column from a table
   (for example, to plot a histogram) should skip (that is, detect, but
   not process) null values. They may, however, count and report the
   number of null values encountered,

  \item \textit{applications}\, extracting two or more columns from a
   table (for example, to plot a scatter-gram) should skip (that is,
   detect, but not process) all rows where any of the extracted values
   is null. They may, however, count and report the number of null
   values and/or rows encountered,

%  \item null values may be copied to a new field (normally in this case,
%   the null value will not be visible above the CAT interface).

\end{enumerate}

\subsubsection{Inquiring null values}

An application may determine the null value specified for a column by
inquiring the value of the EXCEPT attribute using routine \texttt{CAT\_TIQAC}. The value is forced into type CHARACTER. If it is
impossible to represent the value adequately in a character string then
it cannot be made accessible to the application.


\subsection{\label{ANGLES}Storing and representing columns of angles}

CAT provides special facilities for representing columns which
contain angles. Usually angular columns are used to store celestial
coordinates such as Right Ascension and Declination, though they can
contain any angular measure. There are two requirements for the treatment
of angles stored in astronomical catalogues:

\begin{itemize}

  \item inside a program angles should be expressed in radians
   and stored in DOUBLE PRECISION or REAL variables for ease of
   processing,

  \item usually they are best displayed to a user in units of hours
   or degrees, subdivided into sexagesimal minutes and seconds.
   Alternatively, small angles might be best displayed as minutes or
   seconds of arc or time and represented to some number of places of
   decimals.

\end{itemize}

CAT provides both these facilities, as follows:

\begin{itemize}

  \item when the value of a field in an angular column is
   obtained using \texttt{CAT\_EGT0D} or \texttt{CAT\_EGT0R} it is
   returned as DOUBLE PRECISION or REAL variable in radians,

  \item when the value of a field in an angular column is
   obtained formatted for display using \texttt{CAT\_EGT0F} it is
   returned as a CHARACTER string containing the value expressed in
   hours, degrees, minutes or seconds and optionally formatted as a
   sexagesimal value.

\end{itemize}

In order for CAT to know that a column contains an angle it must
satisfy the following two requirements.

\begin{itemize}

  \item The data type must be DOUBLE PRECISION or
   REAL\footnote{If the angle is to be stored to an accuracy of
   seconds of arc or fractions of a second of arc then it must be
   of type DOUBLE PRECISION. You should always store celestial
   coordinates in DOUBLE PRECISION columns unless you are certain
   that they are only of low accuracy. Angles are only supported in
   REAL columns for completeness; I do not expect that they will be
   used often.},

  \item The units attribute of the column should be set to
   `\texttt{RADIANS}' followed by an angular format specifier
   enclosed in curly brackets (`\{\}'). The simplest forms of this
   angular format specifier are simply `\texttt{HOURS}' and `\texttt{DEGREES}' for hours and degrees respectively. Thus, examples of
   the UNITS attribute are:

  \begin{description}

    \item[\texttt{RADIANS\{HOURS\}}] to display the column in hours,

    \item[\texttt{RADIANS\{DEGREES\}}] to display the column in degrees.

  \end{description}

   The angular format specifiers are described in full in the following
   section.

\end{itemize}

If the external display format attribute of the column, EXFMT,
is explicitly set it should be set to a normal Fortran 77 format
specifier corresponding to the data type of the column, for
example `\texttt{D16.8}' for a DOUBLE PRECISION column or `\texttt{E14.6}'
for a REAL column\footnote{The external format attribute \textit{must}\, always be a valid Fortran 77 format specifier because of
the way that CAT catalogues are represented as FITS tables.}.

When the catalogue is written fields should be written to
angular columns using \texttt{CAT\_PUT0D} or \texttt{CAT\_PUT0R} with
the angles expressed in radians.

\subsubsection{Angular format specifiers}

The angular format specifier forms part of the UNITS attribute for an
angular column. The UNITS attribute for an angular column has the
form:

\begin{terminalv}
RADIANS{angular format specifier}
\end{terminalv}

The simplest angular format specifiers are `\texttt{HOURS}' and
`\texttt{DEGREES}'.

\begin{description}

  \item[\texttt{HOURS}] will cause the angle to be displayed as
   hours, minutes and seconds, with the seconds displayed to one
   place of decimals,

  \item[\texttt{DEGREES}] will cause the angle to be displayed as
   degrees, minutes and seconds, with the seconds displayed as a
   whole number.

\end{description}

If the angular format specifier is omitted altogether and
the UNITS attribute simply set to `\texttt{RADIANS}' or `\texttt{RADIANS\{\}}' then the angle will be interpreted exactly as
though the angular format specifier had been `\texttt{DEGREES}'.
There are additional simple angular format specifiers for displaying
angles as minutes or seconds of arc or time to a specified number of
decimal places:

\begin{description}

  \item[\texttt{ARCMIN}\textit{.n}] minutes of arc,

  \item[\texttt{ARCSEC}\textit{.n}] seconds of arc,

  \item[\texttt{TIMEMIN}\textit{.n}] minutes of time,

  \item[\texttt{TIMESEC}\textit{.n}] seconds of time.


\end{description}

\textit{.n}\, is the number of decimal places required.  If \textit{.n}\, is
omitted then the value will be displayed as an integer number.  Though
these angular specifiers can be used to display any angle, obviously
they are most likely to be useful for small angles.

These simple angular format specifiers will usually be
adequate for representing columns of celestial coordinates.
However, sometimes you might wish to specify a different
representation for an angle. CAT accepts angular
format specifiers which permit angles to be represented in a
number of different formats. These specifiers are constructed
from a selection from amongst the following elements:

\begin{center}
\texttt{I B L + Z H D M S T} .\textit{n}
\end{center}

The meaning of each of the individual elements is as follows.

\begin{description}

  \item[\texttt{I}] Use the ISO standard separator for expressing
   times, a colon (`:'), to separate hours or degrees, minutes and
   seconds.

  \item[\texttt{B}] Use a single blank space to separate hours or
   degrees, minutes and seconds.

  \item[\texttt{L}] Use a letter (\texttt{h}, \texttt{d}, \texttt{m}, or
   \texttt{s}, as appropriate) to separate hours or degrees, minutes
   and seconds.

  \item[\texttt{+}] Insert a plus sign (`$+$') before positive angles
   (a minus sign is, of course, always inserted before negative
   angles).

  \item[\texttt{Z}] Insert leading zeros before the hours, degrees, minutes
   or seconds. Hours, minutes and seconds are assumed to be two-digit
   numbers and degrees three-digit.

  \item[\texttt{H}] Express the angle in units of hours.

  \item[\texttt{D}] Express the angle in units of degrees.

  \item[\texttt{M}] If an \texttt{M} occurs when either \texttt{H} or \texttt{D}
   is present then it indicates that the hours or degrees are to be
   subdivided into sexagesimal minutes.  If an \texttt{M} occurs when
   neither \texttt{H} nor \texttt{D} is present then it indicates that the
   units are minutes of either arc or time.

  \item[\texttt{S}] If an \texttt{S} occurs when an \texttt{M} is present then
   it indicates that the minutes are to be subdivided into sexagesimal
   seconds (the minutes may be either the actual units or themselves
   a sexagesimal subdivision of hours or degrees; see \texttt{M} above).
   If an \texttt{S} occurs when an \texttt{M} is not present then it indicates
   that the units are seconds of arc or time.

  \item[\texttt{T}] In the case where \texttt{H} and \texttt{D} are both absent
   and either or both of \texttt{M} and \texttt{S} are present then \texttt{T}
   indicates that the units are minutes or seconds of time.  If it is
   omitted in this case then the units are minutes or seconds of arc.
   If either \texttt{H} or \texttt{D} is present then \texttt{T} is ignored.

  \item[\textit{.n}] Display the least significant unit (seconds,
   minutes, degrees or hours, as appropriate) to \textit{n}\, decimal
   places.

\end{description}

Any of the items may be omitted, down to and including a
completely blank specifier.

The items can occur in any order, except that \textit{.n}\, must
occur last. However, for human readability I recommend that the
items occur in the order:

\begin{center}
(any of: \texttt{I}, \texttt{B}, \texttt{L}, \texttt{+} or \texttt{Z}) (\texttt{H}
or \texttt{D}) \texttt{M S T} .\textit{n}
\end{center}

If items are omitted the following defaults apply.

\begin{itemize}

  \item If neither \texttt{I}, \texttt{B} nor \texttt{L} is specified
   then \texttt{I} is assumed.

  \item If \texttt{+} is omitted then positive angles are not
   preceded by a `$+$' sign.

  \item If \texttt{Z} is omitted then leading zeros are omitted in the
   primary units (hours, degrees, minutes or seconds), but leading zeros
   are always included in any sexagesimal subdivisions.

  \item If none of \texttt{H}, \texttt{D}, \texttt{M} or \texttt{S} are specified
   then \texttt{D} is assumed (that is, the default units are degrees).

  \item If \texttt{H} or \texttt{D} are present but \texttt{M} is omitted then
   the hours or degrees are not subdivided into minutes.

  \item If \texttt{M} is present but \texttt{S} is omitted then the minutes
   are not subdivided into seconds.

  \item If \texttt{S} is present in addition to \texttt{H} or \texttt{D} but
   \texttt{M} is absent then \texttt{S} is ignored (this case is technically
   illegal).

  \item If \textit{.n}\, is omitted then the least significant unit
   (seconds, minutes, degrees or hours, as appropriate) is
   displayed as a whole number, without any places of decimals.

\end{itemize}

Table~\ref{SEXAG_EXAM} lists a number of examples of angular format
specifiers which might be used to represent `large' angles, such as
celestial coordinates, together with examples of how they would
represent an angle.  Table~\ref{SMALL_EXAM} lists a number of examples of
angular format specifiers which might be used to represent small angles,
such as the great circle distance between two neighbouring objects or the
angular size of an extended object, together with examples of how they
would represent an angle.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{lll}
Specifier     & Example            & Notes          \\ \hline
\texttt{D}       & \texttt{63}          & Integer degrees \\
\texttt{D.2}     & \texttt{62.86}       & Degrees to two places of decimals \\
\texttt{DM}      & \texttt{62:52}       & Degrees and integer minutes \\
\texttt{DM.2}    & \texttt{62:51.58}    & Degrees and minutes to two places of decimals \\
\texttt{DMS}     & \texttt{62:51:35}    & Degrees, minutes and integer seconds \\
\texttt{DMS.2}   & \texttt{62:51:34.65} & Degrees, minutes and seconds to two places of decimals \\
              &                    & \\
\texttt{H}       & \texttt{4}            & Integer hours \\
\texttt{H.2}     & \texttt{4.19}         & Hours to two places of decimals \\
\texttt{HM}      & \texttt{4:11}         & Hours and integer minutes \\
\texttt{HM.2}    & \texttt{4:11.44}      & Hours and minutes to two places of decimals \\
\texttt{HMS}     & \texttt{4:11:26}      & Hours, minutes and integer seconds \\
\texttt{HMS.2}   & \texttt{4:11:26.31}   & Hours, minutes and seconds to two places of decimals \\
              &                    & \\
\texttt{BHMS.2}  & \texttt{4 11 26.31}   & Space character as separator \\
\texttt{LHMS.2}  & \texttt{4h11m26.31s}  & Letter as separator \\
\texttt{ZHMS.2}  & \texttt{04:11:26.31}  & Leading zeros \\
\texttt{+HMS.2}  & \texttt{+4:11:26.31}  & Signed value \\
              &                    & \\
\texttt{L+ZDM.3} & \texttt{+062d51.577}  & Letter separator, leading zeros and signed \\
\end{tabular}

\begin{quote}
The examples show how the various specifiers would represent an angle of
1.09710742 radians (or \dms{62}{51}{34}{65}).
% (or 62$^{\circ}$ 51' 34.65").
\end{quote}

\caption{\label{SEXAG_EXAM}Examples of sexagesimal format specifiers}
\end{center}

\end{table}

\begin{table}[htbp]

\begin{center}
\begin{tabular}{lll}
Specifier   & Example        & Notes          \\ \hline
\texttt{M}     & \texttt{3}        & Integer minutes of arc \\
\texttt{M.3}   & \texttt{3.227}    & Minutes of arc to three places of decimals \\
\texttt{MS}    & \texttt{3:14}     & Minutes and integer seconds of arc \\
\texttt{MS.3}  & \texttt{3:13.600} & Minutes and seconds of arc to three places of decimals \\
\texttt{S}     & \texttt{194}      & Integer seconds of arc \\
\texttt{S.3}   & \texttt{193.600}  & Seconds of arc to three places of decimals \\
            &                & \\
\texttt{MT}    & \texttt{0}        & Integer minutes of time \\
\texttt{MT.3}  & \texttt{0.215}    & Minutes of time to three places of decimals \\
\texttt{MST}   & \texttt{0:13}     & Minutes and integer seconds of time\\
\texttt{MST.3} & \texttt{0:12.907} & Minutes and seconds of time to three places of decimals \\
\texttt{ST}    & \texttt{13}       & Integer seconds of time \\
\texttt{ST.3}  & \texttt{12.907}   & Seconds of time to three places of decimals \\
            &                & \\
\texttt{BMS}   & \texttt{3 14}     & Space character as separator \\
\texttt{LMS}   & \texttt{3m14s}    & Letter as separator \\
\texttt{ZMS}   & \texttt{03:14}    & Leading zeros \\
\texttt{+MS}   & \texttt{+3:14}    & Signed value \\
            &                & \\
\texttt{L+ZMS} & \texttt{+03m14s}  & Letter separator, leading zeros and signed \\
\end{tabular}

\begin{quote}
These specifiers might typically be used to represent the great circle
distance between neighbouring objects or the angular size of an extended
object.  There is no reason why they should not be used to represent
`large' angles such as celestial coordinates, though the output would
look a bit odd.  The examples show how the various specifiers would
represent an angle of 9.3860x10$^{-4}$ radians (or \dms{0}{3}{13}{66}).
% (or 3' 13.6" of arc).
\end{quote}

\caption{\label{SMALL_EXAM}Examples of angular format specifiers for
small angles}
\end{center}

\end{table}

The simple angular format specifiers, `\texttt{HOURS}', `\texttt{DEGREES}',
`\texttt{ARCMIN}', `\texttt{ARCSEC}', `\texttt{TIMEMIN}' and `\texttt{TIMESEC}'
are just synonyms for particular cases of the
general specifiers. They are listed, together with the
equivalent full specification in Table~\ref{SEXAG_SIMPLE}.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{lllc}
Simple Specifier & Equivalent Full Specifier & Example & Notes \\ \hline
\texttt{HOURS}      & \texttt{IHMS.1} & \texttt{14:11:26.3} & 1  \\
\texttt{DEGREES}    & \texttt{IDMS}   & \texttt{62:51:35}   & 1  \\
                 &              &                  &    \\
\texttt{ARCMIN}     & \texttt{M}      & \texttt{3}          & 2  \\
\texttt{ARCSEC}     & \texttt{S}      & \texttt{194}        & 2  \\
\texttt{TIMEMIN}    & \texttt{MT}     & \texttt{0}          & 2  \\
\texttt{TIMESEC}    & \texttt{ST}     & \texttt{13}         & 2  \\
                 &              &                  &    \\
\texttt{ARCMIN.3}   & \texttt{M.3}    & \texttt{3.227}      & 3  \\
\texttt{ARCSEC.3}   & \texttt{S.3}    & \texttt{193.600}    & 3  \\
\texttt{TIMEMIN.3}  & \texttt{MT.3}   & \texttt{0.215}      & 3  \\
\texttt{TIMESEC.3}  & \texttt{ST.3}   & \texttt{12.907}     & 3  \\
\end{tabular}

\vspace{4mm}

\begin{quote}
\textbf{Notes}

\begin{enumerate}

  \item The number of decimal places is fixed for these specifiers.

  \item The number of decimal places has been omitted so integers
   without any decimal places are assumed.

  \item Three places of decimals were specified.

\end{enumerate}

The example for the first two specifiers is an angle of 1.09710742 radians;
for the remaining specifiers the example is an angle of 9.3860x10$^{-4}$
radians.

\end{quote}

\caption{\label{SEXAG_SIMPLE}The simple angular format specifiers and
their equivalents}
\end{center}

\end{table}

\subsubsection{Displaying angles in radians}

Displaying angles in units of hours, degrees, minutes or seconds,
optionally formatted as sexagesimal values is usually the required
behaviour. However, occasionally you may want to display angles as
simple decimal numbers expressed in radians. CAT also provides this
facility. It can be configured so that \texttt{CAT\_EGT0F} returns an
angle expressed in radians, written into a CHARACTER string using
the Fortran 77 external format specifier for the column (defined by
attribute EXFMT). In this case CAT is treating columns of angles
just like any other column; \texttt{CAT\_EGT0F} simply writes the
value into a CHARACTER string using the external display format
specifier.

To control whether angles are converted to hours, degrees, minutes or
seconds and optionally formatted as sexagesimal values or simply written
as a decimal number in radians you must set a configuration (or
`tuning') parameter in CAT. This parameter is called `\texttt{ANGLE\_LIST}'
and is set using routine \texttt{CAT\_TUNES}. Proceed as follows.

\begin{itemize}

  \item to configure CAT to return angles as radians:

  \begin{terminalv}
CALL CAT\_TUNES ('ANGLE_LIST', 'RADIANS', STATUS)
  \end{terminalv}

  \item to configure CAT to return angles as hours, degrees, minutes
   or seconds, optionally formatted as sexagesimal values:

  \begin{terminalv}
CALL CAT_TUNES ('ANGLE_LIST', 'SEXAGESIMAL', STATUS)
  \end{terminalv}

\end{itemize}

Once one of these alternatives has been set it will remain in
effect until another call is made to \texttt{CAT\_TUNES} to reset
it. The default if the representation is never explicitly set is
that angles are converted to hours, degrees, minutes or seconds and
optionally output as sexagesimal values.

You can inquire the current value of tuning parameter `\texttt{ANGLE\_LIST}' using routine \texttt{CAT\_TUNEG}:

\begin{terminalv}
     CHARACTER
    :  TVALUE*75   ! Current value for angle representation.
      .
      .
      .


     CALL CAT_TUNEG ('ANGLE_LIST', TVALUE, STATUS)
\end{terminalv}

and \texttt{TVALUE} will be returned set to `\texttt{RADIANS}' or
`\texttt{SEXAGESIMAL}', as appropriate.


\cleardoublepage
\appendix
\section{\label{DETAIL}\xlabel{DETAIL}Detailed subroutine specifications}

This Appendix gives detailed specifications for the individual
subroutines in the CAT library.  It is probably best used in conjunction
with the discussion of the routines in Section~\ref{SUBINT}. The
routines are listed in alphabetical order.

\begin{small}
% -- prologue comments generated by PROLAT -----------------------------

% \textsf{Specifications generated from prologues to go here.}

% \input{CAT.TEX}

\sstroutine{
   CAT\_ASSOC
}{
   Open an existing catalogue; the name of the catalogue is obtained
   from an ADAM parameter
}{
   \sstdescription{
      Open an existing catalogue; the name of the catalogue is obtained
      from an ADAM parameter.  If an existing catalogue is opened with
      MODE = \texttt{'}WRITE\texttt{'} then it is overwritten.
   }
   \sstinvocation{
      CALL CAT\_ASSOC (PCNAME, MODE; CI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         PCNAME  =  CHARACTER$*$($*$) (Given)
      }{
         Name of the ADAM parameter from which the catalogue name will
         be obtained.
      }
      \sstsubsection{
         MODE  =  CHARACTER$*$($*$) (Given)
      }{
         Mode in which the catalogue will be accessed.  One of:
         READ   -  the catalogue may only be read from,
         WRITE  -  a new catalogue is to be written.
      }
      \sstsubsection{
         CI  =  INTEGER (Returned)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_CINQ
}{
   Inquire the values of all the attributes for a column
}{
   \sstdescription{
      Inquire the values of all the attributes for a column. Type
      conversions are performed if necessary. If the conversion fails a
      status is set (this is only likely to be important for null
      values).  Note that the exception value is forced into type
      character in order to avoid having a family of routines.  Note
      also that the genus attribute is returned explicitly.
   }
   \sstinvocation{
      CALL CAT\_CINQ (FI, SZDIM; CI, FNAME, GENUS, EXPR, DTYPE, CSIZE,
        DIMS, SIZEA, NULL, EXCEPT, SCALEF, ZEROP, ORDER, UNITS, EXTFMT,
        PRFDSP, COMM, DATE; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         FI  =  INTEGER (Given)
      }{
         Identifier to the column.
      }
      \sstsubsection{
         SZDIM  =  INTEGER (Given)
      }{
         Maximum permitted dimensionality for a column (defines the
         size of array SIZEA).
      }
      \sstsubsection{
         CI  =  INTEGER (Returned)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         FNAME  =  CHARACTER$*$($*$) (Returned)
      }{
         Name of the column (or field).
      }
      \sstsubsection{
         GENUS  =  INTEGER (Returned)
      }{
         The genus of the column, coded as follows:
         CAT\_\_GVIRT - virtual column,
         CAT\_\_GPHYS - physical column.
      }
      \sstsubsection{
         EXPR  =  CHARACTER$*$($*$) (Returned)
      }{
         The expression defining a virtual column; blank for a physical
         column.
      }
      \sstsubsection{
         DTYPE  =  INTEGER (Returned)
      }{
         Type of the column.  The permitted types are identical to
         HDS types.
      }
      \sstsubsection{
         CSIZE  =  INTEGER (Returned)
      }{
         Size of a character column.  If the column is not of type
         character CSIZE is set to zero.
      }
      \sstsubsection{
         DIMS  =  INTEGER (Returned)
      }{
         Dimensionality of the column.  For a scalar DIMS = 0.
      }
      \sstsubsection{
         SIZEA(SZDIM)  =  INTEGER (Returned)
      }{
         The size of the array in each of its dimensions.  The exception
         is a scalar column, when SIZEA becomes a single-element,
         one-dimensional array, set to 0.
      }
      \sstsubsection{
         NULL  =  INTEGER (Returned)
      }{
         The way that null values are handled for the column.  The
         permitted values are:
         CAT\_\_NULLD - default, HDS null values used,
         CAT\_\_NULLS - null values explicitly specified for the column,
         CAT\_\_LOCUM - null values not supported for the column and a
                      locum value used instead.
      }
      \sstsubsection{
         EXCEPT  =  CHARACTER$*$($*$) (Returned)
      }{
         In the cases where either the column supports explicitly
         specified null values, or nulls are not supported and a locum
         is used instead, EXCEPT contains the required value, written
         into a character string.
      }
      \sstsubsection{
         SCALEF  =  DOUBLE PRECISION (Returned)
      }{
         Scale factor for scaled columns.  0.0D0 for columns which are
         not scaled.
      }
      \sstsubsection{
         ZEROP  =  DOUBLE PRECISION (Returned)
      }{
         Zero point for scaled columns.  0.0D0 for columns which are
         not scaled.
      }
      \sstsubsection{
         ORDER  =  INTEGER (Returned)
      }{
         The order in which values occur in the column, coded as
         follows:
         CAT\_\_ASCND - ascending,
         CAT\_\_DSCND - descending,
         CAT\_\_NOORD - none.
      }
      \sstsubsection{
         UNITS  =  CHARACTER$*$($*$) (Returned)
      }{
         The units of the column.
      }
      \sstsubsection{
         EXTFMT  =  CHARACTER$*$($*$) (Returned)
      }{
         The external format for the column.
      }
      \sstsubsection{
         PRFDSP  =  LOGICAL (Returned)
      }{
         The preferential display flag for the column:
         .TRUE.  - display the column by default,
         .FALSE. - do not display the column by default.
      }
      \sstsubsection{
         COMM  =  CHARACTER$*$($*$) (Returned)
      }{
         Comments about the column.
      }
      \sstsubsection{
         DATE  =  DOUBLE PRECISION (Returned)
      }{
         The modification date of the column.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_CNEWA
}{
   Create a column, simultaneously setting all its attributes
}{
   \sstdescription{
      Create a column, simultaneously setting all its attributes.

      Note that the GENUS attribute is automatically set to CAT\_\_GPHYS.
   }
   \sstinvocation{
      CALL CAT\_CNEWA (CI, FNAME, EXPR, DTYPE, CSIZE, DIMS, SIZEA,
        NULL, EXCEPT, SCALEF, ZEROP, ORDER, UNITS, EXTFMT, PRFDSP,
        COMM; FI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         FNAME  =  CHARACTER$*$($*$) (Given)
      }{
         Name of the column (or field).
      }
      \sstsubsection{
         EXPR  =  CHARACTER$*$($*$) (Given)
      }{
         The expression defining a virtual column; blank for a physical
         column.
      }
      \sstsubsection{
         DTYPE  =  INTEGER (Given)
      }{
         Type of the column.
      }
      \sstsubsection{
         CSIZE  =  INTEGER (Given)
      }{
         Size of a CHARACTER column.  If the column is not of type
         CHARACTER CSIZE is irrelevant; it is conventional to set it
         to zero.
      }
      \sstsubsection{
         DIMS  =  INTEGER (Given)
      }{
         Dimensionality of the column.  The permitted values are:
         CAT\_\_SCALR  -  scalar,
         CAT\_\_VECTR  -  vector.
      }
      \sstsubsection{
         SIZEA(1)  =  INTEGER (Given)
      }{
         If the column is a vector this attribute should be set to the
         number of elements in the vector.  For a scalar it should be
         set to one.
      }
      \sstsubsection{
         NULL  =  INTEGER (Given)
      }{
         The way that null values are handled for the column.  The
         permitted values are:
         CAT\_\_NULLD - default, HDS null values used,
         CAT\_\_NULLS - null values explictly specified for the column,
         CAT\_\_LOCUM - null values not supported for the column and a
                      locum value used instead.
      }
      \sstsubsection{
         EXCEPT  =  CHARACTER$*$($*$) (Given)
      }{
         In the cases where either the column supports explicitly
         specified null values, or nulls are not supported and a locum
         is used instead, EXCEPT contains the required value, written
         into a character string.
      }
      \sstsubsection{
         SCALEF  =  DOUBLE PRECISION (Given)
      }{
         Scale factor for scaled columns.  1.0D0 for columns which are
         not scaled.
      }
      \sstsubsection{
         ZEROP  =  DOUBLE PRECISION (Given)
      }{
         Zero point for scaled columns.  0.0D0 for columns which are
         not scaled.
      }
      \sstsubsection{
         ORDER  =  INTEGER (Given)
      }{
         The order in which values occur in the column, coded as
         follows:
         CAT\_\_ASCND - ascending,
         CAT\_\_DSCND - descending,
         CAT\_\_NOORD - none.
      }
      \sstsubsection{
         UNITS  =  CHARACTER$*$($*$) (Given)
      }{
         The units of the column.
      }
      \sstsubsection{
         EXTFMT  =  CHARACTER$*$($*$) (Given)
      }{
         The external format for the column.
      }
      \sstsubsection{
         PRFDSP  =  LOGICAL (Given)
      }{
         The preferential display flag for the column:
         .TRUE.  - display the column by default,
         .FALSE. - do not display the column by default.
      }
      \sstsubsection{
         COMM  =  CHARACTER$*$($*$) (Given)
      }{
         Comments about the column.
      }
      \sstsubsection{
         FI  =  INTEGER (Returned)
      }{
         Identifier for the column.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_CNEWS
}{
   Create a column, simultaneously setting some of its attributes
}{
   \sstdescription{
      Create a column, simultaneously setting some of its attributes.

      These attributes deliberately correspond to those usually used
      with FITS tables.
   }
   \sstinvocation{
      CALL CAT\_CNEWS (CI, FNAME, DTYPE, CSIZE, UNITS, EXTFMT, COMM;
        FI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         FNAME  =  CHARACTER$*$($*$) (Given)
      }{
         Name of the column (or field).
      }
      \sstsubsection{
         DTYPE  =  INTEGER (Given)
      }{
         Type of the column.
      }
      \sstsubsection{
         CSIZE  =  INTEGER (Given)
      }{
         Size of a CHARACTER column.  If the column is not of type
         CHARACTER CSIZE is irrelevant; it is conventional to set it
         to zero.
      }
      \sstsubsection{
         UNITS  =  CHARACTER$*$($*$) (Given)
      }{
         The units of the column.
      }
      \sstsubsection{
         EXTFMT  =  CHARACTER$*$($*$) (Given)
      }{
         The external format for the column.
      }
      \sstsubsection{
         COMM  =  CHARACTER$*$($*$) (Given)
      }{
         Comments about the column.
      }
      \sstsubsection{
         FI  =  INTEGER (Returned)
      }{
         Identifier for the column.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_CREAT
}{
   Create a new catalogue; the name of the catalogue is obtained
   from an ADAM parameter
}{
   \sstdescription{
      Create a new catalogue; the name of the catalogue is obtained
      from an ADAM parameter.
   }
   \sstinvocation{
      CALL CAT\_CREAT (PCNAME; CI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         PCNAME  =  CHARACTER$*$($*$) (Given)
      }{
         Name of the ADAM parameter from which the catalogue name will
         be obtained.
      }
      \sstsubsection{
         CI  =  INTEGER (Returned)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_EGT0F
}{
   Get the formatted value of a scalar exprn. field or parameter
}{
   \sstdescription{
      Get the formatted value of a scalar expression, evaluated from the
      current row buffer, field or parameter.  The value is formatted
      into a CHARACTER string using the appropriate external format
      specifier.

      Remember that parameter and column identifiers correspond to
      valid expressions.
   }
   \sstinvocation{
      CALL CAT\_EGT0F (GI; VALUE, NULFLG; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         GI  =  INTEGER (Given)
      }{
         Identifier for either an expression, field or parameter.
      }
      \sstsubsection{
         VALUE  =  CHARACTER$*$($*$) (Returned)
      }{
         Value to which the expression evaluates for the current row
         buffer.  If the expression evaluates to null the string
         returned is \texttt{'}$<$null$>$\texttt{'} if VALUE contains six or more characters,
         otherwise it is \texttt{'}?\texttt{'}.
      }
      \sstsubsection{
         NULFLG  =  LOGICAL (Returned)
      }{
         A flag indicating whether or not the expression evaluates to
         the null value or not:
         .TRUE.  - The expression is null,
         .FALSE. - The expression is not null; a genuine value is
                   available.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_EGT0$<$t$>$
}{
   Get the value of a scalar expression, field or parameter
}{
   \sstdescription{
      Get the value of a scalar expression, evaluated from the current
      row buffer, field or parameter.
   }
   \sstinvocation{
      CALL CAT\_EGT0$<$t$>$ (GI; VALUE, NULFLG; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         GI  =  INTEGER (Given)
      }{
         Identifier for either an expression, field or parameter.
      }
      \sstsubsection{
         VALUE  =  $<$type$>$ (Returned)
      }{
         Value to which the expression evaluates for the current row
         buffer.
      }
      \sstsubsection{
         NULFLG  =  LOGICAL (Returned)
      }{
         A flag indicating whether or not the expression evaluates to
         the null value or not:
         .TRUE.  - The expression is null,
         .FALSE. - The expression is not null; a genuine value is
                   available.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_EIDNT
}{
   Get an identifier for an expression
}{
   \sstdescription{
      Get an identifier for an expression.  A parse of the the
      expression is attempted, and if successful an identifier is
      returned.  If the parse fails an error status is raised.
   }
   \sstinvocation{
      CALL CAT\_EIDNT (CI, EXPR; EI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Identifier to the catalogue to which the expression refers.
      }
      \sstsubsection{
         EXPR  =  CHARACTER$*$($*$) (Given)
      }{
         The expression.
      }
      \sstsubsection{
         EI  =  INTEGER (Returned)
      }{
         Identifier to the expression.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_EXIST
}{
   Attempt to open a catalogue, the name being taken from the ADAM
   parameter system
}{
   \sstdescription{
      Attempt to open a catalogue, the name being taken from the ADAM
      parameter system.  If the attempt fails then instead of
      re-prompting the routine returns with an error status.  This
      routine can be used to check the existence of a catalogue.
   }
   \sstinvocation{
      CALL CAT\_EXIST (PCNAME, MODE; CI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         PCNAME  =  CHARACTER$*$($*$) (Given)
      }{
         Name of the ADAM parameter from which the catalogue name will
         be obtained.
      }
      \sstsubsection{
         MODE  =  CHARACTER$*$($*$) (Given)
      }{
         Mode in which the catalogue will be accessed.  One of:
         WRITE  -  an new catalogue is to be written.
      }
      \sstsubsection{
         CI  =  INTEGER (Returned)
      }{
         Catalogue identifier.  If the specified catalogue is not
         opened successfully, the null identifier is returned.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_FGT0F
}{
   Get the formatted value of a scalar expression or field for a given row
}{
   \sstdescription{
      Get the formatted value of a scalar expression or field for a
      given row.  The row may be in either a catalogue, selection or
      index.
   }
   \sstinvocation{
      CALL CAT\_FGT0F (CI, ROWNO, GI; VALUE, NULFLG; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue, selection or index identifier.  The row number,
         ROWNO (below), refers to the row number in the catalogue,
         selection or index, as appropriate.
      }
      \sstsubsection{
         ROWNO  =  INTEGER (Given)
      }{
         Number of the row to be read.
      }
      \sstsubsection{
         GI  =  INTEGER (Given)
      }{
         Identifier for either an expression, field or parameter.
      }
      \sstsubsection{
         VALUE  =  CHARACTER$*$($*$) (Returned)
      }{
         Value to which the expression evaluates for the current row
         buffer.  If the expression evaluates to null the string
         returned is \texttt{'}$<$null$>$\texttt{'} if VALUE contains six or more characters,
         otherwise it is \texttt{'}?\texttt{'}.
      }
      \sstsubsection{
         NULFLG  =  LOGICAL (Returned)
      }{
         A flag indicating whether or not the expression evaluates to
         the null value or not:
         .TRUE.  - The expression is null,
         .FALSE. - The expression is not null; a genuine value is
                   available.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_FGT0$<$t$>$
}{
   Get the value of a scalar expression or field for a given row
}{
   \sstdescription{
      Get the value of a scalar expression or field for a given row.
      The row may be in either a catalogue, selection or index.
   }
   \sstinvocation{
      CALL CAT\_FGT0$<$t$>$ (CI, ROWNO, GI; VALUE, NULFLG; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue, selection or index identifier.  The row number,
         ROWNO (below), refers to the row number in the catalogue,
         selection or index, as appropriate.
      }
      \sstsubsection{
         ROWNO  =  INTEGER (Given)
      }{
         Number of the row to be read.
      }
      \sstsubsection{
         GI  =  INTEGER (Given)
      }{
         Identifier for either an expression, field or parameter.
      }
      \sstsubsection{
         VALUE  =  $<$type$>$ (Returned)
      }{
         Value to which the expression evaluates for the current row
         buffer.
      }
      \sstsubsection{
         NULFLG  =  LOGICAL (Returned)
      }{
         A flag indicating whether or not the expression evaluates to
         the null value or not:
         .TRUE.  - The expression is null,
         .FALSE. - The expression is not null; a genuine value is
                   available.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_GETXT
}{
   Get the next line of textual information from a catalogue
}{
   \sstdescription{
      Get the next line of textual information from a catalogue.
   }
   \sstinvocation{
      CALL CAT\_GETXT (CI; FINISH, CLASS, TEXT; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         FINISH   =  LOGICAL (Returned)
      }{
         Flag indicating whether a line of text was obtained, coded as
         follows:
         .FALSE. -  a line was obtained ok; input of of textual
                    information continues.
         .TRUE.  -  all the textual information has already been
                    returned; input of textual information has
                    terminated.
      }
      \sstsubsection{
         CLASS   =  CHARACTER$*$($*$) (Returned)
      }{
         Class of the textual information.  A set of values are
         permitted for each type of catalogue back-end (or file
         format), and these sets are different for different back-ends.
         Note that this argument is returned rather than given; an
         application cannot prescribe to CAT what class of textual
         information is required.
      }
      \sstsubsection{
         TEXT   =  CHARACTER$*$($*$) (Returned)
      }{
         A single line of textual information.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_IINQ
}{
   Inquire all the attributes of an index
}{
   \sstdescription{
      Inquire all the attributes of an index.
   }
   \sstinvocation{
      CALL CAT\_IINQ (II; CI, FI, ORDER, NUMSEL, COMM, DATE, STATUS)
   }
   \sstarguments{
      \sstsubsection{
         II  =  INTEGER (Given)
      }{
         Index identifier.
      }
      \sstsubsection{
         CI  =  INTEGER (Returned)
      }{
         Catalogue identifier for the parent catalogue of the index.
      }
      \sstsubsection{
         FI  =  INTEGER (Returned)
      }{
         Column identifier for the column from which the index was
         created.
      }
      \sstsubsection{
         ORDER  =  INTEGER (Returned)
      }{
         Order of the index, coded as follows:
         CAT\_\_ASCND  -  ascending,
         CAT\_\_DSCND  -  descending.
      }
      \sstsubsection{
         NUMSEL  =  INTEGER (Returned)
      }{
         Number of rows in the index.
      }
      \sstsubsection{
         COMM  =  CHARACTER$*$($*$) (Returned)
      }{
         Comments for the index.
      }
      \sstsubsection{
         DATE  =  DOUBLE PRECISION (Returned)
      }{
         Date the index was created.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_INEW
}{
   Create an index on a column
}{
   \sstdescription{
      Create an index on a column.

      Currently only temporary indices are created.
   }
   \sstinvocation{
      CALL CAT\_INEW (FI, DISP, ORDER; II; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         FI  =  INTEGER (Given)
      }{
         Column identifier for the column from which the index will be
         created.  The identifier may refer to either a scalar column
         or a vector column element.
      }
      \sstsubsection{
         DISP  =  CHARACTER$*$($*$) (Given)
      }{
         The disposition of the index.  The possibilities are:
         \texttt{'}TEMP\texttt{'}  -  temporary,
         \texttt{'}PERM\texttt{'}  -  permanent.
         Currently only temporary indices are implemented.
      }
      \sstsubsection{
         ORDER  =  INTEGER (Given)
      }{
         Order of the index, coded as follows:
         CAT\_\_ASCND  -  ascending,
         CAT\_\_DSCND  -  descending.
      }
      \sstsubsection{
         II  =  INTEGER (Returned)
      }{
         Identifier to the new index.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 2001 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_PINQ
}{
   Inquire the values of all the attributes for a parameter
}{
   \sstdescription{
      Inquire the values of all the attributes for a parameter. If the
      parameter is an array, the value of the first element is returned.
   }
   \sstinvocation{
      CALL CAT\_PINQ (QI, SZDIM; CI, QNAME, DTYPE, CSIZE, DIMS, SIZEA,
        UNITS, EXTFMT, PRFDSP, COMM, VALUE, DATE; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         QI  =  INTEGER (Given)
      }{
         Parameter identifier.
      }
      \sstsubsection{
         SZDIM  =  INTEGER (Given)
      }{
         Maximum permitted dimensionality for a column (defines the
         size of array SIZEA).
      }
      \sstsubsection{
         CI  =  INTEGER (Returned)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         QNAME  =  CHARACTER$*$($*$) (Returned)
      }{
         Name of the parameter.
      }
      \sstsubsection{
         DTYPE  =  INTEGER (Returned)
      }{
         Type of the parameter.  The permitted types are identical to
         HDS types.
      }
      \sstsubsection{
         CSIZE =  INTEGER (Given)
      }{
         Size of a character parameter (set to zero if the column
         is note of data type character).
      }
      \sstsubsection{
         DIMS  =  INTEGER (Returned)
      }{
         Dimensionality of the parameter.  For a scalar DIMS = 0.
      }
      \sstsubsection{
         SIZEA(SZDIM)  =  INTEGER (Returned)
      }{
         The size of the array in each of its dimensions.  The exception
         is a scalar parameter, when SIZEA becomes a single-element,
         one-dimensional array, set to 0.
      }
      \sstsubsection{
         UNITS  =  CHARACTER$*$($*$) (Returned)
      }{
         The units of the parameter.
      }
      \sstsubsection{
         EXTFMT  =  CHARACTER$*$($*$) (Returned)
      }{
         The external format for the parameter.
      }
      \sstsubsection{
         PRFDSP  =  LOGICAL (Returned)
      }{
         The preferential display flag for the parameter:
         .TRUE.  - display the parameter by default,
         .FALSE. - do not display the parameter by default.
      }
      \sstsubsection{
         COMM  =  CHARACTER$*$($*$) (Returned)
      }{
         Comments about the parameter.
      }
      \sstsubsection{
         VALUE  =  CHARACTER$*$($*$) (Returned)
      }{
         The value of the parameter.  If the parameter is an array the
         first element is returned.
      }
      \sstsubsection{
         DATE  =  DOUBLE PRECISION (Returned)
      }{
         Modification date of the parameter.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_PNEW0
}{
   Create a scalar part (column or parameter)
}{
   \sstdescription{
      Create a scalar part (column or parameter).
   }
   \sstinvocation{
      CALL CAT\_PNEW0 (CI, PTYPE, PNAME, DTYPE; PI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Identifier to the catalogue in which the part is to be created.
      }
      \sstsubsection{
         PTYPE  =  INTEGER (Given)
      }{
         Type of part to be created, coded as follows:
         CAT\_\_FITYP - column (or field),
         CAT\_\_QITYP - parameter.
      }
      \sstsubsection{
         PNAME  =  CHARACTER$*$($*$) (Given)
      }{
         Name of the part to be created.
      }
      \sstsubsection{
         DTYPE  =  INTEGER (Given)
      }{
         Integer code for the data type of the part to be created.
      }
      \sstsubsection{
         PI  =  INTEGER (Returned)
      }{
         Identifier to the new part.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_PPTA$<$t$>$
}{
   Create a parameter, simultaneously setting all its attributes
}{
   \sstdescription{
      Create a parameter, simultaneously setting all its attributes.

      Note that the data type attribute can be deduced from the type
      of the routine.  However the CHARACTER size attribute must still
      be passed.
   }
   \sstinvocation{
      CALL CAT\_PPTA$<$t$>$ (CI, QNAME, CSIZE, DIMS, SIZEA, UNITS, EXTFMT,
        PRFDSP, COMM, VALUE; QI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         QNAME  =  CHARACTER$*$($*$) (Given)
      }{
         Name of the parameter.
      }
      \sstsubsection{
         CSIZE  =  INTEGER (Given)
      }{
         Size of a CHARACTER parameter.  If the parameter is not of type
         CHARACTER CSIZE is irrelevant; it is conventional to set it
         to zero.
      }
      \sstsubsection{
         DIMS  =  INTEGER (Given)
      }{
         Dimensionality of the parameter.  Currently the only permitted
         value is CAT\_\_SCALR, corresponding to a scalar.
      }
      \sstsubsection{
         SIZEA(1)  =  INTEGER (Given)
      }{
         For vector parameters this attribute would be set to the
         number of elements in the vector.  However, currently only
         scalar parameters are supported and it should be set to one.
      }
      \sstsubsection{
         UNITS  =  CHARACTER$*$($*$) (Given)
      }{
         The units of the parameter.
      }
      \sstsubsection{
         EXTFMT  =  CHARACTER$*$($*$) (Given)
      }{
         The external format for the parameter.
      }
      \sstsubsection{
         PRFDSP  =  LOGICAL (Given)
      }{
         The preferential display flag for the parameter:
         .TRUE.  - display the parameter by default,
         .FALSE. - do not display the parameter by default.
      }
      \sstsubsection{
         COMM  =  CHARACTER$*$($*$) (Given)
      }{
         Comments about the parameter.
      }
      \sstsubsection{
         VALUE  =  $<$type$>$ (Given)
      }{
         Value for the parameter.
      }
      \sstsubsection{
         QI  =  INTEGER (Returned)
      }{
         Identifier for the parameter.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_PPTS$<$t$>$
}{
   Create a parameter, simultaneously setting some of its attributes
}{
   \sstdescription{
      Create a parameter, simultaneously setting some of its attributes.

      Note that the attributes set correspond to the ones usually used
      with FITS tables.  Also note that the data type attribute can be
      deduced from the type of the routine.  However for CHARACTER
      parameters the CHARACTER size attribute should be set using
      CAT\_TATTC.
   }
   \sstinvocation{
      CALL CAT\_PPTS$<$t$>$ (CI, QNAME, VALUE, COMM; QI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         QNAME  =  CHARACTER$*$($*$) (Given)
      }{
         Name of the parameter.
      }
      \sstsubsection{
         VALUE  =  $<$type$>$ (Given)
      }{
         Value for the parameter.
      }
      \sstsubsection{
         COMM  =  CHARACTER$*$($*$) (Given)
      }{
         Comments about the parameter.
      }
      \sstsubsection{
         QI  =  INTEGER (Returned)
      }{
         Identifier for the parameter.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_PUT0$<$t$>$
}{
   Put a value to a scalar part (field or column)
}{
   \sstdescription{
      Put a value to a scalar part (field or column). If the identifier
      refers to a field the value is written to the current row buffer.
   }
   \sstinvocation{
      CALL CAT\_PUT0$<$t$>$ (PI, VALUE, NULFLG; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         PI  =  INTEGER (Given)
      }{
         Part identifier.
      }
      \sstsubsection{
         VALUE  =  $<$type$>$ (Given)
      }{
         Value to PUT to the part.
      }
      \sstsubsection{
         NULFLG  =  LOGICAL (Given)
      }{
         A flag indicating whether or not the value is null or not:
         .TRUE.  - The value is null,
         .FALSE. - The value is not null.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_PUTXT
}{
   Put a line of textual information to a catalogue
}{
   \sstdescription{
      Put a line of textual information to a catalogue.
   }
   \sstinvocation{
      CALL CAT\_PUTXT (CI, CLASS, TEXT; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         CLASS   =  CHARACTER$*$($*$) (Returned)
      }{
         Class of the textual information.  The standard classes
         \texttt{'}COMMENT\texttt{'} and \texttt{'}HISTORY\texttt{'} are available for all back-ends.
         Individual back-ends may support additional classes.
      }
      \sstsubsection{
         TEXT   =  CHARACTER$*$($*$) (Given)
      }{
         A single line of textual information.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_RAPND
}{
   Append the current row buffer to the end of the catalogue
}{
   \sstdescription{
      Append the current row buffer as a new row at the end of the
      catalogue.
   }
   \sstinvocation{
      CALL CAT\_RAPND (CI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 2001 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_RGET
}{
   Read a specified row into the current row buffer
}{
   \sstdescription{
      Read a specified row from a catalogue, selection or index into
      the current row buffer for that catalogue.
   }
   \sstinvocation{
      CALL CAT\_RGET (CI, ROWNO; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue, selection or index identifier.  The row number,
         ROWNO (below), refers to the row number in the catalogue,
         selection or index, as appropriate.
      }
      \sstsubsection{
         ROWNO  =  INTEGER (Given)
      }{
         Number of the row to be read.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_RSET
}{
   Set the number of rows which a new catalogue is expected to contain
}{
   \sstdescription{
      Set the number of rows which a new catalogue is expected to contain.

      The value set may be either used or ignored, depending on the type
      of the catalogue.
   }
   \sstinvocation{
      CALL CAT\_RSET (CI, ROWS; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         ROWS  =  INTEGER (Given)
      }{
         Number of rows which the catalogue is to contain.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_RSTXT
}{
   Reset the access to the textual information in a catalogue
}{
   \sstdescription{
      Reset the access to the textual information in a catalogue.
      A subsequent attempt access a line of textual information will
      return the first line of textual information.
   }
   \sstinvocation{
      CALL CAT\_RSTXT (CI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_SELCT
}{
   Create a selection of rows satisfying some expression
}{
   \sstdescription{
      Create a selection of rows satisfying some expression.

      The selection may be created from either a genuine catalogue or
      some previous selection from a catalogue.

      The expression can involve both indexed and unindexed columns.
      If indexed columns are involved, they are NOT used to optimise
      the selection.
   }
   \sstinvocation{
      CALL CAT\_SELCT (CI, EI, REJFLG; SI, NUMSEL, SIR, NUMREJ; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Input catalogue or selection from which the new selection is
         to be generated.  Note that CI may be either a catalogue or
         a selection identifier.
      }
      \sstsubsection{
         EI  =  INTEGER (Given)
      }{
         Identifier to the logical expression defining the selection
         criteria.
      }
      \sstsubsection{
         REJFLG  =  LOGICAL (Returned)
      }{
         Flag indicating whether or not a second selection of the
         rejected rows is to be created:
         .TRUE.  -  create the catalogue of rejected rows,
         .FALSE. -  do not create the catalogue of rejected rows.
      }
      \sstsubsection{
         SI  =  INTEGER (Returned)
      }{
         Selection identifier to the set of selected rows.
      }
      \sstsubsection{
         NUMSEL  =  INTEGER (Returned)
      }{
         Number of rows selected.
      }
      \sstsubsection{
         SIR  =  INTEGER (Returned)
      }{
         Optional selection identifier to the set of rejected rows.
         If the rejected rows are not being retained then SIR is set
         to the null identifier.
      }
      \sstsubsection{
         NUMREJ  =  INTEGER (Returned)
      }{
         Number of rows rejected.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_SFND$<$t$>$
}{
   Create a selection of rows within a given range
}{
   \sstdescription{
      Create a selection of rows in a catalogue for which the fields
      for a specified column lie in a given range.

      A field is selected if it lies in the range:

        field value .GE. MINRNG  .AND.  field value .LE. MAXRNG

      The selection may be created from either a genuine catalogue or
      some previous selection from a catalogue.

      The specified column must be sorted in ascending or descending
      order (eventually the routine will be enhanced to work on
      indexed columns too).
   }
   \sstinvocation{
      CALL CAT\_SFND$<$t$>$ (CI, FI, MINRNG, MAXRNG, REJFLG; SI, NUMSEL,
        SIR, NUMREJ; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Input catalogue or selection from which the new selection is
         to be generated.  Note that CI may be either a catalogue or
         a selection identifier.
      }
      \sstsubsection{
         FI  =  INTEGER (Given)
      }{
         Identifier to the column whose fields will be selected to
         lie in the given range.  The column must be sorted into
         ascending or descending order (and known by CAT to be so
         sorted).
      }
      \sstsubsection{
         MINRNG  =  $<$type$>$ (Given)
      }{
         Minimum value which a field must satisfy to be selected.
      }
      \sstsubsection{
         MAXRNG  =  $<$type$>$ (Given)
      }{
         Maximum value which a field must satisfy to be selected.
      }
      \sstsubsection{
         REJFLG  =  LOGICAL (Returned)
      }{
         Flag indicating whether or not a second selection of the
         rejected rows is to be created:
         .TRUE.  -  create the catalogue of rejected rows,
         .FALSE. -  do not create the catalogue of rejected rows.
      }
      \sstsubsection{
         SI  =  INTEGER (Returned)
      }{
         Selection identifier to the set of selected rows.
      }
      \sstsubsection{
         NUMSEL  =  INTEGER (Returned)
      }{
         Number of rows selected.
      }
      \sstsubsection{
         SIR  =  INTEGER (Returned)
      }{
         Optional selection identifier to the set of rejected rows.
         If the rejected rows are not being retained then SIR is set
         to the null identifier.
      }
      \sstsubsection{
         NUMREJ  =  INTEGER (Returned)
      }{
         Number of rows rejected.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_SINQ
}{
   Inquire all the attributes of a selection
}{
   \sstdescription{
      Inquire all the attributes of a selection.
   }
   \sstinvocation{
      CALL CAT\_SINQ (SI; CI, EXPR, NUMSEL, COMM, DATE; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         SI  =  INTEGER (Given)
      }{
         Selection identifier.
      }
      \sstsubsection{
         CI  =  INTEGER (Returned)
      }{
         Catalogue identifier for the parent catalogue of the selection.
      }
      \sstsubsection{
         EXPR  =  CHARACTER$*$($*$) (Returned)
      }{
         Expression defining the selection.
      }
      \sstsubsection{
         NUMSEL  =  INTEGER (Returned)
      }{
         Number of rows in the selection.
      }
      \sstsubsection{
         COMM  =  CHARACTER$*$($*$) (Returned)
      }{
         Comments for the selection.
      }
      \sstsubsection{
         DATE  =  DOUBLE PRECISION (Returned)
      }{
         Date the selection was created.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_SLIST
}{
   Create a selection from an array of row numbers
}{
   \sstdescription{
      Create a selection from an array of row numbers.

      The selection may be created from either a genuine catalogue or
      some previous selection from a catalogue.
   }
   \sstinvocation{
      CALL CAT\_SLIST (NUMSEL, SELIST, CRIT, REJFLG, CI; SI, SIR, NUMREJ;
        STATUS)
   }
   \sstarguments{
      \sstsubsection{
         NUMSEL  =  INTEGER (Given)
      }{
         Number of rows to be selected.
      }
      \sstsubsection{
         SELIST(NUMSEL)  =  INTEGER (Given)
      }{
         Array of row numbers to be selected.  These row numbers must
         be rows in the catalogue or selection to which CI corresponds.
         That is, if CI corresponds to a catalogue they will be absolute
         row numbers.  However, if CI is a selection they will be row
         numbers in the selection, NOT the corresponding row numbers in
         the underlying catalogue.
      }
      \sstsubsection{
         CRIT  =  CHARACTER$*$($*$) (Given)
      }{
         Character string summarising the selection criteria.
      }
      \sstsubsection{
         REJFLG  =  LOGICAL (Given)
      }{
         Flag indicating whether or not a second selection of the
         rejected rows is to be created:
         .TRUE.  -  create the catalogue of rejected rows,
         .FALSE. -  do not create the catalogue of rejected rows.
      }
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Input catalogue or selection from which the new selection is
         to be generated.  Note that CI may be either a catalogue or
         a selection identifier.
      }
      \sstsubsection{
         SI  =  INTEGER (Returned)
      }{
         Selection identifier to the set of selected rows.
      }
      \sstsubsection{
         SIR  =  INTEGER (Returned)
      }{
         Optional selection identifier to the set of rejected rows.
         If the rejected rows are not being retained then SIR is set
         to the null identifier.
      }
      \sstsubsection{
         NUMREJ  =  INTEGER (Returned)
      }{
         Number of rows rejected.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_SRNG$<$t$>$
}{
   Get the rows corresponding to a range for a sorted column
}{
   \sstdescription{
      Get the first and last rows in a catalogue for which the fields
      for a specified column lie in a given range.

      A field is selected if it lies in the range:

        field value .GE. MINRNG  .AND.  field value .LE. MAXRNG

      The selection may be performed on either a genuine catalogue or
      some previous selection from a catalogue.

      The specified column must be sorted in ascending or descending
      order (eventually the routine will be enhanced to work on
      indexed columns too).

      If there are no rows in the specified range then FIRSTR and LASTR
      are returned both set zero.
   }
   \sstinvocation{
      CALL CAT\_SRNG$<$t$>$ (CI, FI, MINRNG, MAXRNG; FIRSTR, LASTR;
        STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Input catalogue or selection from which the new selection is
         to be generated.  Note that CI may be either a catalogue or
         a selection identifier.
      }
      \sstsubsection{
         FI  =  INTEGER (Given)
      }{
         Identifier to the column whose fields will be selected to
         lie in the given range.  The column must be sorted into
         ascending or descending order (and known by CAT to be so
         sorted).
      }
      \sstsubsection{
         MINRNG  =  $<$type$>$ (Given)
      }{
         Minimum value which a field must satisfy to be selected.
      }
      \sstsubsection{
         MAXRNG  =  $<$type$>$ (Given)
      }{
         Maximum value which a field must satisfy to be selected.
      }
      \sstsubsection{
         FIRSTR  =  INTEGER (Returned)
      }{
         First row in the specified range.
      }
      \sstsubsection{
         LASTR  =  INTEGER (Returned)
      }{
         Last row in the specified range.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_SZTXT
}{
   Return the maximum permitted size of a line of text for a cat
}{
   \sstdescription{
      Return the maximum permitted size of a line of text for a
      catalogue.  The maximum permitted size is defined by the back-end
      type.
   }
   \sstinvocation{
      CALL CAT\_SZTXT (CI, ACCESS; LINESZ; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         ACCESS  =  CHARACTER$*$($*$) (Given)
      }{
         Mode in which the text is to be accessed; \texttt{'}READ\texttt{'} or \texttt{'}WRITE\texttt{'}.
      }
      \sstsubsection{
         LINESZ  =  INTEGER (Returned)
      }{
         Maximum permitted size of a line of textual information for
         the catalogue.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_TATT$<$t$>$
}{
   Set an attribute of a component to a given value
}{
   \sstdescription{
      Set an attribute of a component to a given value.  Type
      conversions are performed if necessary.
   }
   \sstinvocation{
      CALL CAT\_TATT$<$t$>$ (GI, ATTRIB, VALUE$<$t$>$; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         GI  =  INTEGER (Given)
      }{
         Generic component identifier.
      }
      \sstsubsection{
         ATTRIB  =  CHARACTER$*$($*$) (Given)
      }{
         Name of the attribute to be set.
      }
      \sstsubsection{
         VALUE  =  $<$type$>$  (Given)
      }{
         Value to which the attribute is to be set.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_TCOLS
}{
   Get the number of columns in a catalogue
}{
   \sstdescription{
      Get the number of columns in a catalogue.
   }
   \sstinvocation{
      CALL CAT\_TCOLS (CI, COLFLG; NUMCOL; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         COLFLG  =  INTEGER (Given)
      }{
         Flag indicating the type of columns of which the number is
         to be obtained, coded as follows:
         CAT\_\_GVIRT - virtual columns only,
         CAT\_\_GPHYS - physical columns only,
         CAT\_\_GALL  - all columns (virtual and physical).
      }
      \sstsubsection{
         NUMCOL  =  INTEGER (Returned)
      }{
         Number of columns in the catalogue.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_TDETL
}{
   Get the details of a catalogue
}{
   \sstdescription{
      Get some summary details of a catalogue.  This routine will work
      only if it is given a genuine catalogue identifier.  If it is
      given a selection identifier (or any other sort of identifier)
      it will return with an error status.
   }
   \sstinvocation{
      CALL CAT\_TDETL (CI, COLFLG; NUMROW, NUMCOL, NUMIND, NUMPAR, DATE;
        STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue identifier.  This routine will accept only a catalogue
         identifier; not a selection identifier.
      }
      \sstsubsection{
         COLFLG  =  INTEGER (Given)
      }{
         Flag indicating the type of columns for which the details are
         to be obtained, coded as follows:
         CAT\_\_GVIRT - virtual columns only,
         CAT\_\_GPHYS - physical columns only,
         CAT\_\_GALL  - all columns (virtual and physical).
      }
      \sstsubsection{
         NUMROW  =  INTEGER (Returned)
      }{
         Number of rows in the catalogue.
      }
      \sstsubsection{
         NUMCOL  =  INTEGER (Returned)
      }{
         Number of columns in the catalogue.
      }
      \sstsubsection{
         NUMIND  =  INTEGER (Returned)
      }{
         Number of indices to the catalogue.
      }
      \sstsubsection{
         NUMPAR  =  INTEGER (Returned)
      }{
         Number of parameters in the catalogue.
      }
      \sstsubsection{
         DATE  =  DOUBLE PRECISION (Returned)
      }{
         Creation date of the catalogue.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_TIDNT
}{
   Get an identifier for a named pre-existing component
}{
   \sstdescription{
      Get an identifier for a named pre-existing component.  The
      component may be of any type.
   }
   \sstinvocation{
      CALL CAT\_TIDNT (CI, GNAME; GI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Identifier to the catalogue to which the component belongs.
      }
      \sstsubsection{
         GNAME  =  CHARACTER$*$($*$) (Given)
      }{
         Name of the component.  The component may be of any type.
      }
      \sstsubsection{
         GI  =  INTEGER (Returned)
      }{
         Identifier to the component.  The null identifier is returned
         if the specified component could not be found.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_TIDPR
}{
   Determine the parent to a component
}{
   \sstdescription{
      Determine the parent to a component.  That is, the routine is
      give the identifier of a component and it will return the
      identifier of that component\texttt{'}s parent catalogue.

      If the routine is given a catalogue identifier it will return
      the null identifier, because catalogues do not have parents.
   }
   \sstinvocation{
      CALL CAT\_TIDPR (GI; CI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         GI  =  INTEGER (Given)
      }{
         Identifier to a component.
      }
      \sstsubsection{
         CI  =  INTEGER (Returned)
      }{
         Identifier to the parent catalogue of the component.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_TIDTP
}{
   Determine the type of a component
}{
   \sstdescription{
      Determine the type of a component.  The possibilities are:
      catalogue, column (or field), parameter, expression, index,
      selection or join.
   }
   \sstinvocation{
      CALL CAT\_TIDTP (GI; IDTYP; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         GI  =  INTEGER (Given)
      }{
         Identifier to a component.
      }
      \sstsubsection{
         IDTYP  =  INTEGER (Returned)
      }{
         Type of the identifier, coded according to the following
         scheme:
         CAT\_\_CITYP - catalogue,
         CAT\_\_FITYP - column (or field),
         CAT\_\_QITYP - parameter,
         CAT\_\_EITYP - expression,
         CAT\_\_IITYP - index,
         CAT\_\_SITYP - selection,
         CAT\_\_JITYP - join.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_TIQA$<$t$>$
}{
   Inquire the value of a single attribute for a component
}{
   \sstdescription{
      Inquire the value of a single attribute for a component.  If the
      value of an array is inquired, the value of the first element is
      returned.
   }
   \sstinvocation{
      CALL CAT\_TIQA$<$t$>$ (GI, ATTRIB; VALUE$<$t$>$; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         GI  =  INTEGER (Given)
      }{
         Generic component identifier.
      }
      \sstsubsection{
         ATTRIB  =  CHARACTER$*$($*$) (Given)
      }{
         Name of the attribute of the component.
      }
      \sstsubsection{
         VALUE  =  $<$type$>$ (Returned)
      }{
         Value of the named attribute.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_TNDNT
}{
   Get an identifier for the Nth (pre-existing) component of a
   given type
}{
   \sstdescription{
      Get an identifier for the Nth (pre-existing) component of a
      given type.  If N components of the required type could not be
      found for the specified catalogue then the null identifier
      (CAT\_\_NOID is returned) and the running status remains ok.
   }
   \sstinvocation{
      CALL CAT\_TNDNT (CI, IDTYP, N; GI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         IDTYP  =  INTEGER (Given)
      }{
         Type of identifier required, coded as follows:
         CAT\_\_CITYP - catalogue,
         CAT\_\_FITYP - column (or field),
         CAT\_\_QITYP - parameter,
         CAT\_\_EITYP - expression,
         CAT\_\_IITYP - index,
         CAT\_\_SITYP - selection,
         CAT\_\_JITYP - join.
      }
      \sstsubsection{
         N  =  INTEGER (Given)
      }{
         Number of the component, of the specified type, that is
         required.
      }
      \sstsubsection{
         GI  =  INTEGER (Returned)
      }{
         Identifier to the required component.  If the required
         component could not be found GI is set to CAT\_\_NOID.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_TOPEN
}{
   Open a catalogue and obtain an identifier to it
}{
   \sstdescription{
      Open a catalogue and obtain an identifier to it.

      The matrix of possibilities for STATE and MODE is:

      STATE = \texttt{'}NEW\texttt{'}, then
        MODE = \texttt{'}WRITE\texttt{'} is ok
        and MODE = \texttt{'}READ\texttt{'} if forbidden.

      STATE = \texttt{'}OLD\texttt{'} then
        MODE = \texttt{'}WRITE\texttt{'} is ok
        and MODE = \texttt{'}READ\texttt{'} is ok.

      Notes:

      $*$ If a catalogue already exists and an attempt is made to open
        it with STATE = \texttt{'}NEW\texttt{'}, CAT\_TOPEN will fail with an error.

      $*$ If an existing catalogue is opened with STATE = \texttt{'}OLD\texttt{'} and
        MODE = \texttt{'}WRITE\texttt{'} it will be overwritten.
   }
   \sstinvocation{
      CALL CAT\_TOPEN (CNAME, STATE, MODE; CI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CNAME  =  CHARACTER$*$($*$) (Given)
      }{
         Catalogue name.
      }
      \sstsubsection{
         STATE  =  CHARACTER$*$($*$) (Given)
      }{
         Required state of the catalogue.  One of:
         NEW  -  A new catalogue is to be created,
         OLD  -  An existing (that is, old) catalogue is to be opened.
      }
      \sstsubsection{
         MODE  =  CHARACTER$*$($*$) (Given)
      }{
         Mode in which the catalogue will be accessed.  One of:
         READ   -  the catalogue may only be read from,
         WRITE  -  an new catalogue is to be written.
      }
      \sstsubsection{
         CI  =  INTEGER (Returned)
      }{
         Catalogue identifier.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_TRLSE
}{
   Release a catalogue identifier
}{
   \sstdescription{
      Release a catalogue identifier.

      Internal work space and arrays used by the catalogue are released
      and made available for re-use.

      Note thatthis routine attempts to execute irrespective of the
      status on entry.
   }
   \sstinvocation{
      CALL CAT\_TRLSE (CI; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given and Returned)
      }{
         On input: the catalogue identifier to be released.
         On output: the null identifier.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_TROWS
}{
   Get the number of rows in a catalogue, selection or index
}{
   \sstdescription{
      Get the number of rows in a catalogue, selection or index.
   }
   \sstinvocation{
      CALL CAT\_TROWS (CI; NUMROW; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CI  =  INTEGER (Given)
      }{
         Catalogue, selection or index identifier.
      }
      \sstsubsection{
         NUMROW  =  INTEGER (Returned)
      }{
         Number of rows in the catalogue, selection or index.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_TUNEG
}{
   Get a CAT tuning parameter
}{
   \sstdescription{
      Get a CAT tuning parameter. Note that all these parameters are of
      type CHARACTER.
   }
   \sstinvocation{
      CALL CAT\_TUNEG (CATPRM; VALUE; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CATPRM  =  CHARACTER$*$($*$) (Given)
      }{
         Name of the catalogue parameter which is to be got.  Currently
         the only parameters supported are \texttt{'}ANGLE\_LIST\texttt{'} and \texttt{'}QUIET\texttt{'}.
      }
      \sstsubsection{
         VALUE  =  CHARACTER$*$($*$) (Given)
      }{
         The current value of the specified parameter, expressed as a
         CHARACTER string.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 2001 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_TUNES
}{
   Set a CAT tuning parameter
}{
   \sstdescription{
      Set a CAT tuning parameter. Note that all these parameters are of
      type CHARACTER.
   }
   \sstinvocation{
      CALL CAT\_TUNES (CATPRM, VALUE; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         CATPRM  =  CHARACTER$*$($*$) (Given)
      }{
         Name of the CAT tuning parameter which is to be set.  Currently
         the tuning parameters supported are \texttt{'}ANGLE\_LIST\texttt{'} and \texttt{'}QUIET\texttt{'}.
      }
      \sstsubsection{
         VALUE  =  CHARACTER$*$($*$) (Given)
      }{
         Value required for the catalogue parameter.

         For parameter ANGLE\_LIST the values may be as follows:
           \texttt{'}RADIANS\texttt{'}     -  output angles in radians,
           \texttt{'}SEXAGESIMAL\texttt{'} -  output angles in hours or degrees, formatted
              as sexagesimal values.

         For parameter QUIET the values may be as follows:
           \texttt{'}YES\texttt{'} - do not issue informational messages (ie. be quiet),
           \texttt{'}NO\texttt{'}  - issue informational messages (ie. not quiet).
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 2000 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}
\sstroutine{
   CAT\_TYFMT
}{
   Construct a character representation of a CAT data type
}{
   \sstdescription{
      Construct a character string representation of a CAT data
      type and append it to a character string.

      CAT data types are represented using an integer code (here
      argument DTYPE) with a further integer variable (here argument
      CSIZE) giving the size of character strings.  A character
      representation of the data type is constructed from these integer
      numbers.  This character string representation is (deliberately)
      identical to that used by HDS.

      The constructed value is appended to the input string, starting
      at element POSN$+$1 of the input string (using the input value for
      POSN).  On output POSN is set to the new length of the string
      (cf. the CHR routines).

      If an illegal CAT data type is input, the assembled string
      contains an error text, but an error status is deliberately not
      raised.  This behaviour is adopted because CAT\_TYFMT is just
      formatting a character string and an invalid data type is not
      really an error for it.
   }
   \sstinvocation{
      CALL CAT\_TYFMT (DTYPE, CSIZE; STRING, POSN; STATUS)
   }
   \sstarguments{
      \sstsubsection{
         DTYPE  =  INTEGER (Given)
      }{
         Code for a CAT data type.
      }
      \sstsubsection{
         CSIZE  =  INTEGER (Given)
      }{
         Size of a CAT character string.
      }
      \sstsubsection{
         STRING  =  CHARACTER$*$($*$) (Given and Returned)
      }{
         The character string into which the data type is to be
         appended.
      }
      \sstsubsection{
         POSN  =  INTEGER (Given and Returned)
      }{
         The last non-blank element of STRING.  VALUE is inserted into
         STRING starting at the element given by input value of POSN$+$1.
         On output POSN is set to the new length of the string, again
         excluding trailing blanks.
      }
      \sstsubsection{
         STATUS  =  INTEGER (Given and Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      Copyright
   }{
      Copyright (C) 1999 Central Laboratory of the Research Councils
   }
   \sstbugs{
      None known
   }
}

% ----------------------------------------------------------------------
\end{small}

\newpage
\section{\label{EXPR}\xlabel{EXPR}Expression syntax}

This appendix discusses the syntax permitted for expressions passed
to the expression parser. Expressions are input to CAT as argument \texttt{EXPR} of subroutine \texttt{CAT\_EIDNT} (see Section~\ref{SUBINT}).

Expressions have an algebraic format, and comprise: columns, vector
column elements, parameters and constants linked by arithmetic
operators and mathematical functions. For example, suppose that a
catalogue contained scalar columns called \texttt{x}, \texttt{y} and \texttt{z}
and parameters called \texttt{p} and \texttt{q}.  Some valid expressions are:

\begin{equation}
\begin{array}{l}
\texttt{x}  \\
\texttt{p}  \\
\texttt{x + p}  \\
\texttt{(x + y + 2) / (p + q)}  \\
\texttt{(2.0*x + y + 3.75*p) + 13.0) / (z + 1.8*q)}
\end{array}
\end{equation}

Remember that in CAT column and parameter names are not case-sensitive.
Thus the following column or parameter names would all be considered
equivalent:

\begin{verse}
\texttt{HD\_NUMBER} \\
\texttt{HD\_Number} \\
\texttt{hd\_number}
\end{verse}

Vector column elements occur in expressions with their usual syntax:
the name of the base column followed by the element number enclosed
in square brackets. The first element in a vector is numbered one. For
example, an expression to add two to the fourth element of vector
\texttt{FLUX} would be `\texttt{FLUX[4] + 2.0}'.


\subsection{Details of expressions}

The arithmetic operators are:

\begin{tabular}{ll}
\texttt{+}  & addition,        \\
\texttt{-}  & subtraction,     \\
\texttt{*}  & multiplication,  \\
\texttt{/}  & division.        \\
\end{tabular}

brackets (`\texttt{(}' and `\texttt{)}') may be used as required.


\subsection{Mathematical functions provided}

Table~\ref{FUNCS} lists the mathematical functions which are provided.
The letters denote data types permitted, coded as follows: B = BYTE,
H = half INTEGER, I = INTEGER, R = REAL, D = DOUBLE PRECISION, C =
CHARACTER, L = LOGICAL. The appearance of N as an argument means that
any numeric type (BHIRD) is permitted, as a result it means that the
type is the widest type of any of the arguments.  R/D means that the
result is REAL unless one or more arguments is of DOUBLE PRECISION
type in which case D is the result.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{ll}
Function            & Notes   \\ \hline
B = BYTE(N)         & convert to BYTE data type  \\
H = HALF(N)         & convert to INTEGER*2 data type  \\
I = INT(N)          & convert to INTEGER data type  \\
R = REAL(N)         & convert to REAL data type  \\
D = DBLE(N)         & convert to DOUBLE PRECISION data type  \\
I = NINT(N)         & convert to nearest INTEGER  \\
N = MIN(N,N)        & the function must have precisely two arguments  \\
N = MAX(N,N)        & the function must have precisely two arguments  \\
N = MOD(N,N)        & remainder  \\
N = ABS(N)          & absolute value  \\
R/D = SQRT(N)       & square root  \\
R/D = LOG(N)        & natural logarithm  \\
R/D = LOG10(N)      & logarithm to the base 10  \\
R/D = EXP(N)        & exponential  \\
R/D = SIN(N)        & sine; argument in radians  \\
R/D = COS(N)        & cosine; argument in radians  \\
R/D = TAN(N)        & tangent; argument in radians  \\
R/D = ASIN(N)       & arc-sine; result in radians  \\
R/D = ACOS(N)       & arc-cosine; result in radians  \\
R/D = ATAN(N)       & arc-tangent; result in radians  \\
R/D = ATAN2(N,N)    & arc-tangent (two arguments) result in radians  \\
I = IAND(I,I)       & bitwise logical AND  \\
I = IOR(I,I)        & bitwise logical OR  \\
I = XOR(I,I)        & bitwise logical exclusive OR  \\
R/D = DTOR(N)       & degrees to radians conversion  \\
R/D = RTOD(N)       & radians to degrees conversion  \\
C = UPCASE(C)       & convert character string to upper case  \\
C = STRIP(C)        & leading and trailing spaces are removed  \\
C = SUBSTR(C,N,N)   & returns characters from positions argument 2 \\
                    & to argument 3 inclusive, with the positions  \\
                    & starting at 1  \\
L = NULL(*)         & .TRUE. if argument is NULL  \\
D = HMSRAD(N,N,N)   & converts 3 arguments hours, minutes and \\
                    & seconds to radians  \\
D = DMSRAD(C,N,N,N) & first argument is the sign (`$+$' or `-' ), \\
                    & converts degrees, minutes and seconds to radians \\
D = GREAT(N,N,N,N)  & great circle distance between two spherical \\
                    & coordinates. All the input arguments and the \\
                    & return argument are in radians. The input arguments \\
      & are in the order: $(\alpha_{1},\delta_{1}$,$\alpha_{2},\delta_{2})$ \\
D = PANGLE(N,N,N,N) & Position angle of point $(\alpha_{2},\delta_{2})$
  from point \\
      & $(\alpha_{1},\delta_{1})$.  All the input arguments and the return \\
      & argument are in radians. The input arguments are in \\
      & the order: $(\alpha_{1},\delta_{1}$,$\alpha_{2},\delta_{2})$ \\
\end{tabular}
\end{center}

\caption{\label{FUNCS}Mathematical functions which may be used in expressions}

\end{table}


\subsection{Rules for expressions}

The expression string can contain constants, column and parameter names,
operators, functions, and parentheses.  In general the usual rules of
algebra and Fortran should be followed, with some minor exceptions,
as noted below.

\begin{enumerate}

  \item Spaces are permitted between items, except that a function-name
   must be followed immediately by a left parenthesis.  Spaces are not
   permitted within items such as names and numerical constants, but can be
   used within character strings and date/time values in curly braces.

  \item Lower-case letters are treated everywhere as identical to the
   corresponding upper-case letter.

  \item Column and parameter names can be up to \texttt{CAT\_\_SZCMP}
   characters long, and may consist of letters, digits, and underscores,
   except that the first character must not be a digit.

  \item Vector elements are supported but with a restricted syntax:
   they may consist of a name followed by an unsigned integer constant
   subscript enclosed in square brackets, for example \texttt{FLUX[4]} or
   \texttt{MAGNITUDE[13]}. The first element of the vector is numbered one.

  \item CHARACTER constants may be enclosed in a pair of single or
   double quotes; embedded quotes of the same type may be denoted by
   doubling up on the quote character within the string, for example
   \verb+'DON''T'+ or \verb+"DON""T"+.

  \item LOGICAL constants may be \texttt{.TRUE.} or \texttt{.FALSE.} but
   abbreviations of these words are allowed down to \texttt{.T.} and
   \texttt{.F.}

  \item Numerical constants may appear in any valid form for Fortran 77
   (except that embedded spaces are not allowed).  Some additional forms
   are also permitted, as shown below.

  \item \%Xstring \%Ostring \%Bstring for hexadecimal, octal and binary
   INTEGER constants respectively.

  \item Angles in sexagesimal notation: colons must be used to separate
   items, for example hours:minutes:seconds (or degrees:minutes:seconds).
   If there is a leading sign then the value will be taken as
   degrees:minutes:seconds, otherwise hours:minutes:seconds.  In either
   case the value is converted to RADIANS.

  \item A date/time value may be given as a string enclosed in curly
   braces; a range of common formats are permitted, with order
   year-month-day or day-month-year, and the month as a number or
   three-character abbreviation.  The time may follow with colons separating
   hours:minutes:seconds.  Examples of some valid dates:
  \begin{verse}
   \texttt{1992-JUL-26 12:34:56}  \\
   \texttt{92.7.26}  \\
   \texttt{26/7/92T3:45}
  \end{verse}

  \item Relational operators are supported in both Fortran 77 form
   (for example \texttt{.GE. .NE.}) as well as in the Fortran 90 forms (for
   example, $\texttt{>=}$ $\texttt{/=}$ ).

  \item Single-symbol forms for \texttt{.AND. .OR. and .NOT.} are provided as
   an alternative: \texttt{\&} $\texttt{|}$ \texttt{\#} respectively.

  \item The dots may be left off the Fortran 77 forms of the relational
   operators and the logical operators \texttt{.AND.} and \texttt{.OR.} where
   spaces or parentheses separate them from names or constants, but the
   logical constants and the \texttt{.NOT.} operator need the enclosing dots
   to distinguish them from other lexical items in all cases.

  \item INTEGER division does not result in truncation (as in Fortran)
   but produces a floating-point result.  The \texttt{NINT} or \texttt{INT}
   function should be used (as appropriate) if an INTEGER result is
   required.

  \item The functions \texttt{MAX} and \texttt{MIN} must have exactly two
   arguments.

  \item All arithmetic is carried out internally in DOUBLE PRECISION
   (but the compiler works out the effective data type of the result using
   the normal expression rules).

  \item Exponentiation is performed by log/exp functions, with use of
   ABS to avoid taking logs of negative arguments, thus \texttt{-2**3} will
   come out as `+8' not `-8'.

\end{enumerate}

\subsection{Operator precedence}

The operator precedence rules are show in Table~\ref{PREC}. The rules
of Fortran 90 are used as far as possible; in this table the larger
numbers denote higher precedence (tighter binding).

\begin{table}[htbp]

\begin{center}
\begin{tabular}{rl}
Precedence  & Function/operator  \\ \hline
  2 & start/end of expression  \\
  4 & \texttt{(  )}  \\
  6 & \texttt{,}  \\
  8 & \texttt{.EQV.  .NEQV.}  \\
 10 & \texttt{.OR.}   $\texttt{|}$  \\
 12 & \texttt{.AND.  \&} \\
 14 & \texttt{.NOT.  \#}  \\
 16 & \texttt{.EQ. .GE. .GT. .LE. .LT. .NE.} $\texttt{== ~ >= ~ > ~ <= ~ < ~ /=}$ \\
 18 & \texttt{FROM  TO}  \\
 20 & \texttt{//}  \\
 22 & \texttt{+ -} (binary operators)  \\
 24 & \texttt{+ -} (unary operators)  \\
 26 & \texttt{* /}  \\
 28 & \texttt{**}  \\
 30 & all functions  \\
\end{tabular}
\end{center}

\caption{\label{PREC}Operator precedence rules}

\end{table}


Note that all operators except \texttt{**} associate from left to right, but
\texttt{**} and functions associate from right to left.


\newpage
\section{\label{FORMAT}\xlabel{FORMAT}Catalogue formats}

CAT can access catalogues held in several different formats: FITS tables,
STL lists and Tab-Separated Tables.  The restrictions and peculiarities
associated with each of these formats are described below.

CAT determines the type of a catalogue from the `file type' component
of the name of the file holding the catalogue. The file types for the
various formats are included in the descriptions below. If a file name
is specified without a file type then it is assumed to be a FITS table
of file type \texttt{.FIT}.


\subsection{FITS}

File types: \texttt{.FIT  .fit  .FITS  .fits  .GSC  .gsc}

Mixed capitalisations, such as \texttt{.Fit}, are also supported.  The \texttt{.GSC} file types are supported in order to allow regions of the HST \textit{Guide Star Catalog}\, to be accessed.

CAT can read both binary and formatted FITS tables. It can write only
binary FITS tables. It should be able to handle most components of
FITS tables, with the exception of variable length array columns. If
a variable length array column is encountered a warning message will
be reported and the column will be ignored.

If a column containing no data is encountered a warning message will be
generated and the column will be ignored.

In common with other Starlink software, CAT does not support the
COMPLEX REAL and COMPLEX DOUBLE PRECISION data types. If it encounters
COMPLEX columns in a FITS table it represents them as follows:

\begin{itemize}

  \item a COMPLEX REAL scalar column is represented as a REAL vector
   column of two elements,

  \item a COMPLEX REAL vector column of $n$ elements is represented as
   a REAL vector column of $2n$ elements,

  \item a COMPLEX DOUBLE PRECISION scalar column is represented as a
   DOUBLE PRECISION vector column of two elements,

  \item a COMPLEX DOUBLE PRECISION vector column of $n$ elements is
   represented as a DOUBLE PRECISION vector column of $2n$ elements.

\end{itemize}

Usually the table component of a FITS file occurs in the first FITS
extension to the file. When reading an existing FITS file CAT will look
for a table in the first extension. In cases where the table is located
in an extension other than the first you may specify the required
extension by giving its number inside curly brackets after the name
of the file. For example, if the table occurred in the third extension
of a FITS file called \texttt{perseus.FIT} you would specify:

\begin{terminalv}
perseus.FIT{3}
\end{terminalv}

The closing curly bracket is optional. When CAT writes FITS tables
the table is always written to the first extension.

\subsubsection{Textual information}

The textual information for a FITS table comprises the entire contents
of the primary header and the appropriate table extension header of the
FITS file containing the table. The entire contents of both headers are
returned because this is the best way to present the maximum amount of
information about the catalogue to the user in its full context. For
example, a FITS table COMMENT keyword may be used to annotate other
keywords and if only the COMMENT keywords were returned `out of context'
they would be difficult to understand, and perhaps even misleading.

In addition CAT invents two additional lines of textual information.
The first precedes the primary header and serves to introduce it. The
second is inserted between the primary header and the table extension
header, and serves to introduce the table extension header. These two
lines have class `CAT' (because they are invented by CAT).
Table~\ref{FITS_TEXT} lists the text classes supported for FITS
tables.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{lll}
Access & Class    & Description   \\ \hline
Read   & COMMENT  & Comment line  \\
       & HISTORY  & Line of history information \\
       & KEYWORD  & Named FITS keyword  \\
       & BLANK    & FITS blank comment line  \\
       & CAT      & Line invented by CAT \\
       &          & \\
Write  & COMMENT  & Comment line  \\
       & HISTORY  & Line of history information \\
\end{tabular}
\end{center}

\caption{\label{FITS_TEXT}Classes of textual information for a FITS table}

\end{table}


\subsection{STL}

File types: \texttt{.TXT  .txt}

Mixed capitalisations, such as \texttt{.Txt}, are also supported.

CAT can read and write catalogues in the STL (Small Text List) format.
Unlike the other formats which CAT can access the STL format is specific
to the CAT library.  Nonetheless the STL format exists in order to allow
easy access to both private tables and versions of standard catalogues
held as text files.  It is usually straightforward to create an STL
catalogue from a text file containing a private list or standard catalogue.

In the STL format both the table of values for the catalogue and the
definitions of its columns, parameters etc. are held in simple ASCII
text files.  These files may be created and modified with a text editor.
The information defining the catalogue is called the \textbf{description} of
the catalogue and the file in which it is held is called the \textbf{description file}.

When you specify a small text list you give the name of the description
file.  The table of values comprising the catalogue may either be in the
same file as the description or in a separate file.  If the table of values
occurs in a separate file then the name of this file is specified in the
description file and CAT places no restrictions on this name other than
those imposed by the host operating system.

The STL format is fully documented in appendices to
\xref{SUN/190}{sun190}{}\cite{SUN190}, the manual for the catalogue and
table manipulation package CURSA\footnote{CURSA uses the CAT library to
access catalogues.}.  The documentation consists of a simple
\xref{tutorial}{sun190}{STLTUT} which is a good starting point and a
\xref{complete description}{sun190}{STLREF}.  In addition to the basic STL
format there is a variant which allows STL format files to inter-operate
with applications in the KAPPA image processing package (see
\xref{SUN/95}{sun95}{}\cite{SUN190}).  The
\xref{KAPPA variant}{sun190}{STLKAP} is also documented in SUN/190.

The CURSA documentation refers to various example files kept in
directory:

\begin{verse}
\texttt{/star/share/cursa}
\end{verse}

As a precaution against the unlikely eventuality that CAT is installed
on your system but CURSA is not, there are copies of these files in
directory:

\begin{verse}
\texttt{/star/share/cat}
\end{verse}

The correspondence between items in an STL description and components
in a CAT catalogue is obvious.  In particular, STL data types convert
to CAT ones in the obvious way.

CAT can read STL format catalogues with either a free format or a
fixed-format table of values.  However, CAT can only write STL format
catalogues with a free format table.  The KAPPA variant of the STL may be
both read and written.

As its name implies, the Small Text List format is intended for use
with relatively small catalogues and it is unsuitable for very large
catalogues.  Currently there is no upper limit to the size of catalogue
for which it can be used.  However, if you attempt to read a catalogue
containing more than 15,000 rows a warning message is issued.  A large STL
format catalogue may take a while to open for reading and CAT may be
unable to access a very large STL catalogue\footnote{For
information, the underlying reason for this behaviour is that CAT
attempts to memory-map work arrays to hold the columns of an STL
catalogue and then reads the table into these arrays when an input
catalogue is opened.  For a very large catalogue CAT may be unable to
map the required arrays.}.

\subsubsection{Textual information}

The textual information for an STL catalogue comprises the entire contents
of the description. This approach makes the maximum amount of information
about the catalogue available to the user in its full context.
Table~\ref{STL_TEXT} lists the text classes supported for STL catalogues.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{lll}
Access & Class        & Description   \\ \hline
Read   & COLUMN       & Column definition \\
       & PARAMETER    & Parameter definition \\
       & DIRECTIVE    & Catalogue directive \\
       & CONTINUATION & Continuation line \\
       & NOTE         & Annotation of the catalogue description \\
       & COMMENT      & Comment line  \\
       & BEGINTABLE   & Start of table flag \\
       &              & \\
Write  & COMMENT      & Comment line  \\
       & HISTORY      & Line of history information \\
\end{tabular}
\end{center}

\caption{\label{STL_TEXT}Classes of textual information for a STL
catalogue}

\end{table}

\subsubsection{Null values}

The STL format provides limited support for null values; currently it
does not provide all the options described in Section~\ref{NULLS}.

A null value for a field in an STL table is indicated by inserting
the string `\verb-<null>-' at the appropriate place in the input file.
When CAT reads this string it will interpret it as a null value.
Actually, if CAT encounters any value for a field which it cannot
interpret given the data type of the column (such as a string containing
alphabetic characters in a field for an INTEGER column) then the field
is interpreted as null.  However, when preparing STL files I recommend
that you indicate nulls using the string `\verb-<null>-'.  This string
is recognised as indicating a null value even for CHARACTER columns.

When CAT writes an STL catalogue null fields in the table are
represented by the string `\verb-<null>-'.

Null values are not permitted in the KAPPA variant of the STL format.


\subsection{TST}

File types: \texttt{.TAB  .tab}

Mixed capitalisations, such as \texttt{.Tab}, are also supported.

CAT can read and write catalogues in the TST (Tab-Separated Table)
format.  The TST format is a standard for exchanging catalogue data
and is commonly used to transfer subsets extracted from remote catalogues
or archives across the Internet.  It is used by GAIA (see
\xref{SUN/214}{sun214}{}\cite{SUN214}) and
\htmladdnormallinkfoot{\textit{SkyCat}\/}{http://archive.eso.org/skycat/}.
The TST format is described in
\xref{SSN/75}{ssn75}{}\cite{SSN75}.

Compared to the other formats supported by CAT, the TST format is
somewhat deficient in the amount of metadata that it includes.  In
particular, the details stored for each column do not include its data
type or units.  Consequently, when reading a TST catalogue produced by
an external program CAT deduces a data type for each column by reading
the values that it contains.  This procedure usually works reasonably
well, though occasionally it produces bizarre results.  When CAT writes
a TST catalogue it includes some of the column details.  These details
are written in a format which CAT can interpret if it subsequently
reads the catalogue.  Though this enhancement is specific to CAT it is
entirely consistent with the TST format and does not affect the ability
of external programs to read the catalogues.  The format in which the
additional information is stored is documented in SSN/75.

The TST format does not support vector columns.  If a catalogue
containing vector columns is written as a tab-separated table each vector
element is written as a scalar column.

Unsurprisingly, given its provenance as a medium for transporting
subsets extracted from remote catalogues across the Internet, the
tab-separated table format is intended for use with relatively small
catalogues and is unsuitable for very large ones.  Currently there is no
upper limit to the size of catalogue for which it can be used.  However,
if you attempt to read a catalogue containing more than 15,000 rows a
warning message is issued.  A large TST format catalogue may take a while
to open for reading and CAT may be unable to access a very large TST
catalogue\footnote{For information, the underlying reason for this
behaviour is that CAT attempts to memory-map work arrays to hold the
columns of an TST catalogue and then reads the table into these arrays
when an input catalogue is opened.  For a very large catalogue CAT may
be unable to map the required arrays.}.

\subsubsection{Textual information}

The textual information for a tab-separated table comprises the entire
description of the table.  This approach makes the maximum amount of
information about the catalogue available to the user in its full context.
Table~\ref{TST_TEXT} lists the text classes supported for TST catalogues.

\begin{table}[htbp]

\begin{center}
\begin{tabular}{lll}
Access & Class        & Description   \\ \hline
Read   & COLUMNS      & List of column names \\
       & PARAMETER    & Parameter definition \\
       & NOTE         & Annotation of the catalogue description \\
       & COMMENT      & Comment line  \\
       & BEGINTABLE   & Start of table flag \\
       &              & \\
Write  & COMMENT      & Comment line  \\
       & HISTORY      & Line of history information \\
\end{tabular}
\end{center}

\caption{\label{TST_TEXT}Classes of textual information for a TST
catalogue}

\end{table}

\subsubsection{Null values}

In a tab-separated table the values for adjacent fields in a given row are
separated by a tab character.  In tab-separated tables written by CAT
null values are represented by two adjacent tab characters.  That is, no
value is included for the null field.


% References ----------------------------------------------------------

% \section{References}

% \input{refs.tex}

\newpage
\addcontentsline{toc}{section}{References}
\begin{thebibliography}{99}

  \bibitem{SUN95} M.J.~Currie and D.S.~Berry, 20 October 2000,
   \xref{SUN/95.16}{sun95}{}: \textit{KAPPA --- Kernel Application Package},
    Starlink.

  \bibitem{STARBASE34} A.C.~Davenhall, September 1993, \textit{The Starlink
   Subroutine Interface for Manipulating Catalogues}\/ (StarBase/ACD/3.4).
   See also A.C.~Davenhall, December 1992, \textit{Requirements for a
   Starlink RDBMS}\/ (StarBase/ACD/2.1).
   These documents were written as part of the project to define
   and implement the CAT subroutine library.  StarBase/ACD/3.4 gives the
   complete specification of the CAT subroutine interface, and describes
   much of the thinking that went into the specification.
   StarBase/ACD/2.1 lists the original requirements for the Starlink
   subroutine library to manipulate catalogues and similar tabular
   datasets.

  \bibitem{SUN190} A.C.~Davenhall, 25 July 2000,
   \xref{SUN/190.8}{sun190}{}: \textit{CURSA --- Catalogue and Table
    Manipulation Applications}, Starlink.

  \bibitem{SSN75} A.C.~Davenhall, 26 July 2000,
   \xref{SSN/75.1}{ssn75}{}: \textit{Writing Catalogue and Image Servers for
   GAIA and CURSA}, Starlink.

  \bibitem{SUN214} P.W.~Draper and N.~Gray, 16 October 2000,
   \xref{SUN/214.8}{sun214}{}: \textit{GAIA --- Graphical Astronomy and
   Image Analysis Tool}, Starlink.

  \bibitem{ROTH} M.A. Roth, H.F. Korth and A. Silberschatz, 1989, \textit{Acta Informatica}\, \textbf{26}, pp615-642.

  \bibitem{RUMBLE} J.R.~Rumble and F.J.~Smith, 1990, \textit{Database
   Systems in Science and Engineering}\, (Adam Hilger: Bristol).

  \bibitem{SUN111} D.L.~Terrett and P.M.~Allan, 1 February 1993,
   \xref{SUN/111.2}{sun111}{}: \textit{SPT -- Software Porting Tools},
   Starlink.

  \bibitem{SGP16} P.T.~Wallace, 23 March 1992, SGP/16.10: \textit{Starlink Application Programming Standard}, Starlink.

  \bibitem{SUN39} R.F.~Warren-Smith, 28 February 1995,
   SUN/39.2: \textit{PRIMDAT --- Processing of Primitive Numerical Data},
   Starlink.

  \bibitem{SUN92} R.F.~Warren-Smith and M.D.~Lawden, 23 February 1999,
   \xref{SUN/92.11}{sun92}{}: \textit{HDS --- Hierarchical Data System},
   Starlink.

\end{thebibliography}

\typeout{  }
\typeout{*****************************************************}
\typeout{  }
\typeout{Reminder: run this document through Latex three times}
\typeout{to resolve the references.}
\typeout{  }
\typeout{*****************************************************}
\typeout{  }

\end{document}
