\documentstyle[11pt]{article}
\pagestyle{myheadings}

% -----------------------------------------------------------------------------
% ? Document identification
\newcommand{\stardoccategory}  {Starlink User Note}
\newcommand{\stardocinitials}  {SUN}
\newcommand{\stardocsource}    {sun\stardocnumber}
\newcommand{\stardocnumber}    {238.7}
\newcommand{\stardocauthors}   {D.S. Berry \\Malcolm J. Currie}
\newcommand{\stardocdate}      {2010 December 24}
\newcommand{\stardoctitle}     {KAPLIBS -- Internal subroutines used within
                                the KAPPA package.}
\newcommand{\stardocversion}   {Version 3.1}
\newcommand{\stardocmanual}    {Programmer's Reference}
\newcommand{\stardocabstract}  {KAPLIBS is a package of Fortran subroutine
libraries which were originally written as part of the KAPPA package (a
package of general-purpose image-processing and visualization tools).
KAPLIBS provides software developers with access to many of the internal
KAPPA routines, so that KAPPA-like applications can be written and built
independently of KAPPA.}

% ? End of document identification

% -----------------------------------------------------------------------------

\newcommand{\stardocname}{\stardocinitials /\stardocnumber}
\markright{\stardocname}
\setlength{\textwidth}{160mm}
\setlength{\textheight}{230mm}
\setlength{\topmargin}{-2mm}
\setlength{\oddsidemargin}{0mm}
\setlength{\evensidemargin}{0mm}
\setlength{\parindent}{0mm}
\setlength{\parskip}{\medskipamount}
\setlength{\unitlength}{1mm}

% -----------------------------------------------------------------------------
%  Hypertext definitions.
%  ======================
%  These are used by the LaTeX2HTML translator in conjunction with star2html.

%  Comment.sty: version 2.0, 19 June 1992
%  Selectively in/exclude pieces of text.
%
%  Author
%    Victor Eijkhout                                      <eijkhout@cs.utk.edu>
%    Department of Computer Science
%    University Tennessee at Knoxville
%    104 Ayres Hall
%    Knoxville, TN 37996
%    USA

%  Do not remove the %begin{latexonly} and %end{latexonly} lines (used by
%  star2html to signify raw TeX that latex2html cannot process).
%begin{latexonly}
\makeatletter
\def\makeinnocent#1{\catcode`#1=12 }
\def\csarg#1#2{\expandafter#1\csname#2\endcsname}

\def\ThrowAwayComment#1{\begingroup
    \def\CurrentComment{#1}%
    \let\do\makeinnocent \dospecials
    \makeinnocent\^^L% and whatever other special cases
    \endlinechar`\^^M \catcode`\^^M=12 \xComment}
{\catcode`\^^M=12 \endlinechar=-1 %
 \gdef\xComment#1^^M{\def\test{#1}
      \csarg\ifx{PlainEnd\CurrentComment Test}\test
          \let\html@next\endgroup
      \else \csarg\ifx{LaLaEnd\CurrentComment Test}\test
            \edef\html@next{\endgroup\noexpand\end{\CurrentComment}}
      \else \let\html@next\xComment
      \fi \fi \html@next}
}
\makeatother

\def\includecomment
 #1{\expandafter\def\csname#1\endcsname{}%
    \expandafter\def\csname end#1\endcsname{}}
\def\excludecomment
 #1{\expandafter\def\csname#1\endcsname{\ThrowAwayComment{#1}}%
    {\escapechar=-1\relax
     \csarg\xdef{PlainEnd#1Test}{\string\\end#1}%
     \csarg\xdef{LaLaEnd#1Test}{\string\\end\string\{#1\string\}}%
    }}

%  Define environments that ignore their contents.
\excludecomment{comment}
\excludecomment{rawhtml}
\excludecomment{htmlonly}

%  Hypertext commands etc. This is a condensed version of the html.sty
%  file supplied with LaTeX2HTML by: Nikos Drakos <nikos@cbl.leeds.ac.uk> &
%  Jelle van Zeijl <jvzeijl@isou17.estec.esa.nl>. The LaTeX2HTML documentation
%  should be consulted about all commands (and the environments defined above)
%  except \xref and \xlabel which are Starlink specific.

\newcommand{\htmladdnormallinkfoot}[2]{#1\footnote{#2}}
\newcommand{\htmladdnormallink}[2]{#1}
\newcommand{\htmladdimg}[1]{}
\newenvironment{latexonly}{}{}
\newcommand{\hyperref}[4]{#2\ref{#4}#3}
\newcommand{\htmlref}[2]{#1}
\newcommand{\htmlimage}[1]{}
\newcommand{\htmladdtonavigation}[1]{}
\newcommand{\latexhtml}[2]{#1}
\newcommand{\html}[1]{}

%  Starlink cross-references and labels.
\newcommand{\xref}[3]{#1}
\newcommand{\xlabel}[1]{}

%  LaTeX2HTML symbol.
\newcommand{\latextohtml}{{\bf LaTeX}{2}{\tt{HTML}}}

%  Define command to re-centre underscore for Latex and leave as normal
%  for HTML (severe problems with \_ in tabbing environments and \_\_
%  generally otherwise).
\newcommand{\latex}[1]{#1}
\newcommand{\setunderscore}{\renewcommand{\_}{{\tt\symbol{95}}}}
\latex{\setunderscore}

%  Redefine the \tableofcontents command. This procrastination is necessary
%  to stop the automatic creation of a second table of contents page
%  by latex2html.
\newcommand{\latexonlytoc}[0]{\tableofcontents}

% -----------------------------------------------------------------------------
%  Debugging.
%  =========
%  Remove % on the following to debug links in the HTML version using Latex.

% \newcommand{\hotlink}[2]{\fbox{\begin{tabular}[t]{@{}c@{}}#1\\\hline{\footnotesize #2}\end{tabular}}}
% \renewcommand{\htmladdnormallinkfoot}[2]{\hotlink{#1}{#2}}
% \renewcommand{\htmladdnormallink}[2]{\hotlink{#1}{#2}}
% \renewcommand{\hyperref}[4]{\hotlink{#1}{\S\ref{#4}}}
% \renewcommand{\htmlref}[2]{\hotlink{#1}{\S\ref{#2}}}
% \renewcommand{\xref}[3]{\hotlink{#1}{#2 -- #3}}
%end{latexonly}
% -----------------------------------------------------------------------------
% ? Document specific \newcommand or \newenvironment commands.
\newcommand{\latexonlysection}[1]{\section{#1}}
\newcommand{\latexonlysubsection}[1]{\subsection{#1}}
\newcommand{\latexonlysubsubsection}[1]{\subsubsection{#1}}
\begin{htmlonly}
   \newcommand{\latexonlysection}[1]{#1}
   \newcommand{\latexonlysubsection}[1]{#1}
   \newcommand{\latexonlysubsubsection}[1]{#1}
\end{htmlonly}
\newcommand{\st}[1]{{\em{#1}}}
\newcommand{\hi}[1]{{\tt{#1}}}
\newcommand{\latexelsehtml}[2]{#1}
\begin{htmlonly}
  \newcommand{\latexelsehtml}[2]{#2}
\end{htmlonly}

% Command for displaying routines in routine lists:
% =================================================

\newcommand{\noteroutine}[2]{{\small{\bf{#1}}}\nopagebreak\\
                             \hspace*{3em}\st{#2}\\[1.5ex]}
\begin{htmlonly}
   \newcommand{\noteroutine}[2]{{\small{\bf{#1}}}\\
                                  --- \st{#2}\\[1.0ex]}
\end{htmlonly}

%+
%  Name:
%     SST.TEX

%  Purpose:
%     Define LaTeX commands for laying out Starlink routine descriptions.

%  Language:
%     LaTeX

%  Type of Module:
%     LaTeX data file.

%  Description:
%     This file defines LaTeX commands which allow routine documentation
%     produced by the SST application PROLAT to be processed by LaTeX and
%     by LaTeX2html. The contents of this file should be included in the
%     source prior to any statements that make of the sst commnds.

%  Notes:
%     The commands defined in the style file html.sty provided with LaTeX2html
%     are used. These should either be made available by using the appropriate
%     sun.tex (with hypertext extensions) or by putting the file html.sty
%     on your TEXINPUTS path (and including the name as part of the
%     documentstyle declaration).

%  Authors:
%     RFWS: R.F. Warren-Smith (STARLINK)
%     PDRAPER: P.W. Draper (Starlink - Durham University)
%     MJC: Malcolm J. Currie (STARLINK)
%     DSB: David Berry (STARLINK)
%     TIMJ: Tim Jenness (JAC)

%  History:
%     10-SEP-1990 (RFWS):
%        Original version.
%     10-SEP-1990 (RFWS):
%        Added the implementation status section.
%     12-SEP-1990 (RFWS):
%        Added support for the usage section and adjusted various spacings.
%     8-DEC-1994 (PDRAPER):
%        Added support for simplified formatting using LaTeX2html.
%     1995 October 4 (MJC):
%        Added goodbreaks and pagebreak[3] in various places to improve
%        pages breaking before headings, not immediately after.
%        Corrected banner width.
%     1996 March 7 (MJC):
%        Mark document name on both sides of an sstroutine.
%     2-DEC-1998 (DSB):
%        Added sstattributetype (copied from sun210.tex).
%     2004 August 6 (MJC):
%        Added sstattribute.
%     21-JUL-2009 (TIMJ):
%        Added \sstdiylist{}{} as used when a Parameters section is located that
%        is not "ADAM Parameters".
%     {enter_further_changes_here}

%  Bugs:
%     {note_any_bugs_here}

%-

%  Define length variables.
\newlength{\sstbannerlength}
\newlength{\sstcaptionlength}
\newlength{\sstexampleslength}
\newlength{\sstexampleswidth}

%  Define a \tt font of the required size.
\latex{\newfont{\ssttt}{cmtt10 scaled 1095}}
\html{\newcommand{\ssttt}{\tt}}

%  Define a command to produce a routine header, including its name,
%  a purpose description and the rest of the routine's documentation.
\newcommand{\sstroutine}[3]{
   \goodbreak
   \markboth{{\stardocname}~ --- #1}{{\stardocname}~ --- #1}
   \rule{\textwidth}{0.5mm}
   \vspace{-7ex}
   \newline
   \settowidth{\sstbannerlength}{{\Large {\bf #1}}}
   \setlength{\sstcaptionlength}{\textwidth}
   \setlength{\sstexampleslength}{\textwidth}
   \addtolength{\sstbannerlength}{0.5em}
   \addtolength{\sstcaptionlength}{-2.0\sstbannerlength}
   \addtolength{\sstcaptionlength}{-5.0pt}
   \settowidth{\sstexampleswidth}{{\bf Examples:}}
   \addtolength{\sstexampleslength}{-\sstexampleswidth}
   \parbox[t]{\sstbannerlength}{\flushleft{\Large {\bf #1}}}
   \parbox[t]{\sstcaptionlength}{\center{\Large #2}}
   \parbox[t]{\sstbannerlength}{\flushright{\Large {\bf #1}}}
   \begin{description}
      #3
   \end{description}
}

% Frame attributes fount.  Need to find a way for these to stand out.
% San serif doesn't work by default.  Also without the \rm the
% san serif continues after \sstatt hyperlinks.  Extra braces
% failed to prevent \sstattribute from using roman fount for its
% headings.  The current lash up appears to work, but needs further
% investigation or a TeX wizard.
\newcommand{\sstatt}[1]{\sf #1}
\begin{htmlonly}
  \newcommand{\sstatt}[1]{\large{\tt #1}}
\end{htmlonly}

%  Define a command to produce an attribute header, including its name,
%  a purpose description and the rest of the routine's documentation.
\newcommand{\sstattribute}[3]{
   \goodbreak
   \markboth{{\stardocname}~ --- #1}{{\stardocname}~ --- #1}
   \rule{\textwidth}{0.5mm}
   \vspace{-7ex}
   \newline
   \settowidth{\sstbannerlength}{{\Large {\sstatt #1}}}
   \setlength{\sstcaptionlength}{\textwidth}
   \setlength{\sstexampleslength}{\textwidth}
   \addtolength{\sstbannerlength}{0.5em}
   \addtolength{\sstcaptionlength}{-2.0\sstbannerlength}
   \addtolength{\sstcaptionlength}{-4.9pt}
   \settowidth{\sstexampleswidth}{{\bf Examples:}}
   \addtolength{\sstexampleslength}{-\sstexampleswidth}
   \parbox[t]{\sstbannerlength}{\flushleft{\Large {\sstatt #1}}}
   \parbox[t]{\sstcaptionlength}{\center{\Large #2}}
   \parbox[t]{\sstbannerlength}{\flushright{\Large {\sstatt #1}}}
   \begin{description}
      #3
   \end{description}
}

%  Format the description section.
\newcommand{\sstdescription}[1]{\item[Description:] #1}

%  Format the usage section.
\newcommand{\sstusage}[1]{\goodbreak \item[Usage:] \mbox{}
\\[1.3ex]{\raggedright \ssttt #1}}

%  Format the invocation section.
\newcommand{\sstinvocation}[1]{\item[Invocation:]\hspace{0.4em}{\tt #1}}

%  Format the attribute data type section.
\newcommand{\sstattributetype}[1]{
   \item[Type:] \mbox{} \\
      #1
}

%  Format the arguments section.
\newcommand{\sstarguments}[1]{
   \item[Arguments:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #1
   \end{description}
}

%  Format the returned value section (for a function).
\newcommand{\sstreturnedvalue}[1]{
   \item[Returned Value:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #1
   \end{description}
}

%  Format the parameters section (for an application).
\newcommand{\sstparameters}[1]{
   \goodbreak
   \item[Parameters:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #1
   \end{description}
}

%  Format the applicability section.
\newcommand{\sstapplicability}[1]{
   \item[Class Applicability:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #1
   \end{description}
}

%  Format the examples section.
\newcommand{\sstexamples}[1]{
   \goodbreak
   \item[Examples:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #1
   \end{description}
}

%  Define the format of a subsection in a normal section.
\newcommand{\sstsubsection}[1]{ \item[{#1}] \mbox{} \\}

%  Define the format of a subsection in the examples section.
\newcommand{\sstexamplesubsection}[2]{\sloppy
\item[\parbox{\sstexampleslength}{\ssttt #1}] \mbox{} \vspace{1.0ex}
\\ #2 }

%  Format the notes section.
\newcommand{\sstnotes}[1]{\goodbreak \item[Notes:] \mbox{} \\[1.3ex] #1}

%  Provide a general-purpose format for additional (DIY) sections.
\newcommand{\sstdiytopic}[2]{\item[{\hspace{-0.35em}#1\hspace{-0.35em}:}]
\mbox{} \\[1.3ex] #2}

%  Format the a generic section as a list
\newcommand{\sstdiylist}[2]{
   \item[#1:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #2
   \end{description}
}

%  Format the implementation status section.
\newcommand{\sstimplementationstatus}[1]{
   \item[{Implementation Status:}] \mbox{} \\[1.3ex] #1}

%  Format the bugs section.
\newcommand{\sstbugs}[1]{\item[Bugs:] #1}

%  Format a list of items while in paragraph mode.
\newcommand{\sstitemlist}[1]{
  \mbox{} \\
  \vspace{-3.5ex}
  \begin{itemize}
     #1
  \end{itemize}
}

%  Define the format of an item.
\newcommand{\sstitem}{\item}

%  Now define html equivalents of those already set. These are used by
%  latex2html and are defined in the html.sty files.
\begin{htmlonly}

%  sstroutine.
   \newcommand{\sstroutine}[3]{
      \subsection{#1\xlabel{#1}-\label{#1}#2}
      \begin{description}
         #3
      \end{description}
   }

%  sstattribute. Note the further level of subsectioning.
   \newcommand{\sstattribute}[3]{
      \subsubsection{#1\xlabel{#1}-\label{#1}#2}
      \begin{description}
         #3
      \end{description}
      \\
   }

%  sstdescription
   \newcommand{\sstdescription}[1]{\item[Description:]
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstusage
   \newcommand{\sstusage}[1]{\item[Usage:]
      \begin{description}
         {\ssttt #1}
      \end{description}
      \\
   }

%  sstinvocation
   \newcommand{\sstinvocation}[1]{\item[Invocation:]
      \begin{description}
         {\ssttt #1}
      \end{description}
      \\
   }

%  sstarguments
   \newcommand{\sstarguments}[1]{
      \item[Arguments:] \\
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstreturnedvalue
   \newcommand{\sstreturnedvalue}[1]{
      \item[Returned Value:] \\
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstparameters
   \newcommand{\sstparameters}[1]{
      \item[Parameters:] \\
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstapplicability
   \newcommand{\sstapplicability}[1]{%
      \item[Class Applicability:]
       \begin{description}
         #1
      \end{description}
      \\
   }

%  sstexamples
   \newcommand{\sstexamples}[1]{
      \item[Examples:] \\
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstsubsection
   \newcommand{\sstsubsection}[1]{\item[{#1}]}

%  sstexamplesubsection
   \newcommand{\sstexamplesubsection}[2]{\item[{\ssttt #1}] #2\\}

%  sstnotes
   \newcommand{\sstnotes}[1]{\item[Notes:] #1 }

%  sstdiytopic
   \newcommand{\sstdiytopic}[2]{\item[{#1}] #2 }

%  sstimplementationstatus
   \newcommand{\sstimplementationstatus}[1]{
      \item[Implementation Status:] #1
   }

%  sstitemlist
   \newcommand{\sstitemlist}[1]{
      \begin{itemize}
         #1
      \end{itemize}
      \\
   }
%  sstitem
   \newcommand{\sstitem}{\item}

\end{htmlonly}

%  End of sst.tex layout definitions.
%.


% ? End of document specific commands
% -----------------------------------------------------------------------------
%  Title Page.
%  ===========
\renewcommand{\thepage}{\roman{page}}
\begin{document}
\thispagestyle{empty}

%  Latex document header.
%  ======================
\begin{latexonly}
   CCLRC / {\sc Rutherford Appleton Laboratory} \hfill {\bf \stardocname}\\
   {\large Particle Physics \& Astronomy Research Council}\\
   {\large Starlink Project\\}
   {\large \stardoccategory\ \stardocnumber}
   \begin{flushright}
   \stardocauthors\\
   \stardocdate
   \end{flushright}
   \vspace{-4mm}
   \rule{\textwidth}{0.5mm}
   \vspace{5mm}
   \begin{center}
   {\Huge\bf  \stardoctitle \\ [2.5ex]}
   {\LARGE\bf \stardocversion \\ [4ex]}
   {\Huge\bf  \stardocmanual}
   \end{center}
   \vspace{5mm}

% ? Heading for abstract if used.
   \vspace{10mm}
   \begin{center}
      {\Large\bf Abstract}
   \end{center}
% ? End of heading for abstract.
\end{latexonly}

%  HTML documentation header.
%  ==========================
\begin{htmlonly}
   \xlabel{}
   \begin{rawhtml} <H1> \end{rawhtml}
      \stardoctitle\\
      \stardocversion\\
      \stardocmanual
   \begin{rawhtml} </H1> \end{rawhtml}

% ? Add picture here if required.
% ? End of picture

   \begin{rawhtml} <P> <I> \end{rawhtml}
   \stardoccategory\ \stardocnumber \\
   \stardocauthors \\
   \stardocdate
   \begin{rawhtml} </I> </P> <H3> \end{rawhtml}
      \htmladdnormallink{CCLRC}{http://www.cclrc.ac.uk} /
      \htmladdnormallink{Rutherford Appleton Laboratory}
                        {http://www.cclrc.ac.uk/ral} \\
      \htmladdnormallink{Particle Physics \& Astronomy Research Council}
                        {http://www.pparc.ac.uk} \\
   \begin{rawhtml} </H3> <H2> \end{rawhtml}
      \htmladdnormallink{Starlink Project}{http://www.starlink.ac.uk/}
   \begin{rawhtml} </H2> \end{rawhtml}
   \htmladdnormallink{\htmladdimg{source.gif} Retrieve hardcopy}
      {http://www.starlink.ac.uk/cgi-bin/hcserver?\stardocsource}\\

%  HTML document table of contents.
%  ================================
%  Add table of contents header and a navigation button to return to this
%  point in the document (this should always go before the abstract \section).
  \label{stardoccontents}
  \begin{rawhtml}
    <HR>
    <H2>Contents</H2>
  \end{rawhtml}
  \renewcommand{\latexonlytoc}[0]{}
  \htmladdtonavigation{\htmlref{\htmladdimg{contents_motif.gif}}
        {stardoccontents}}

% ? New section for abstract if used.
  \section{\xlabel{abstract}Abstract}
% ? End of new section for abstract
\end{htmlonly}

% -----------------------------------------------------------------------------
% ? Document Abstract. (if used)
%  ==================
\stardocabstract
% ? End of document abstract
% -----------------------------------------------------------------------------
% ? Latex document Table of Contents (if used).
%  ===========================================
 \newpage
 \begin{latexonly}
   \setlength{\parskip}{0mm}
   \latexonlytoc
   \setlength{\parskip}{\medskipamount}
   \markright{\stardocname}
 \end{latexonly}
% ? End of Latex document table of contents
% -----------------------------------------------------------------------------
\cleardoublepage
\renewcommand{\thepage}{\arabic{page}}
\setcounter{page}{1}

\section {Introduction}

KAPPA is package of general-purpose astronomical image-processing and
visualization commands. It is documented in \xref{SUN/95}{sun95}{}. Over
the long history of the KAPPA package, many internal Fortran subroutines
have been written to provide facilities within KAPPA which have
subsequently proved to be of more-general use outside KAPPA. In order to
gain the benefit of these internal KAPPA facilities, software developers
have in the past taken copies of the relevant routines and included them
in their own projects. The disadvantages of this are obvious---it is easy
to end up with many, potentially different, copies of the same routines
within a large software suite such as the Starlink Software Collection,
and bug fixes need to be implemented in many different places, rather
than a in single master copy.

Another way of using the internal KAPPA routines is to link your
applications directly against the libraries in the KAPPA package, but
this requires the KAPPA package to be installed anywhere where your
software is to be built, which is not always convenient.

To get round these problems, the KAPLIBS package was created to
contain the internal routines from KAPPA which are deemed to be
``generally useful''. Now, you only need to have KAPLIBS installed to
build your software, not the much larger KAPPA.

There are a large number of routines in KAPLIBS, making it potentially
difficult to find the routines you want. To ease this problem, a search
tool is provided which allows the contents of this document to be
searched (see \hyperref{here}{Section~}{}{SEC:SEARCH}).

\subsection{Stability of the KAPLIBS Interface}
KAPLIBS was created as a pragmatic solution to the problem of
proliferation of KAPPA source code in several other packages. One of the
reasons for previously keeping these routines hidden away within KAPPA was
so that changes could be made to the argument lists or functionality
of these routines without breaking software within other packages. In
practice, it has hardly ever been necessary to change the interface to
routines after an initial development period, but the possibility still
exists that this may be necessary. For this reason, users of KAPLIBS
should be aware that \emph{it may occasionally be necessary to change the
interface to KAPLIBS routines}. Such changes will be listed within
this document at each release. To aid developers decisions over which
routines to use, routines which are deemed to have a significant chance
of being changed within the foreseeable future are highlighted later in
this document. This class of routine will normally just include routines
which have only recently been written.

\subsection{The Scope of this Document}
The purpose of this document is to give reference information about the
argument lists and functionality of the internal KAPPA routines which are
contained within KAPLIBS. It does not give a detailed explanation of how
these routines should be used within a real application. Developers
should usually study examples of existing code within KAPPA for this
purpose. The source code for KAPPA is available from the Starlink
Software Librarian, {\tt ussc@star.rl.ac.uk}.

Applications within KAPPA are split up into several groups (called
``monoliths'), with names such as {\tt kapview}, {\tt ndfpack} and
(rather confusingly but at one time the only KAPPA monolith)
{\tt kappa}. The top-level routines for the
applications in monolith {\tt xyz} are in the tar file {\tt
\$KAPPA\_DIR/xyz\_sub.tar}. Each application may use some
application-specific subroutines (\emph{i.e.} subroutines which are so
closely related to the purpose of a single application that they are not
deemed as ``generally useful''). These will be denoted by subroutines
names with prefix ``{\tt KPS1\_}'' and will be contained within the tar
file {\tt \$KAPPA\_DIR/kapsub\_sub.tar}.

\section{Naming Conventions}
Each subroutine within KAPLIBS has a name of the form {\tt <prefix>\_<name>}
where {\tt <prefix>} is a prefix indicating which KAPPA library the
routine belongs to, and {\tt <name>} is a unique name for the routine.
The prefix associated with each KAPPA library indicates something of the
purpose of that library. The following prefixes are currently included
within KAPLIBS:

\begin{description}

\item [AIF\_] These are old routines which were used to access parameter
values or temporary work space. They are gradually being replaced within
KAPPA by more modern routines provided by the PAR and PSX libraries.

\item [FTS1\_] These are routines used to access FITS files and headers -
KAPPA's own {\tt fitsio}.

\item [IRA\_] These routines were initially part of the IRAS90 Astrometry
library (hence the IRA acronym). They are used to gain access to WCS
information stored within NDFs in the form of IRAS90 Astrometry extension.
This form of WCS is now deprecated in favour of the NDF WCS component,
accessed through the \xref{AST}{sun210}{} library.

\item [KPG1\_] These are other general-purpose routines which do not fall
into such obvious groups.  Even within this library, though, there are
loose associations of routines, usually indicated by some common element
within the routine name. The following are some of the more significant
associations:

\begin{itemize}
\item Routines associated with use of the PGPLOT graphics package usually
have names which start ``{\tt KPG1\_PG}''.
\item Routines associated with use of the AGI graphics database usually
have names which start ``{\tt KPG1\_GD}''.
\item Routines associated with accessing or using WCS information usually
have names which start ``{\tt KPG1\_AS}''.
\end{itemize}

\end{description}

Within all these groups, some routines have different versions for
processing data with different numerical types. The names of such
routines are identical except for the trailing one or two characters
which indicate the data type processed. These one- or two-character
codes are:

\begin{description}
\item [d] - Double-precision floating point
\item [r] - Single-precision floating point
\item [c] - Character
\item [i] - Single-precision integer
\item [w] - Word (usually two-byte integers)
\item [uw] - Unsigned word (usually two-byte unsigned integers)
\item [bw] - Byte (usually one-byte integers)
\item [ub] - Unsigned byte (usually one-byte unsigned integers)
\item [l] - Logical
\end{description}

Sometimes, routine names are documented as ending with a lower-case
``x''. This indicates that routines exist for various of the above
numerical types. The \emph{actual} routines names will not include the trailing
``x'', but will have one of the above codes in place of the ``x''.

\section{Compiling and Linking}
To compile and link an application with the KAPLIBS package, the following
commands should be used (see \xref{SUN/144}{sun144}{}):

\small
\begin{verbatim}
      % alink adamprog.f `kaplibs_link_adam`
\end{verbatim}
\normalsize

Note the use of {\em opening} apostrophes (`) rather than the more common
closing apostrophe (')\footnote{Currently, the parameter handling
routines within KAPLIBS have not been separated out, and so it is not
currently possible to link stand-alone (\emph{i.e.} ``non-Adam'')
applications against KAPLIBS.}.

This produces an executable image called {\bf prog}. The
\verb+kaplibs_dev+ command creates soft links within the current
directory to the various include files provided by KAPLIBS. These are
removed by the \verb+kaplibs_dev remove+ command.

\subsection{Linking with Native PGPLOT}
The commands described above will link the application with the Starlink
GKS version of the \xref{PGPLOT graphics library}{sun15}{}. If you wish
to link with the {\em native} version of PGPLOT, then include the switch
``-nogks'' as follows:

\small
\begin{verbatim}
      % alink adamprog.f `kaplibs_link_adam -nogks`
\end{verbatim}
\normalsize

This will include native PGPLOT in the link list, and cause all GKS and IDI
related items to be removed.

\newpage
\appendix

\section{Changes in Version 3.1}
\begin{itemize}
\item New C function kpg1Config gets a KeyMap containing configuration
      parameters from the user, with name checking and default values
      supplied.
\item The new routine KPG1\_DSSFM displays information about the storage 
      form of an NDF array.
\item There is a new generic routine KPG\_FISEx that fills a section
      of a multi-dimensional array.
\item The new KPG1\_GTGPT routine is a variant of KPG1\_GTGRP to obtain
      groups of strings.  KPG1\_GTGPT supports group members that are not
      `sticky', in other words the strings only last for the current
      invocation of an application.
\item The new more-general KPG\_ISEQN replaces the old IRCAM-specific
      NXTNAM routine.  This increments trailing sequence numbers
      in strings, most often used to generate a series of filenames.
\item Add new routine KPG\_LR2Ax that is the same as KPG\_LDA2x
      (formerly LD2AR) except it processes single-precision sparse data.
\item There is a new routine KPG\_NORVx to replace the old NORMAL.  It
      has the benefits of being generic and can operate on an array.
\item KPG\_OSTAx added.  It uses recurrence formulae to calculate
      simple statistics robustly.  It also extends KPG1\_STATx by
      deriving the skewness and kurtosis.

\item DIMLST is renamed KPG\_DIMLS.
\item ICMMM has been renamed KPG\_IMMMx and made generic.  The
      calculations are now in performed double precision.  Note that
      the API has changed: the first two arguments have been transposed
      to the standard order, and the returned floating-point statistics
      are now double precision.
\item LD2AR has been renamed KPG\_LD2Ax and made generic.

\item Remove FTS1\_TREAD since the MAG library has now been removed
      from the main Starlink source tree.
\item A number of long-deprecated old routines without a package prefix
      have been removed.  These are listed below.  The corresponding
      replacement routines appear in the right column.

\begin{tabular}{lcc}
BAD2Dx  & \multicolumn{2}{l}{KPG\_FISEx setting the fill value to VAL\_\_BADx} \\
CHVALx  & \multicolumn{2}{l}{KPG1\_CHVAx} \\
COPAx   & \multicolumn{2}{l}{VEC\_xTOx or KPG1\_COPY} \\
COPY1D  & {\tt "}   & {\tt "}  \\
COPY2D  & {\tt "}   & {\tt "}  \\
COPY3D  & {\tt "}   & {\tt "}  \\
CPSECR  & \multicolumn{2}{l}{KPG1\_CPNDx} \\
CREOUT  & \multicolumn{2}{l}{NDF\_CREP and NDF\_CPUT} \\
ELNMBx  & \multicolumn{2}{l}{KPG1\_ELNMx} \\
EXPARR  & \multicolumn{2}{l}{KPG1\_EXPOx} \\
INSET   & \multicolumn{2}{l}{CHR\_INSET} \\
LOGARR  & \multicolumn{2}{l}{KPG1\_LOGAx} \\
NORMAL  & \multicolumn{2}{l}{KPG\_NORVx} \\
NXTNAM  & \multicolumn{2}{l}{KPG\_ISEQN} \\
POWARR  & \multicolumn{2}{l}{KPG1\_POWx} \\
ZERO1D  & \multicolumn{2}{l}{KPG1\_FILLx setting the fill value to 0.0. } \\
ZERO2D  & \multicolumn{2}{l}{KPG1\_FILLx setting the fill value to 0.0. } \\
\end{tabular}

\item KPG1\_ASSET now parses the supplied parameter name for a
      non-alphanumeric prefix and suffix to determine whether or not
      temporary attributes are supported via the new KPG1\_GTGPT
      routine.  A suffix indicates that KPG1\_ASSET will be called
      again for the same parameter, affecting the value to write to
      the parameter file.
\item The KPG1\_PLTLN routine now accepts a value 6 for the MODE
      argument, which causes a staircase plot to be produced in which
      bad values are not flanked by vertical lines to the lower edge
      of the plot (as are produced by Mode 1), leaving a gap.
\item KPG1\_STDSx and KPG1\_STFLx can respectively report or log the
      skewness and kurtosis via two additional arguments.  Users of
      these routines will need to modify calling routines accordingly;
      without skewness or kurtosis values to document supply
      VAL\_\_BADD for each undefined statistic.
\item Support for FITS tapes was removed from FTS1\_PHEAD, FTS1\_RDATA,
      FTS1\_RGRDA, FTS1\_RSTAB, FTS1\_SKIP.  Argument MEDIUM in these
      routines now only accepts the value {\tt DISK}.
\end{itemize}

\section{Changes in Version 3.0}
\begin{itemize}
\item \xref{CTG}{sun262}{}, \xref{IRQ}{sun261}{}, and \xref{LPG}{sun263}{}
      libraries are no longer in KAPLIBS.  They are autonomous
      libraries each with its own documentation and link scripts.
\item KPG1\_MVBDx added. It modifies an array index (such as produced by
      \xref{PDA\_QSIAx}{sun194}{PDA_QSIAx}) to exclude indices that refer
      to bad data values.
\item KPG\_STOSx added.  It calculates accurate order statistics by
      sorting an array by means of an index, returning the median and
      optionally percentiles.
\end{itemize}

\section{Changes in Version 2.8}
\begin{itemize}

\item KPG1\_BADBX added. It returns an NDF identifier for the smallest section
      of a supplied NDF that encloses all the good data values in the NDF.
\item KPG1\_BBOX$<$T$>$ added. It obtains the pixel bounding box of a given
     value within an $N$-dimensional data array.
\item KPG1\_LIKE added. It obtains a section of an NDF that matches either
      the pixel or WCS shape of a given template NDF.
\item KPG1\_KYMAP can read vectors as well as scalars from a GRP
      group into an AST keyMap.
\item {\tt kaplibs\_link} script now works without attempting to load ADAM
      symbols.
\item Can now be built as a shared library.
\item Added KPG1\_ASTCMN to provide access to KPG\_AST private common block
\item The \xref{HLP}{sun124}{} helper routines are no longer part of kaplibs.
      Use the SHL library instead.
\item KPG1\_SCRSZ is no longer present. Please use
      \xref{ONE\_SCRSZ}{sun234}{ONE\_SCRSZ} instead.
\item Now released under the GPL.
\item kpgGtfts and kpgPtfts can now be used to read and write
      AST FitsChan objects from/to an NDF.
\item KAPLIBS no longer links against Tk (the one Tk routine has been
      removed from KAPLIBS).
\item KAPLIBS now has a public C interface (but not for all routines).
\item Added KPG1\_CGET, which returns the value of an NDF character
      component removing any AST or PGPLOT escape sequences.
\item Added KPG1\_MXMNX, which provides a single interface to the
      existing generic KPG1\_MXMNx routines.
\item Added KPG1\_SCALX, which provides a single interface to the
      new doubly generic KPG1\_SCLxx routines, for scaling
      and shifting data values.
\end{itemize}

\section{Changes in Version 2.7}
\begin{itemize}
\item A new routine LPG\_REPLA has been added. It controls a new option
      which allows a single NDF to be used as both input and output for an
      ADAM task.  The default is for this option to be disabled.
\end{itemize}

\section{Changes in Version 2.6}
\begin{itemize}
\item The GRF module (grf\_kaplibs.c) has been upgraded to include the
      extra functions needed by AST V3.2.
\end{itemize}

\section{Changes in Version 2.5}
\begin{itemize}
\item The KPG1\_FFT... routines have been made significantly faster (at
      the expense of using slightly more memory). For instance, a speed gain
      of a factor 10 is typical for an array of 150000 points.
\end{itemize}

\section{Changes in Version 2.4}
\begin{itemize}
\item The KPG1\_WRLST routine now normalises the supplied positions (using
      \xref{AST\_NORM}{sun210}{AST_NORM}) before writing them to the output
      catalogue.
\end{itemize}

\section{Changes in Version 2.3}
\begin{itemize}
\item The routine GETHLP has been moved from KAPPA to the KAPLIBS:KAPGEN library.
\end{itemize}

\section{Changes in Version 2.2}
\begin{itemize}
\item Script \verb+kaplibs_link+ has been added to enable linking of standalone
      applications.
\item The routine KPG1\_DSFRM has been modified to include details of AST
      SpecFrames. \emph{The argument list has also been changed.}
\item The routine KPG1\_ASMRG has been modified to attempt alignment in
      Domain SPECTRAL.
\end{itemize}

\section{Changes in Version 2.1}
\begin{itemize}
\item The KPG1\_CPSTY routine has been added to copy AST Plotting styles
      from one graphical element to another.
\end{itemize}

\section{Changes in Version 2.0}
\begin{itemize}
\item The ``-nogks'' switch has been added to the
      \verb#kaplibs_link_adam# command, allowing applications to be linked with
      native PGPLOT instead of the Starlink GKS-based PGPLOT.
\item The routine KPG1\_WRLST now allows the user to choose the
      co-ordinate system in which the positions are stored in the catalogue
      columns. This is done using two ADAM parameters called COLFRAME and
      COLEPOCH (these names are hard-wired into the routine to encourage
      conformity). Consequently, applications which use this routine should add
      definitions for these two parameters to their IFL files.
\item The routine KPG1\_RDLST can now read positions from catalogues which
      do not contain a WCS FrameSet, in certain special cases. That is, if the
      catalogue contains columns called RA and DEC, or X and Y.
\item The IRAS90 IRQ library has been included. IRQ is used to manage
      textual representations of NDF Quality bits.
\end{itemize}

\begin{latexonly}
  \newpage
  \latexonlysection{Alphabetical List of Routines}
  \small





