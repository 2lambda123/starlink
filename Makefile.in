# Process this file with autoconf to generate the Makefile
# @configure_input@

# Keep the following in alphabetical order
ALL_TARGETS = \
	$(MANIFEST)/adam \
	$(MANIFEST)/ams \
	$(MANIFEST)/atimer \
	$(MANIFEST)/chr \
	$(MANIFEST)/cnf \
	$(MANIFEST)/dtask \
	$(MANIFEST)/ems \
	$(MANIFEST)/fio \
	$(MANIFEST)/hds \
	$(MANIFEST)/hdspar \
	$(MANIFEST)/hlp \
	$(MANIFEST)/lex \
	$(MANIFEST)/mers \
	$(MANIFEST)/messgen \
	$(MANIFEST)/messys \
	$(MANIFEST)/misc \
	$(MANIFEST)/msp \
	$(MANIFEST)/par \
	$(MANIFEST)/parsecon \
	$(MANIFEST)/pcs \
	$(MANIFEST)/psx \
	$(MANIFEST)/sae \
	$(MANIFEST)/sla \
	$(MANIFEST)/sock \
	$(MANIFEST)/starconf \
	$(MANIFEST)/string \
	$(MANIFEST)/subpar \
	$(MANIFEST)/task

# Targets which are used when bootstrapping.
# Keep these in alphabetical order.
BUILDSUPPORT_TARGETS = \
	$(MANIFEST)/autoconf \
	$(MANIFEST)/automake \
	$(MANIFEST)/libtool \
	$(MANIFEST)/starconf

SUBDIRS = @subdirs@
@SET_MAKE@

RECURSIVE_TARGETS = clean maintainer-clean

# Targets present in tree, but excluded from list
#   adamnet -- obsolete


# Java support: need a java runtime
JAVA=@JAVA@

# MANIFEST and prefix must match the value defaulted in starconf.
# FIXME: tie these together, and link with starconf values.
prefix=@prefix@
MANIFEST=$(prefix)/manifests



all: $(ALL_TARGETS)
buildsupport: $(BUILDSUPPORT_TARGETS)

# FIXME: this depends on the xt jar being handy; either check this in or,
# better, write a 10-line Java application under buildsupport to replace it,
# using the XSLT support (JAXP) present in Java 1.4+.
Makefile.dependencies: componentset.xml
	$(JAVA) com.jclark.xsl.sax.Driver \
		$< buildsupport/starconf/make-dependencies.xslt $@

componentset.xml:
	echo '<!DOCTYPE componentset SYSTEM "componentinfo.dtd">' >$@
	echo '<componentset>' >>$@
#	cat `find . -name component.xml` | sed -e '/^<?/d' -e '/^<!/d' >>$@
	find . -name component.xml -exec cat '{}' ';' | \
		sed -e '/^<?/d' -e '/^<!/d' >>$@
	echo '</componentset>' >>$@

# Makefile.dependencies expresses all the dependencies between components.
# It expects the current file to define variable MANIFEST to be the directory
# which holds the manifest files, typically /star/manifests
include Makefile.dependencies

$(RECURSIVE_TARGETS):
	for d in $(SUBDIRS); do \
	    (cd $$d; $(MAKE) $@); \
	done
